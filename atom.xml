<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[mk-mode BLOG]]></title>
  <link href="http://komasaru.github.io/atom.xml" rel="self"/>
  <link href="http://komasaru.github.io/"/>
  <updated>2016-02-07T00:05:21+09:00</updated>
  <id>http://komasaru.github.io/</id>
  <author>
    <name><![CDATA[mk-mode.com]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Ruby - Flightradar24 から航空会社情報一覧取得！]]></title>
    <link href="http://komasaru.github.io/blog/2016/02/07/ruby-getting-airline-list-from-fr24/"/>
    <updated>2016-02-07T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2016/02/07/ruby-getting-airline-list-from-fr24</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>航空機の運行状況をリアルタイムで確認できる Web サイト <a href="http://www.flightradar24.com" title="Flightradar24.com - Live flight tracker!">Flightradar24.com</a> に登録されている航空会社情報の一覧を Ruby で取得してみました。（と言っても、 JSON データを取得しているだけですが）</p>

<p>空港情報一覧の取得については前回の記事をご参照ください。</p>

<ul>
<li><a href="http://komasaru.github.io/2016/02/06/ruby-getting-airport-list-from-fr24/" title="Ruby - Flightradar24 から空港情報一覧取得！">Ruby - Flightradar24 から空港情報一覧取得！</a></li>
</ul>


<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>Ruby 2.2.4-p230 での作業を想定。</li>
<li>世界中の全航空会社を網羅している訳ではないかもしれない。（空港情報一覧と同様に）</li>
</ul>


<h3>1. Ruby スクリプトの作成</h3>

<p>難しいことはしていないので、説明は省略する。<br/>
ただ、悪質な Bot でないことを主張するため、連絡先を User Agent に設定している。（伏字は適宜置き換えること）</p>

<figure class='code'><figcaption><span>fr24_airlines.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#! /usr/local/bin/ruby</span>
</span><span class='line'><span class="c1"># coding: utf-8</span>
</span><span class='line'><span class="c1">#---------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c1">#= Flightradar24 航空会社情報取得</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># date          name            version</span>
</span><span class='line'><span class="c1"># 2015.12.20    mk-mode.com     1.00 新規作成</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># Copyright(C) 2015 mk-mode.com All Rights Reserved.</span>
</span><span class='line'><span class="c1">#---------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c1">#++</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;json&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;open-uri&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;timeout&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Fr24Airlines</span>
</span><span class='line'>  <span class="no">URL</span>        <span class="o">=</span> <span class="s2">&quot;http://www.flightradar24.com/_json/airlines.php&quot;</span>  <span class="c1"># 接続先 URL</span>
</span><span class='line'>  <span class="no">TIMEOUT</span>    <span class="o">=</span> <span class="mi">10</span>                                                 <span class="c1"># OpenURI 接続時のタイムアウト</span>
</span><span class='line'>  <span class="no">USER_AGENT</span> <span class="o">=</span> <span class="s2">&quot;xxxxxxx Bot (by Ruby/</span><span class="si">#{</span><span class="no">RUBY_VERSION</span><span class="si">}</span><span class="s2">, Administrator: xxxxxxxx@yyyyyyy.zzz)&quot;</span>
</span><span class='line'>                                                                  <span class="c1"># OpenURI 接続時の User-Agent, Mail Address</span>
</span><span class='line'>  <span class="no">FILE_PATH</span>  <span class="o">=</span> <span class="s2">&quot;./data/airlines&quot;</span>                                  <span class="c1"># 保存ファイル</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">exec</span>
</span><span class='line'>    <span class="n">get_json</span>       <span class="c1"># JSON 取得</span>
</span><span class='line'>    <span class="c1">#save_file      # ファイル保存</span>
</span><span class='line'>    <span class="n">save_file_csv</span>  <span class="c1"># ファイル保存（CSV 形式）</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>    <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;[</span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">class</span><span class="si">}</span><span class="s2">] </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">e</span><span class="o">.</span><span class="n">backtrace</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">tr</span><span class="o">|</span> <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="si">#{</span><span class="n">tr</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'>    <span class="nb">exit</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># JSON 取得</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">get_json</span>
</span><span class='line'>    <span class="n">str</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="n">timeout</span><span class="p">(</span><span class="no">TIMEOUT</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">str</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="no">URL</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;User-Agent&quot;</span> <span class="o">=&gt;</span> <span class="no">USER_AGENT</span><span class="p">})</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="vi">@json</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">[</span><span class="s2">&quot;rows&quot;</span><span class="o">].</span><span class="n">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">j</span><span class="o">|</span> <span class="n">j</span><span class="o">[</span><span class="s2">&quot;Name&quot;</span><span class="o">]</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>    <span class="k">raise</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ファイル保存</span>
</span><span class='line'>  <span class="c1"># * 最大文字数（name: 33）</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">save_file</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">FILE_PATH</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>      <span class="n">str</span> <span class="o">=</span>  <span class="s2">&quot;NAME&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">31</span> <span class="o">+</span> <span class="s2">&quot;IATA  ICAO&quot;</span>
</span><span class='line'>      <span class="n">f</span><span class="o">.</span><span class="n">puts</span> <span class="n">str</span>
</span><span class='line'>      <span class="vi">@json</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">j</span><span class="o">|</span>
</span><span class='line'>        <span class="n">f</span><span class="o">.</span><span class="n">printf</span><span class="p">(</span><span class="s2">&quot;%-33s  %2s    %3s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">j</span><span class="o">[</span><span class="s2">&quot;Name&quot;</span><span class="o">]</span><span class="p">,</span> <span class="n">j</span><span class="o">[</span><span class="s2">&quot;Code&quot;</span><span class="o">]</span><span class="p">,</span> <span class="n">j</span><span class="o">[</span><span class="s2">&quot;ICAO&quot;</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>    <span class="k">raise</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ファイル保存（CSV 形式）</span>
</span><span class='line'>  <span class="c1"># * 最大文字数（name: 33）</span>
</span><span class='line'>  <span class="c1"># * Code が &quot;&quot; のこともあることに注意</span>
</span><span class='line'>  <span class="c1"># * カンマが含まれる可能性のある Name のみ &quot;&quot; でくくっている</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">save_file_csv</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">FILE_PATH</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>      <span class="n">f</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;NAME,IATA,ICAO&quot;</span>
</span><span class='line'>      <span class="vi">@json</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">j</span><span class="o">|</span>
</span><span class='line'>        <span class="n">f</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="si">#{</span><span class="n">j</span><span class="o">[</span><span class="s2">&quot;Name&quot;</span><span class="o">]</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">,</span><span class="si">#{</span><span class="n">j</span><span class="o">[</span><span class="s2">&quot;Code&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">,</span><span class="si">#{</span><span class="n">j</span><span class="o">[</span><span class="s2">&quot;ICAO&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>    <span class="k">raise</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Fr24Airlines</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">exec</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://gist.github.com/komasaru/940d11d07a3fd452ba10" title="Gist - Ruby script to get a airline list from Flightradar24.">Gist - Ruby script to get a airline list from Flightradar24.</a></li>
</ul>


<h3>2. Ruby スクリプトの実行</h3>

<p>Ruby スクリプトと同じディレクトリ内に &ldquo;data&rdquo; ディレクトリを作成後、以下を実行。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ ./fr24_airlines.rb
</span></code></pre></td></tr></table></div></figure>


<h3>3. データの確認</h3>

<p>&ldquo;data&rdquo; ディレクトリ内に &ldquo;airlines.txt&rdquo; が作成されるので確認してみる。</p>

<figure class='code'><figcaption><span>data/airlines.txt</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>NAME                               IATA  ICAO
</span><span class='line'>1Time                              T6    RNX
</span><span class='line'>9 Air                              AQ    JYH
</span><span class='line'>ABSA Cargo                         M3    TUS
</span><span class='line'>ABX Air                            GB    ABX
</span><span class='line'>ACT Airlines                       9T    RUN
</span><span class='line'>AIS Airlines                       IS    PNX
</span><span class='line'>ALPI Eagles                        E8    ELG
</span><span class='line'>ASL Airlines France                5O    FPO
</span><span class='line'>ASL Airlines Ireland               AG    ABR
</span><span class='line'>ASL Airlines Switzerland           FT    FAT
</span><span class='line'>         :
</span><span class='line'>====&lt; 以下省略 &gt;====
</span><span class='line'>         :
</span></code></pre></td></tr></table></div></figure>


<p>CSV 形式で出力した場合は &ldquo;airlines.csv&rdquo; を確認してみる。</p>

<figure class='code'><figcaption><span>data/airlines.csv</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>NAME,IATA,ICAO
</span><span class='line'>&quot;1Time&quot;,T6,RNX
</span><span class='line'>&quot;9 Air&quot;,AQ,JYH
</span><span class='line'>&quot;ABSA Cargo&quot;,M3,TUS
</span><span class='line'>&quot;ABX Air&quot;,GB,ABX
</span><span class='line'>&quot;ACT Airlines&quot;,9T,RUN
</span><span class='line'>&quot;AIS Airlines&quot;,IS,PNX
</span><span class='line'>&quot;ALPI Eagles&quot;,E8,ELG
</span><span class='line'>&quot;ASL Airlines France&quot;,5O,FPO
</span><span class='line'>&quot;ASL Airlines Ireland&quot;,AG,ABR
</span><span class='line'>&quot;ASL Airlines Switzerland&quot;,FT,FAT
</span><span class='line'>         :
</span><span class='line'>====&lt; 以下省略 &gt;====
</span><span class='line'>         :
</span></code></pre></td></tr></table></div></figure>


<h3>4. 関係のある過去の記事</h3>

<ul>
<li><a href="http://komasaru.github.io/2014/03/27/ruby-noaa-weather-stations/" title="Ruby - NOAA（アメリカ海洋大気庁）気象観測所一覧！">Ruby - NOAA（アメリカ海洋大気庁）気象観測所一覧！</a></li>
<li><a href="http://komasaru.github.io/2014/03/28/bash-getting-a-weather-station-noaa/" title="Bash - NOAA 気象観測所検索！">Bash - NOAA 気象観測所検索！</a></li>
<li><a href="http://komasaru.github.io/2014/03/30/bash-getting-a-metar/" title="Bash - METAR 気象情報取得！">Bash - METAR 気象情報取得！</a></li>
<li><a href="http://komasaru.github.io/2016/01/28/ruby-getting-airport-list-from-fr24/" title="Ruby - Flightradar24 から空港情報一覧取得！">Ruby - Flightradar24 から空港情報一覧取得！</a></li>
</ul>


<h3>5. その他</h3>

<p>&ldquo;<a href="http://www.flightradar24.com" title="Flightradar24.com - Live flight tracker!">Flightradar24.com</a>&rdquo; が提供するリアルタイムの航空機の飛行情報も、調査に調査を重ねて取得できるようになりました。（後日紹介）</p>

<p>ちなみに、Web で期間を指定せずに検索するとリアルタイム飛行情報を取得する方法についてある程度はヒットしますが、その９割くらいは情報が古いです。</p>

<hr />

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby - Flightradar24 から空港情報一覧取得！]]></title>
    <link href="http://komasaru.github.io/blog/2016/02/06/ruby-getting-airport-list-from-fr24/"/>
    <updated>2016-02-06T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2016/02/06/ruby-getting-airport-list-from-fr24</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>航空機の運行状況をリアルタイムで確認できる Web サイト <a href="http://www.flightradar24.com" title="Flightradar24.com - Live flight tracker!">Flightradar24.com</a> に登録されている空港情報の一覧を Ruby で取得してみました。（と言っても、 JSON データを取得しているだけですが）</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>Ruby 2.2.4-p230 での作業を想定。</li>
<li>世界中の全空港を網羅している訳ではない。（例えば、島根県の隠岐空港や萩・石見空港のような規模の小さい(?)空港の情報は登録されていない）</li>
</ul>


<h3>1. Ruby スクリプトの作成</h3>

<p>難しいことはしていないので、説明は省略する。<br/>
ただ、悪質な Bot でないことを主張するために連絡先を User Agent に設定している。（伏字は適宜置き換えること）</p>

<figure class='code'><figcaption><span>fr24_airports.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#! /usr/local/bin/ruby</span>
</span><span class='line'><span class="c1"># coding: utf-8</span>
</span><span class='line'><span class="c1">#---------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c1">#= Flightradar24 空港情報取得</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># date          name            version</span>
</span><span class='line'><span class="c1"># 2015.12.20    mk-mode.com     1.00 新規作成</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># Copyright(C) 2015 mk-mode.com All Rights Reserved.</span>
</span><span class='line'><span class="c1">#---------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c1">#++</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;json&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;open-uri&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;timeout&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Fr24Airports</span>
</span><span class='line'>  <span class="no">URL</span>        <span class="o">=</span> <span class="s2">&quot;http://www.flightradar24.com/_json/airports.php&quot;</span>  <span class="c1"># 接続先 URL</span>
</span><span class='line'>  <span class="no">TIMEOUT</span>    <span class="o">=</span> <span class="mi">10</span>                                                 <span class="c1"># OpenURI 接続時のタイムアウト</span>
</span><span class='line'>  <span class="no">USER_AGENT</span> <span class="o">=</span> <span class="s2">&quot;xxxxxxx Bot (by Ruby/</span><span class="si">#{</span><span class="no">RUBY_VERSION</span><span class="si">}</span><span class="s2">, Administrator: xxxxxxxx@yyyyyyy.zzz)&quot;</span>
</span><span class='line'>                                                                  <span class="c1"># OpenURI 接続時の User-Agent, Mail Address</span>
</span><span class='line'>  <span class="no">FILE_PATH</span>  <span class="o">=</span> <span class="s2">&quot;./data/airports&quot;</span>                                  <span class="c1"># 保存ファイル</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">exec</span>
</span><span class='line'>    <span class="n">get_json</span>        <span class="c1"># JSON 取得</span>
</span><span class='line'>    <span class="n">save_file</span>       <span class="c1"># ファイル保存 (見やすく整形したものがよければこちら)</span>
</span><span class='line'>    <span class="c1">#save_file_csv  # ファイル保存（CSV 形式がよければこちら）</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>    <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;[</span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">class</span><span class="si">}</span><span class="s2">] </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">e</span><span class="o">.</span><span class="n">backtrace</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">tr</span><span class="o">|</span> <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="si">#{</span><span class="n">tr</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'>    <span class="nb">exit</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># JSON 取得</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">get_json</span>
</span><span class='line'>    <span class="n">str</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="n">timeout</span><span class="p">(</span><span class="no">TIMEOUT</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">str</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="no">URL</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;User-Agent&quot;</span> <span class="o">=&gt;</span> <span class="no">USER_AGENT</span><span class="p">})</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="vi">@json</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">[</span><span class="s2">&quot;rows&quot;</span><span class="o">].</span><span class="n">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">j</span><span class="o">|</span> <span class="o">[</span><span class="n">j</span><span class="o">[</span><span class="s2">&quot;country&quot;</span><span class="o">]</span><span class="p">,</span> <span class="n">j</span><span class="o">[</span><span class="s2">&quot;iata&quot;</span><span class="o">]]</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>    <span class="k">raise</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ファイル保存</span>
</span><span class='line'>  <span class="c1"># * 最大文字数（country: 32, name: 63）</span>
</span><span class='line'>  <span class="c1"># * name の末尾に改行コードが含まれていることがあるので chomp している</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">save_file</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">FILE_PATH</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>      <span class="n">str</span> <span class="o">=</span>  <span class="s2">&quot;COUNTRY&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">27</span> <span class="o">+</span> <span class="s2">&quot;IATA  ICAO  NAME&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">68</span>
</span><span class='line'>      <span class="n">str</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;LAT          LON    ALT&quot;</span>
</span><span class='line'>      <span class="n">f</span><span class="o">.</span><span class="n">puts</span> <span class="n">str</span>
</span><span class='line'>      <span class="vi">@json</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">j</span><span class="o">|</span>
</span><span class='line'>        <span class="n">str</span> <span class="o">=</span>  <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;%-32s  %3s   %4s&quot;</span><span class="p">,</span> <span class="n">j</span><span class="o">[</span><span class="s2">&quot;country&quot;</span><span class="o">]</span><span class="p">,</span> <span class="n">j</span><span class="o">[</span><span class="s2">&quot;iata&quot;</span><span class="o">]</span><span class="p">,</span> <span class="n">j</span><span class="o">[</span><span class="s2">&quot;icao&quot;</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>        <span class="n">str</span> <span class="o">&lt;&lt;</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;  %-63s&quot;</span><span class="p">,</span> <span class="n">j</span><span class="o">[</span><span class="s2">&quot;name&quot;</span><span class="o">].</span><span class="n">chomp</span><span class="p">)</span>
</span><span class='line'>        <span class="n">str</span> <span class="o">&lt;&lt;</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;  %10.6f&quot;</span><span class="p">,</span> <span class="n">j</span><span class="o">[</span><span class="s2">&quot;lat&quot;</span><span class="o">].</span><span class="n">to_f</span><span class="p">)</span>
</span><span class='line'>        <span class="n">str</span> <span class="o">&lt;&lt;</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;  %11.6f&quot;</span><span class="p">,</span> <span class="n">j</span><span class="o">[</span><span class="s2">&quot;lon&quot;</span><span class="o">].</span><span class="n">to_f</span><span class="p">)</span>
</span><span class='line'>        <span class="n">str</span> <span class="o">&lt;&lt;</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;  %5d&quot;</span><span class="p">,</span> <span class="n">j</span><span class="o">[</span><span class="s2">&quot;alt&quot;</span><span class="o">].</span><span class="n">to_i</span><span class="p">)</span>
</span><span class='line'>        <span class="n">f</span><span class="o">.</span><span class="n">puts</span> <span class="n">str</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>    <span class="k">raise</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ファイル保存（CSV 形式）</span>
</span><span class='line'>  <span class="c1"># * 最大文字数（country: 32, name: 63）</span>
</span><span class='line'>  <span class="c1"># * name の末尾に改行コードが含まれていることがあるので chomp している</span>
</span><span class='line'>  <span class="c1"># * カンマが含まれる可能性のある country, name のみ &quot;&quot; でくくっている</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">save_file_csv</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">FILE_PATH</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>      <span class="n">f</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;COUNTRY,IATA,ICAO,NAME,LAT,LON,ALT&quot;</span>
</span><span class='line'>      <span class="vi">@json</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">j</span><span class="o">|</span>
</span><span class='line'>        <span class="n">str</span> <span class="o">=</span>  <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="si">#{</span><span class="n">j</span><span class="o">[</span><span class="s2">&quot;country&quot;</span><span class="o">]</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">,</span><span class="si">#{</span><span class="n">j</span><span class="o">[</span><span class="s2">&quot;iata&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">,</span><span class="si">#{</span><span class="n">j</span><span class="o">[</span><span class="s2">&quot;icao&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">,</span><span class="se">\&quot;</span><span class="si">#{</span><span class="n">j</span><span class="o">[</span><span class="s2">&quot;name&quot;</span><span class="o">].</span><span class="n">chomp</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">,&quot;</span>
</span><span class='line'>        <span class="n">str</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">j</span><span class="o">[</span><span class="s2">&quot;lat&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">,</span><span class="si">#{</span><span class="n">j</span><span class="o">[</span><span class="s2">&quot;lon&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">,</span><span class="si">#{</span><span class="n">j</span><span class="o">[</span><span class="s2">&quot;alt&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>        <span class="n">f</span><span class="o">.</span><span class="n">puts</span> <span class="n">str</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>    <span class="k">raise</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Fr24Airports</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">exec</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://gist.github.com/komasaru/75bd0abfbe95814c50bb" title="Gist - Ruby script to get a airport list from Flightradar24.">Gist - Ruby script to get a airport list from Flightradar24.</a></li>
</ul>


<h3>2. Ruby スクリプトの実行</h3>

<p>Ruby スクリプトと同じディレクトリ内に &ldquo;data&rdquo; ディレクトリを作成後、以下を実行。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ ./fr24_airports.rb
</span></code></pre></td></tr></table></div></figure>


<h3>3. データの確認</h3>

<p>&ldquo;data&rdquo; ディレクトリ内に &ldquo;airports.txt&rdquo; が作成されるので確認してみる。</p>

<figure class='code'><figcaption><span>data/airports.txt</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>COUNTRY                           IATA  ICAO  NAME                                                                    LAT          LON    ALT
</span><span class='line'>Afghanistan                       KBL   OAKB  Kabul International Airport                                       34.565842    69.212410   5871
</span><span class='line'>Afghanistan                       MZR   OAMS  Mazar-I-Sharif International Airport                              36.706909    67.209671   1284
</span><span class='line'>Albania                           TIA   LATI  Tirana International Airport                                      41.414742    19.720560    126
</span><span class='line'>Algeria                           AAE   DABB  Annaba Rabah Bitat Airport                                        36.822220     7.809167     16
</span><span class='line'>Algeria                           ALG   DAAG  Algiers Houari Boumediene Airport                                 36.691010     3.215408     82
</span><span class='line'>Algeria                           BJA   DAAE  Bejaia Soummam Airport                                            36.711990     5.069922     20
</span><span class='line'>Algeria                           CFK   DAOI  Chlef International Airport                                       36.212223     1.331667    469
</span><span class='line'>Algeria                           CZL   DABC  Constantine Mohamed Boudiaf International Airport                 36.276020     6.620386   2316
</span><span class='line'>Algeria                           GJL   DAAV  Jijel Ferhat Abbas Airport                                        36.795132     5.873608     36
</span><span class='line'>Algeria                           ORN   DAOO  Oran Es Senia Airport                                             35.623852    -0.621180    299
</span><span class='line'>         :
</span><span class='line'>====&lt; 以下省略 &gt;====
</span><span class='line'>         :
</span></code></pre></td></tr></table></div></figure>


<p>CSV 形式で出力した場合は &ldquo;airports.csv&rdquo; を確認してみる。</p>

<figure class='code'><figcaption><span>data/airports.csv</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>COUNTRY,IATA,ICAO,NAME,LAT,LON,ALT
</span><span class='line'>&quot;Afghanistan&quot;,KBL,OAKB,&quot;Kabul International Airport&quot;,34.565842,69.212410,5871
</span><span class='line'>&quot;Afghanistan&quot;,MZR,OAMS,&quot;Mazar-I-Sharif International Airport&quot;,36.706909,67.209671,1284
</span><span class='line'>&quot;Albania&quot;,TIA,LATI,&quot;Tirana International Airport&quot;,41.414742,19.720560,126
</span><span class='line'>&quot;Algeria&quot;,AAE,DABB,&quot;Annaba Rabah Bitat Airport&quot;,36.822220,7.809167,16
</span><span class='line'>&quot;Algeria&quot;,ALG,DAAG,&quot;Algiers Houari Boumediene Airport&quot;,36.691010,3.215408,82
</span><span class='line'>&quot;Algeria&quot;,BJA,DAAE,&quot;Bejaia Soummam Airport&quot;,36.711990,5.069922,20
</span><span class='line'>&quot;Algeria&quot;,CFK,DAOI,&quot;Chlef International Airport&quot;,36.212223,1.331667,469
</span><span class='line'>&quot;Algeria&quot;,CZL,DABC,&quot;Constantine Mohamed Boudiaf International Airport&quot;,36.276020,6.620386,2316
</span><span class='line'>&quot;Algeria&quot;,GJL,DAAV,&quot;Jijel Ferhat Abbas Airport&quot;,36.795132,5.873608,36
</span><span class='line'>&quot;Algeria&quot;,ORN,DAOO,&quot;Oran Es Senia Airport&quot;,35.623852,-0.621180,299
</span><span class='line'>         :
</span><span class='line'>====&lt; 以下省略 &gt;====
</span><span class='line'>         :
</span></code></pre></td></tr></table></div></figure>


<h3>4. 関係のある過去の記事</h3>

<ul>
<li><a href="http://komasaru.github.io/2014/03/27/ruby-noaa-weather-stations/" title="Ruby - NOAA（アメリカ海洋大気庁）気象観測所一覧！">Ruby - NOAA（アメリカ海洋大気庁）気象観測所一覧！</a></li>
<li><a href="http://komasaru.github.io/2014/03/28/bash-getting-a-weather-station-noaa/" title="Bash - NOAA 気象観測所検索！">Bash - NOAA 気象観測所検索！</a></li>
<li><a href="http://komasaru.github.io/2014/03/30/bash-getting-a-metar/" title="Bash - METAR 気象情報取得！">Bash - METAR 気象情報取得！</a></li>
</ul>


<h3>5. その他</h3>

<p>&ldquo;<a href="http://www.flightradar24.com" title="Flightradar24.com - Live flight tracker!">Flightradar24.com</a>&rdquo; が提供するリアルタイムの航空機の飛行情報も、調査に調査を重ねて取得できるようになりました。（後日紹介）</p>

<p>ちなみに、Web 検索するとリアルタイム飛行情報を取得する方法についてある程度はヒットしますが、その９割くらいは情報が古いです。</p>

<hr />

<p>全ての空港が網羅されていればうれしいのですが。。。</p>

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux Mint - Mroonga インストール（by ソースビルド）！]]></title>
    <link href="http://komasaru.github.io/blog/2016/02/02/linuxmint-mroonga-installation-by-src/"/>
    <updated>2016-02-02T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2016/02/02/linuxmint-mroonga-installation-by-src</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>Linux Mint 上の MySQL 5.7 に全文検索エンジン Groonga の機能を実現するストレージエンジン Mroonga をソースをビルドしてインストールする方法についてです。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>Linux Mint 17.2(64bit) での作業を想定。</li>
<li>当記事執筆時点で最新の Mroonga 5.10 をインストールする。</li>
<li>Groonga 5.1.0 がインストール済みであることを想定。<br/>
（参照「<a href="http://komasaru.github.io/2015/08/09/linux-mint-groonga-installation-by-src/" title="Linux Mint - Groonga インストール（by ソースビルド）！">Linux Mint - Groonga インストール（by ソースビルド）！</a>」）<br/>
※ソースビルでなく PPA リポジトリからインストールしてもよいだろう（参照「<a href="http://groonga.org/ja/docs/install/ubuntu.html" title="2.4. Ubuntu — Groonga v5.1.0ドキュメント">2.4. Ubuntu — Groonga v5.1.0ドキュメント</a>」）</li>
<li>MySQL 5.7.10 をソースをビルドしてインストールしていること。（Mroonga のビルドに MySQL のソースが必要なため）<br/>
（参照「<a href="" title="Linux Mint - MySQL 5.7 インストール（by ソースビルド）！">Linux Mint - MySQL 5.7 インストール（by ソースビルド）！</a>」）</li>
<li>MySQL 5.7.10 は &ldquo;/usr/local/mysql&rdquo; ディレクトリにインストールされていることを想定。</li>
<li>MySQL 5.7.10 のインストールに使用したソースは &ldquo;~/mysql-5.7.10&rdquo; ディレクトリに存在することを想定。</li>
<li>一般ユーザでの作業を想定。</li>
<li>環境の相違等のために以下の方法ではうまく行かないこともあるだろう。<br/>
ログを確認して適宜対処すること。</li>
</ul>


<h3>1. 必要ライブラリのインストール</h3>

<p>必要なライブラリ groonga-normalizer-mysql をインストールする。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo apt-get -y install software-properties-common
</span><span class='line'>$ sudo add-apt-repository -y universe
</span><span class='line'>$ sudo add-apt-repository -y ppa:groonga/ppa
</span><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get -y install groonga-normalizer-mysql
</span></code></pre></td></tr></table></div></figure>


<p>（groonga-normalizer-mysql を Apt インストールするなら Groonga 自体も Apt インストールしてもよかったかもしれないが、当方は既に Groonga をソースビルドでインストール済み）</p>

<h3>2. ソースの取得</h3>

<p>アーカイブファイルを取得、展開後、ディレクトリを移動しておく。（ダウンロード先は一般ユーザホームディレクトリとする）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ cd ~/
</span><span class='line'>$ wget http://packages.groonga.org/source/mroonga/mroonga-5.10.tar.gz
</span><span class='line'>$ tar zxvf mroonga-5.10.tar.gz
</span><span class='line'>$ cd mroonga-5.10
</span></code></pre></td></tr></table></div></figure>


<h3>3. Makefile の生成</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ ./configure \
</span><span class='line'>--with-mysql-source=/home/masaru/mysql-5.7.10 \
</span><span class='line'>--with-mysql-build=/home/masaru/mysql-5.7.10 \
</span><span class='line'>--with-mysql-config=/usr/local/mysql/bin/mysql_config
</span></code></pre></td></tr></table></div></figure>


<h3>4. ビルド</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ make
</span></code></pre></td></tr></table></div></figure>


<h3>5. インストール</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo make install
</span></code></pre></td></tr></table></div></figure>


<h3>6. MySQL への Mroonga プラグインの適用</h3>

<p>MySQL サーバが起動していることを確認してから以下を実行する。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ mysql -u root -p &lt; /usr/local/share/mroonga/install.sql
</span></code></pre></td></tr></table></div></figure>


<p><code>... does not exist</code> のメッセージが出力されるかもしれないが問題ない。（おそらく）</p>

<h3>7. Mroonga 導入の確認</h3>

<p>MySQL サーバに root でログインして確認してみる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>mysql&gt; SHOW ENGINES;
</span><span class='line'>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
</span><span class='line'>| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |
</span><span class='line'>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
</span><span class='line'>| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |
</span><span class='line'>| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |
</span><span class='line'>| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |
</span><span class='line'>| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |
</span><span class='line'>| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |
</span><span class='line'>| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |
</span><span class='line'>| Mroonga            | YES     | CJK-ready fulltext search, column store                        | NO           | NO   | NO         |
</span><span class='line'>| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |
</span><span class='line'>| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |
</span><span class='line'>| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |
</span><span class='line'>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
</span><span class='line'>10 rows in set (0.00 sec)
</span></code></pre></td></tr></table></div></figure>


<p><code>Mroonga</code> 行が存在することを確認する。</p>

<p>その他、 Mroonga の簡単な使用方法は以下の過去記事等を参照。</p>

<ul>
<li><a href="http://komasaru.github.io/2015/08/21/mariadb-mroonga-installation" title="MariaDB 10.0.x - Mroonga プラグインの有効化！">MariaDB 10.0.x - Mroonga プラグインの有効化！</a></li>
</ul>


<h3>8. 参考サイト</h3>

<ul>
<li><a href="http://mroonga.org/ja/docs/install/others.html" title="2.7. その他 — Mroonga v5.10 documentation">2.7. その他 — Mroonga v5.10 documentation</a></li>
</ul>


<hr />

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2016年01月 - OS・ブラウザ別アクセス状況！【自動集計】]]></title>
    <link href="http://komasaru.github.io/blog/2016/02/01/blog-access/"/>
    <updated>2016-02-01T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2016/02/01/blog-access</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>02月になりましたので、先月01月分の当ブログアクセス状況を公開します。</p>

<!--more-->


<h4>1. アクセスをOS別に集計</h4>

<table class="blog-access">
  <tr>
    <th>OS</th>
    <th>PageViews</th>
    <th>比率(%)</th>
  </tr>
  <tr>
    <td>Mac OS</td>
    <td class="blog-access-pv">30,885</td>
    <td class="blog-access-rate">59.7770</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td class="blog-access-pv">17,034</td>
    <td class="blog-access-rate">32.9688</td>
  </tr>
  <tr>
    <td>Linux</td>
    <td class="blog-access-pv">1,819</td>
    <td class="blog-access-rate">3.5206</td>
  </tr>
  <tr>
    <td>Ubuntu Linux</td>
    <td class="blog-access-pv">1,429</td>
    <td class="blog-access-rate">2.7658</td>
  </tr>
  <tr>
    <td>unknown</td>
    <td class="blog-access-pv">302</td>
    <td class="blog-access-rate">0.5845</td>
  </tr>
  <tr>
    <td>FreeBSD</td>
    <td class="blog-access-pv">74</td>
    <td class="blog-access-rate">0.1432</td>
  </tr>
  <tr>
    <td>Fedora Linux</td>
    <td class="blog-access-pv">66</td>
    <td class="blog-access-rate">0.1277</td>
  </tr>
  <tr>
    <td>RedHat Linux</td>
    <td class="blog-access-pv">15</td>
    <td class="blog-access-rate">0.0290</td>
  </tr>
  <tr>
    <td>Android</td>
    <td class="blog-access-pv">15</td>
    <td class="blog-access-rate">0.0290</td>
  </tr>
  <tr>
    <td>iPhone OS</td>
    <td class="blog-access-pv">12</td>
    <td class="blog-access-rate">0.0232</td>
  </tr>
  <tr>
    <td>CentOS Linux</td>
    <td class="blog-access-pv">9</td>
    <td class="blog-access-rate">0.0174</td>
  </tr>
  <tr>
    <td>Solaris</td>
    <td class="blog-access-pv">3</td>
    <td class="blog-access-rate">0.0058</td>
  </tr>
  <tr>
    <td>NetBSD</td>
    <td class="blog-access-pv">2</td>
    <td class="blog-access-rate">0.0039</td>
  </tr>
  <tr>
    <td>Debian GNU/Linux</td>
    <td class="blog-access-pv">1</td>
    <td class="blog-access-rate">0.0019</td>
  </tr>
  <tr>
    <td>SuSE Linux</td>
    <td class="blog-access-pv">1</td>
    <td class="blog-access-rate">0.0019</td>
  </tr>
  <tr>
    <td class="blog-access-total-label">合　計</td>
    <td class="blog-access-pv">51,642</td>
    <td class="blog-access-rate">100.0000</td>
  </tr>
</table>


<h4>2. アクセスをOS・バージョン別に集計（上位20件）</h4>

<table class="blog-access">
  <tr>
    <th>OS</th>
    <th>Version</th>
    <th>PageViews</th>
    <th>比率(%)</th>
  </tr>
  <tr>
    <td>Mac OS</td>
    <td>X</td>
    <td class="blog-access-pv">30,879</td>
    <td class="blog-access-rate">59.7654</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>NT</td>
    <td class="blog-access-pv">15,560</td>
    <td class="blog-access-rate">30.1159</td>
  </tr>
  <tr>
    <td>Linux</td>
    <td>unknown</td>
    <td class="blog-access-pv">1,802</td>
    <td class="blog-access-rate">3.4877</td>
  </tr>
  <tr>
    <td>Ubuntu Linux</td>
    <td>unknown</td>
    <td class="blog-access-pv">1,420</td>
    <td class="blog-access-rate">2.7484</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>7</td>
    <td class="blog-access-pv">472</td>
    <td class="blog-access-rate">0.9135</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>7 64 bit</td>
    <td class="blog-access-pv">377</td>
    <td class="blog-access-rate">0.7297</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>XP</td>
    <td class="blog-access-pv">362</td>
    <td class="blog-access-rate">0.7006</td>
  </tr>
  <tr>
    <td>unknown</td>
    <td>unknown</td>
    <td class="blog-access-pv">301</td>
    <td class="blog-access-rate">0.5826</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>Vista</td>
    <td class="blog-access-pv">187</td>
    <td class="blog-access-rate">0.3619</td>
  </tr>
  <tr>
    <td>FreeBSD</td>
    <td>unknown</td>
    <td class="blog-access-pv">74</td>
    <td class="blog-access-rate">0.1432</td>
  </tr>
  <tr>
    <td>Fedora Linux</td>
    <td>unknown</td>
    <td class="blog-access-pv">62</td>
    <td class="blog-access-rate">0.1200</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>2000</td>
    <td class="blog-access-pv">44</td>
    <td class="blog-access-rate">0.0852</td>
  </tr>
  <tr>
    <td>Linux</td>
    <td></td>
    <td class="blog-access-pv">13</td>
    <td class="blog-access-rate">0.0252</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>8 64 bit</td>
    <td class="blog-access-pv">11</td>
    <td class="blog-access-rate">0.0213</td>
  </tr>
  <tr>
    <td>Ubuntu Linux</td>
    <td></td>
    <td class="blog-access-pv">9</td>
    <td class="blog-access-rate">0.0174</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>Server 2003</td>
    <td class="blog-access-pv">9</td>
    <td class="blog-access-rate">0.0174</td>
  </tr>
  <tr>
    <td>Android</td>
    <td>2.3.6</td>
    <td class="blog-access-pv">6</td>
    <td class="blog-access-rate">0.0116</td>
  </tr>
  <tr>
    <td>iPhone OS</td>
    <td>4_3_2</td>
    <td class="blog-access-pv">6</td>
    <td class="blog-access-rate">0.0116</td>
  </tr>
  <tr>
    <td>RedHat Linux</td>
    <td>3.6-1.el5</td>
    <td class="blog-access-pv">6</td>
    <td class="blog-access-rate">0.0116</td>
  </tr>
  <tr>
    <td>Mac OS</td>
    <td>X PowerPC</td>
    <td class="blog-access-pv">6</td>
    <td class="blog-access-rate">0.0116</td>
  </tr>
  <tr>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
  </tr>
  <tr>
    <td class="blog-access-total-label">合　計</td>
    <td> </td>
    <td class="blog-access-pv">51,642</td>
    <td class="blog-access-rate">100.0000</td>
  </tr>
</table>


<h4>3. アクセスをブラウザ別に集計</h4>

<table class="blog-access">
  <tr>
    <th>ブラウザ</th>
    <th>PageViews</th>
    <th>比率(%)</th>
  </tr>
  <tr>
    <td>Safari</td>
    <td class="blog-access-pv">29,797</td>
    <td class="blog-access-rate">57.6712</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td class="blog-access-pv">11,853</td>
    <td class="blog-access-rate">22.9411</td>
  </tr>
  <tr>
    <td>Mozilla</td>
    <td class="blog-access-pv">7,654</td>
    <td class="blog-access-rate">14.8141</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td class="blog-access-pv">1,259</td>
    <td class="blog-access-rate">2.4368</td>
  </tr>
  <tr>
    <td>Debian IceWeasel</td>
    <td class="blog-access-pv">551</td>
    <td class="blog-access-rate">1.0664</td>
  </tr>
  <tr>
    <td>Opera</td>
    <td class="blog-access-pv">333</td>
    <td class="blog-access-rate">0.6445</td>
  </tr>
  <tr>
    <td>Netscape Navigator</td>
    <td class="blog-access-pv">116</td>
    <td class="blog-access-rate">0.2245</td>
  </tr>
  <tr>
    <td>Mozilla SeaMonkey</td>
    <td class="blog-access-pv">28</td>
    <td class="blog-access-rate">0.0542</td>
  </tr>
  <tr>
    <td>Chrome</td>
    <td class="blog-access-pv">24</td>
    <td class="blog-access-rate">0.0465</td>
  </tr>
  <tr>
    <td>Epiphany</td>
    <td class="blog-access-pv">18</td>
    <td class="blog-access-rate">0.0348</td>
  </tr>
  <tr>
    <td>iPhone</td>
    <td class="blog-access-pv">12</td>
    <td class="blog-access-rate">0.0232</td>
  </tr>
  <tr>
    <td>Konqueror</td>
    <td class="blog-access-pv">8</td>
    <td class="blog-access-rate">0.0155</td>
  </tr>
  <tr>
    <td>Unknown</td>
    <td class="blog-access-pv">7</td>
    <td class="blog-access-rate">0.0135</td>
  </tr>
  <tr>
    <td>PHP</td>
    <td class="blog-access-pv">5</td>
    <td class="blog-access-rate">0.0097</td>
  </tr>
  <tr>
    <td>Namoroka</td>
    <td class="blog-access-pv">1</td>
    <td class="blog-access-rate">0.0019</td>
  </tr>
  <tr>
    <td>SRWare Iron</td>
    <td class="blog-access-pv">1</td>
    <td class="blog-access-rate">0.0019</td>
  </tr>
  <tr>
    <td class="blog-access-total-label">合　計</td>
    <td class="blog-access-pv">51,642</td>
    <td class="blog-access-rate">100.0000</td>
  </tr>
</table>


<h4>4. アクセスをブラウザ・バージョン別に集計（上位20件）</h4>

<table class="blog-access">
  <tr>
    <th>ブラウザ</th>
    <th>Version</th>
    <th>PageViews</th>
    <th>比率(%)</th>
  </tr>
  <tr>
    <td>Safari</td>
    <td>537.36</td>
    <td class="blog-access-pv">22,909</td>
    <td class="blog-access-rate">44.3397</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>43.0</td>
    <td class="blog-access-pv">8,577</td>
    <td class="blog-access-rate">16.6005</td>
  </tr>
  <tr>
    <td>Mozilla</td>
    <td>11.0</td>
    <td class="blog-access-pv">7,653</td>
    <td class="blog-access-rate">14.8122</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>9537.53</td>
    <td class="blog-access-pv">2,651</td>
    <td class="blog-access-rate">5.1309</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>601.1</td>
    <td class="blog-access-pv">1,262</td>
    <td class="blog-access-rate">2.4426</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>38.0</td>
    <td class="blog-access-pv">1,122</td>
    <td class="blog-access-rate">2.1716</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>601.3.9</td>
    <td class="blog-access-pv">944</td>
    <td class="blog-access-rate">1.8271</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>44.0</td>
    <td class="blog-access-pv">548</td>
    <td class="blog-access-rate">1.0606</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>600.1.4</td>
    <td class="blog-access-pv">533</td>
    <td class="blog-access-rate">1.0316</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td>10.0</td>
    <td class="blog-access-pv">413</td>
    <td class="blog-access-rate">0.7993</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td>9.0</td>
    <td class="blog-access-pv">343</td>
    <td class="blog-access-rate">0.6639</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>534.30</td>
    <td class="blog-access-pv">318</td>
    <td class="blog-access-rate">0.6155</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>42.0</td>
    <td class="blog-access-pv">316</td>
    <td class="blog-access-rate">0.6116</td>
  </tr>
  <tr>
    <td>Opera</td>
    <td>9.80</td>
    <td class="blog-access-pv">293</td>
    <td class="blog-access-rate">0.5671</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>601.4.4</td>
    <td class="blog-access-pv">289</td>
    <td class="blog-access-rate">0.5594</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td>8.0</td>
    <td class="blog-access-pv">287</td>
    <td class="blog-access-rate">0.5555</td>
  </tr>
  <tr>
    <td>Debian IceWeasel</td>
    <td>38.5.0</td>
    <td class="blog-access-pv">275</td>
    <td class="blog-access-rate">0.5323</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td>7.0</td>
    <td class="blog-access-pv">204</td>
    <td class="blog-access-rate">0.3948</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>601.1.46</td>
    <td class="blog-access-pv">161</td>
    <td class="blog-access-rate">0.3116</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>41.0</td>
    <td class="blog-access-pv">147</td>
    <td class="blog-access-rate">0.2845</td>
  </tr>
  <tr>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
  </tr>
  <tr>
    <td class="blog-access-total-label">合　計</td>
    <td> </td>
    <td class="blog-access-pv">51,642</td>
    <td class="blog-access-rate">100.0000</td>
  </tr>
</table>


<hr />

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux Mint - MySQL 5.7 インストール（by ソースビルド）！]]></title>
    <link href="http://komasaru.github.io/blog/2016/01/28/linuxmint-mysql-57-installation-by-src/"/>
    <updated>2016-01-28T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2016/01/28/linuxmint-mysql-57-installation-by-src</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>MySQL 5.7 系の最新版をソースをビルドして Linux Mint 17.2 にインストールする方法についてです。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>Linux Mint 17.2(64bit) での作業を想定。</li>
<li>当記事執筆時点で最新の MySQL 5.7.10 をソースをビルドしてインストールする。</li>
<li>マシン搭載メモリは 4GB を想定。</li>
<li>一般ユーザでの作業を想定。</li>
<li>環境の相違等のために以下の方法ではうまく行かないこともあるだろう。<br/>
ログを確認して適宜対処すること。</li>
</ul>


<h3>1. 必要パッケージの準備</h3>

<p>以下の必要なパッケージが未インストールならインストールしておく。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo apt-get install wget cmake g++ bison libncurses5-dev
</span></code></pre></td></tr></table></div></figure>


<h3>2. MySQL ユーザ・グループの作成</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo groupadd mysql
</span><span class='line'>$ sudo useradd -r -g mysql -s /bin/false mysql
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>useradd</code> コマンドの <code>-r</code> は、システムアカウントを作成するオプション。</li>
<li><code>useradd</code> コマンドの <code>-s /bin/false</code> は、ログインシェルを無効にするオプション。</li>
</ul>


<h3>3. ソースの取得</h3>

<p>アーカイブファイルを取得、展開後、ディレクトリを移動しておく。（ダウンロード先は一般ユーザホームディレクトリとする）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ cd ~/
</span><span class='line'>$ wget http://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.10.tar.gz
</span><span class='line'>$ tar zxvf mysql-5.7.10.tar.gz
</span><span class='line'>$ cd mysql-5.7.10
</span></code></pre></td></tr></table></div></figure>


<h3>4. Makefile の生成</h3>

<p><code>cmake</code> コマンドで Makefile を生成する。（よくある <code>configure</code> コマンドと同様の位置付け）</p>

<p>オプションは、デフォルト値とが異なる値を設定したいものだけを指定する。<br/>
（MySQL 5.7 からは C++ Boost ライブラリが必要なので <code>DOWNLOAD_BOOST</code> と <code>WITH_BOOST</code> は必須）<br/>
※デフォルト値は<a href="http://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html" title="MySQL :: MySQL 5.7 Reference Manual :: 2.9.4 MySQL Source-Configuration Options">こちら</a>を参照。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo cmake . \
</span><span class='line'> -DMYSQL_UNIX_ADDR=/var/lib/mysql/mysqld.sock \
</span><span class='line'> -DMYSQL_DATADIR=/var/lib/mysql \
</span><span class='line'> -DDEFAULT_CHARSET=utf8 \
</span><span class='line'> -DDEFAULT_COLLATION=utf8_general_ci \
</span><span class='line'> -DDOWNLOAD_BOOST=1 \
</span><span class='line'> -DWITH_BOOST=/usr/local/mysql
</span></code></pre></td></tr></table></div></figure>


<p><code>cmake</code> が途中で失敗した等の理由で <code>cmake</code> を再実行する場合は、キャッシュをクリアしてから再実行する。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo rm CMakeCache.txt
</span></code></pre></td></tr></table></div></figure>


<h3>5. ビルド</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo make
</span></code></pre></td></tr></table></div></figure>


<p>（時間がかかる）</p>

<h3>6. インストール</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo make install
</span></code></pre></td></tr></table></div></figure>


<h3>7. 環境変数 PATH の設定</h3>

<p>（当方は、 &ldquo;~/.profile&rdquo; で設定）</p>

<figure class='code'><figcaption><span>~/.profile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/mysql/bin
</span><span class='line'><span class="nb">export </span>PATH
</span></code></pre></td></tr></table></div></figure>


<p>そして、即時反映。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ source ~/.profile
</span></code></pre></td></tr></table></div></figure>


<h3>8. インストールの確認</h3>

<p>MySQL サーバとクライアントのバージョンを確認してみる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ mysqld --version
</span><span class='line'>mysqld  Ver 5.7.10 for Linux on x86_64 (Source distribution)
</span><span class='line'>
</span><span class='line'>$ mysql --version
</span><span class='line'>mysql  Ver 14.14 Distrib 5.7.10, for Linux (x86_64) using  EditLine wrapper
</span></code></pre></td></tr></table></div></figure>


<h3>9. 設定ファイルの編集</h3>

<p>環境に合わせて、 &ldquo;/etc/my.cnf&rdquo; を編集する。（サンプルは &ldquo;/usr/local/mysql/support-files&rdquo; ディレクトリ内にある）<br/>
（以下は当方の取り急ぎの例。<strong>実際に運用する際は綿密に検討して設定すること</strong>）</p>

<figure class='code'><figcaption><span>/etc/my.cnf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># For advice on how to change settings please see</span>
</span><span class='line'><span class="c"># http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mysqld<span class="o">]</span>
</span><span class='line'><span class="c"># ==== Basis</span>
</span><span class='line'>server-id                 <span class="o">=</span> <span class="m">1</span>  <span class="c"># レプリケーション時に使用 (1 〜 2^32 - 1)</span>
</span><span class='line'><span class="nv">user</span>                      <span class="o">=</span> mysql
</span><span class='line'><span class="nv">datadir</span>                   <span class="o">=</span> /var/lib/mysql
</span><span class='line'><span class="nv">socket</span>                    <span class="o">=</span> /var/lib/mysql/mysql.sock
</span><span class='line'>pid-file                  <span class="o">=</span> /var/run/mysqld/mysqld.pid
</span><span class='line'><span class="nv">performance_schema</span>        <span class="o">=</span> OFF     <span class="c"># Default: ON</span>
</span><span class='line'>skip_external_locking
</span><span class='line'><span class="nv">sql_mode</span>                  <span class="o">=</span> STRICT_TRANS_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION
</span><span class='line'><span class="nv">character_set_server</span>      <span class="o">=</span> utf8mb4
</span><span class='line'>collation-server          <span class="o">=</span> utf8mb4_general_ci
</span><span class='line'>skip-character-set-client-handshake
</span><span class='line'><span class="nv">default_storage_engine</span>    <span class="o">=</span> InnoDB  <span class="c"># Default: InnoDB</span>
</span><span class='line'><span class="nv">default_password_lifetime</span> <span class="o">=</span> <span class="m">3650</span>    <span class="c"># Default: 360</span>
</span><span class='line'><span class="nv">lc_messages</span>               <span class="o">=</span> en_US   <span class="c"># Default: en_US</span>
</span><span class='line'><span class="nv">lc_messages_dir</span>           <span class="o">=</span> /usr/local/mysql/share
</span><span class='line'>
</span><span class='line'><span class="c"># ==== Network, Connection</span>
</span><span class='line'><span class="nv">port</span>                 <span class="o">=</span> 3306
</span><span class='line'><span class="nb">bind</span>-address         <span class="o">=</span> 0.0.0.0   <span class="c"># 127.0.0.1</span>
</span><span class='line'><span class="nv">max_connections</span>      <span class="o">=</span> <span class="m">100</span>       <span class="c"># Default: 151</span>
</span><span class='line'><span class="nv">max_connect_errors</span>   <span class="o">=</span> <span class="m">100</span>       <span class="c"># Default: 100</span>
</span><span class='line'><span class="nv">max_user_connections</span> <span class="o">=</span> <span class="m">0</span>         <span class="c"># Default: 0</span>
</span><span class='line'><span class="nv">wait_timeout</span>         <span class="o">=</span> <span class="m">3600</span>      <span class="c"># Default: 28800 (通常時:300, データインポート時:3600程度)</span>
</span><span class='line'><span class="nv">interactive_timeout</span>  <span class="o">=</span> <span class="m">3600</span>      <span class="c"># Default: 28800</span>
</span><span class='line'><span class="nv">connect_timeout</span>      <span class="o">=</span> <span class="m">30</span>        <span class="c"># Default: 10</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ==== Buffer</span>
</span><span class='line'><span class="nv">max_allowed_packet</span>      <span class="o">=</span> 32M    <span class="c"># Default: 1M (通常時:32M程度, データインポート時:128M程度)</span>
</span><span class='line'><span class="nv">thread_cache_size</span>       <span class="o">=</span> <span class="m">40</span>     <span class="c"># Default: 0 (max_connections の 1/3 程度?)</span>
</span><span class='line'><span class="nv">table_open_cache</span>        <span class="o">=</span> <span class="m">400</span>    <span class="c"># Default: 400 (同時接続数 * テーブル数?)</span>
</span><span class='line'><span class="nv">table_definition_cache</span>  <span class="o">=</span> <span class="m">400</span>    <span class="c"># Default: -1:autosized = 400 + (table_open_cache / 2)</span>
</span><span class='line'><span class="nv">tmp_table_size</span>          <span class="o">=</span> 16M    <span class="c"># Default: System 依存 (for Memory, &lt;= max_heap_table_size)</span>
</span><span class='line'><span class="nv">max_heap_table_size</span>     <span class="o">=</span> 32M    <span class="c"># Default: 16M         (for Memory, &gt;= tmp_table_size)</span>
</span><span class='line'><span class="nv">sort_buffer_size</span>        <span class="o">=</span> 4M     <span class="c"># Default: 2M (通常時:4M, ALTER TABLE 時:64M)</span>
</span><span class='line'><span class="nv">read_buffer_size</span>        <span class="o">=</span> 4M     <span class="c"># Default: 128K</span>
</span><span class='line'><span class="nv">read_rnd_buffer_size</span>    <span class="o">=</span> 4M     <span class="c"># Default: 256K</span>
</span><span class='line'><span class="nv">join_buffer_size</span>        <span class="o">=</span> 4M     <span class="c"># Default: 128K</span>
</span><span class='line'><span class="nv">query_cache_size</span>        <span class="o">=</span> 32M    <span class="c"># Default: 0 (通常時: 32M, データインポート時: 0)</span>
</span><span class='line'><span class="nv">query_cache_limit</span>       <span class="o">=</span> 16M    <span class="c"># Default: 1M</span>
</span><span class='line'><span class="nv">thread_stack</span>            <span class="o">=</span> 192K   <span class="c"># Default: 192K(32bit), 288K(64bit)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ==== MyISAM</span>
</span><span class='line'><span class="nv">key_buffer_size</span>         <span class="o">=</span> 8M     <span class="c"># Default: 8M (for MyISAM)</span>
</span><span class='line'><span class="nv">myisam_sort_buffer_size</span> <span class="o">=</span> 8M     <span class="c"># Default: 8M (for MyISAM)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ==== Binary Log</span>
</span><span class='line'><span class="nv">log_bin</span>          <span class="o">=</span> mysql-bin     <span class="c"># データインポート時はコメントアウト</span>
</span><span class='line'><span class="nv">expire_logs_days</span> <span class="o">=</span> 10
</span><span class='line'><span class="nv">max_binlog_size</span>  <span class="o">=</span> 100M
</span><span class='line'><span class="nv">binlog_format</span>    <span class="o">=</span> MIXED
</span><span class='line'><span class="nv">log_bin_trust_function_creators</span> <span class="o">=</span> <span class="m">1</span>  <span class="c"># Default: 0 (for TRIGGER)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ==== InnoDB</span>
</span><span class='line'><span class="nv">innodb_data_file_path</span>           <span class="o">=</span> ibdata1:1G  <span class="c">#:autoextend</span>
</span><span class='line'><span class="nv">innodb_autoextend_increment</span>     <span class="o">=</span> <span class="m">64</span>          <span class="c"># Default: 64</span>
</span><span class='line'><span class="nv">innodb_file_per_table</span>           <span class="o">=</span> 1
</span><span class='line'><span class="nv">innodb_file_format</span>              <span class="o">=</span> Barracuda   <span class="c"># Default: Antelope</span>
</span><span class='line'><span class="nv">innodb_file_format_max</span>          <span class="o">=</span> Barracuda   <span class="c"># Default: Antelope</span>
</span><span class='line'><span class="nv">innodb_large_prefix</span>             <span class="o">=</span> <span class="m">1</span>           <span class="c"># Default: 0</span>
</span><span class='line'><span class="nv">innodb_buffer_pool_size</span>         <span class="o">=</span> 1024M       <span class="c"># Default: 128M (innodb_log_files_in_group * innodb_log_file_size &lt; innodb_buffer_pool_size)</span>
</span><span class='line'><span class="c">#innodb_buffer_pool_instances    = 8           # Default: autosized(32bit), 8(64bit) (innodb_buffer_pool_size &gt;= 1G の場合にのみ有効)</span>
</span><span class='line'><span class="nv">innodb_sort_buffer_size</span>         <span class="o">=</span> 2M          <span class="c"># Default: 1M (通常時:2M, ALTER TABLE 時:64M)</span>
</span><span class='line'><span class="nv">innodb_write_io_threads</span>         <span class="o">=</span> <span class="m">4</span>           <span class="c"># Default: 4 (1 - 64)</span>
</span><span class='line'><span class="nv">innodb_read_io_threads</span>          <span class="o">=</span> <span class="m">4</span>           <span class="c"># Default: 4 (1 - 64)</span>
</span><span class='line'><span class="nv">innodb_log_buffer_size</span>          <span class="o">=</span> 32M         <span class="c"># Default: 8M (通常時:32M, データインポート時:128M程度)</span>
</span><span class='line'><span class="nv">innodb_log_group_home_dir</span>       <span class="o">=</span> /var/lib/mysql
</span><span class='line'><span class="nv">innodb_log_files_in_group</span>       <span class="o">=</span> <span class="m">2</span>           <span class="c"># Default: 2   (変更注意!)</span>
</span><span class='line'><span class="nv">innodb_log_file_size</span>            <span class="o">=</span> 256M        <span class="c"># Default: 48M (変更注意!)</span>
</span><span class='line'><span class="c"># &lt;= innodb_log_files_in_group * innodb_log_file_size &lt; innodb_buffer_pool_size</span>
</span><span class='line'><span class="c">#    [変更方法](http://dev.mysql.com/doc/refman/5.6/ja/innodb-data-log-reconfiguration.html)</span>
</span><span class='line'><span class="nv">innodb_max_dirty_pages_pct</span>      <span class="o">=</span> <span class="m">90</span>          <span class="c"># Default: 75(%)</span>
</span><span class='line'><span class="c"># &lt;= 小さい値：低速＆安定、大きい値：高速＆不安定(?)</span>
</span><span class='line'><span class="nv">innodb_io_capacity</span>              <span class="o">=</span> <span class="m">100</span>         <span class="c"># Default: 200 (100 - 2^64-1)</span>
</span><span class='line'><span class="nv">innodb_io_capacity_max</span>          <span class="o">=</span> <span class="m">200</span>         <span class="c"># Default: 200 (100 - 2^64-1)</span>
</span><span class='line'><span class="nv">innodb_lru_scan_depth</span>           <span class="o">=</span> <span class="m">100</span>         <span class="c"># Default: 1024 (100 - 2^32-1(32bit))</span>
</span><span class='line'><span class="nv">innodb_flush_method</span>             <span class="o">=</span> O_DIRECT    <span class="c"># Default: Not set</span>
</span><span class='line'><span class="nv">innodb_flush_log_at_trx_commit</span>  <span class="o">=</span> <span class="m">1</span>           <span class="c"># Default: 1 (データインポート時: 2 or 0)</span>
</span><span class='line'><span class="nv">innodb_doublewrite</span>              <span class="o">=</span> <span class="m">1</span>           <span class="c"># Default: 1 (データインポート時: 0)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ==== Log</span>
</span><span class='line'><span class="nv">log_output</span>          <span class="o">=</span> FILE  <span class="c"># Default: FILE</span>
</span><span class='line'><span class="nv">log_warnings</span>        <span class="o">=</span> <span class="m">1</span>     <span class="c"># Default: 1</span>
</span><span class='line'>log-error           <span class="o">=</span> /var/log/mysql/error.log
</span><span class='line'><span class="c">#general_log_file    = /var/log/mysql/mysql.log  # デバッグ時に有効化</span>
</span><span class='line'><span class="c">#general_log         = 1                         # デバッグ時に有効化</span>
</span><span class='line'><span class="c">#slow_query_log_file = /var/log/mysql/slow.log   # デバッグ時に有効化</span>
</span><span class='line'><span class="c">#slow_query_log      = 1                         # デバッグ時に有効化</span>
</span><span class='line'><span class="c">#long_query_time     = 30                        # デバッグ時に有効化</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ==== Event Scheduler</span>
</span><span class='line'><span class="nv">event_scheduler</span> <span class="o">=</span> <span class="m">1</span>  <span class="c"># Default: 0</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>client<span class="o">]</span>
</span><span class='line'><span class="nv">port</span>   <span class="o">=</span> 3306
</span><span class='line'><span class="nv">socket</span> <span class="o">=</span> /var/lib/mysql/mysql.sock
</span><span class='line'>default-character-set <span class="o">=</span> utf8mb4
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mysqld_safe<span class="o">]</span>
</span><span class='line'><span class="nv">socket</span> <span class="o">=</span> /var/lib/mysql/mysql.sock
</span><span class='line'><span class="nv">nice</span>   <span class="o">=</span> 0
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mysqldump<span class="o">]</span>
</span><span class='line'>quick
</span><span class='line'>quote-names
</span><span class='line'><span class="nv">max_allowed_packet</span> <span class="o">=</span> 32M
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mysql<span class="o">]</span>
</span><span class='line'>default-character-set <span class="o">=</span> utf8mb4
</span><span class='line'>no-auto-rehash
</span><span class='line'>show-warnings
</span><span class='line'><span class="nv">prompt</span><span class="o">=</span><span class="se">\u</span>@<span class="se">\h</span>:<span class="se">\d\_\R</span>:<span class="se">\m</span>:<span class="se">\\</span>s&gt;<span class="se">\_</span>
</span><span class='line'><span class="nv">pager</span><span class="o">=</span><span class="s2">&quot;less -n -i -F -X -E&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>isamchk<span class="o">]</span>
</span><span class='line'><span class="nv">key_buffer</span> <span class="o">=</span> 16M
</span><span class='line'>
</span><span class='line'><span class="o">[</span>myisamchk<span class="o">]</span>
</span><span class='line'><span class="nv">key_buffer_size</span>  <span class="o">=</span> 128M
</span><span class='line'><span class="nv">sort_buffer_size</span> <span class="o">=</span> 128M
</span><span class='line'><span class="nv">read_buffer</span>      <span class="o">=</span> 2M
</span><span class='line'><span class="nv">write_buffer</span>     <span class="o">=</span> 2M
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mysqlhotcopy<span class="o">]</span>
</span><span class='line'>interactive-timeout
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mysqladmin<span class="o">]</span>
</span><span class='line'><span class="nv">user</span>     <span class="o">=</span> root
</span><span class='line'><span class="nv">password</span> <span class="o">=</span> xxxxxxxx
</span></code></pre></td></tr></table></div></figure>


<h3>10. 所有者・所有グループの設定</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ cd /usr/local/mysql
</span><span class='line'>$ sudo chown -R mysql. .
</span></code></pre></td></tr></table></div></figure>


<h3>11. ログディレクトリの作成</h3>

<p>ログ用ディレクトリを作成し、所有者・グループを設定しておく。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo mkdir /var/log/mysql
</span><span class='line'>$ sudo chown -R mysql. /var/log/mysql
</span></code></pre></td></tr></table></div></figure>


<h3>12. PID ディレクトリの作成</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo mkdir /var/run/mysqld
</span><span class='line'>$ sudo chown -R mysql. /var/run/mysqld
</span></code></pre></td></tr></table></div></figure>


<h3>13. 初期設定</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo bin/mysqld --initialize --user=mysql
</span><span class='line'>$ sudo bin/mysql_ssl_rsa_setup
</span><span class='line'>$ sudo chown -R mysql. /var/lib/mysql
</span></code></pre></td></tr></table></div></figure>


<h3>14. 起動スクリプトの作成</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo cp support-files/mysql.server /etc/init.d/mysqld
</span><span class='line'>$ sudo chown root:root /etc//init.d/mysqld
</span><span class='line'>$ sudo chmod 755 /etc/init.d/mysqld
</span></code></pre></td></tr></table></div></figure>


<p>そして、編集する。</p>

<figure class='code'><figcaption><span>/etc/init.d/mysqld</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="k">if</span> <span class="o">[</span> ! -d /var/run/mysqld <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>  mkdir /var/run/mysqld <span class="o">&amp;&amp;</span> chown -R mysql. /var/run/mysqld
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="nv">basedir</span><span class="o">=</span>/usr/local/mysql
</span><span class='line'><span class="nv">datadir</span><span class="o">=</span>/var/lib/mysql
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>上記の <code>if ... mkdir ... fi</code> の部分について
&ldquo;/var/run&rdquo; ディレクトリは tmpfs であるため、マシンの電源を落とすと &ldquo;/var/run/mysqld&rdquo; ディレクトリが消滅してしまう。<br/>
その対策として、サービス起動時に &ldquo;/var/run/mysqld&rdquo; ディレクトリが存在しなければ作成し、所有者を設定している。<br/>
（過去、MySQL サーバ構築時にこのような対策をしたことはなかったけども。。。）</li>
</ul>


<h3>15. MySQL サーバの起動</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo /etc/init.d/mysqld start
</span></code></pre></td></tr></table></div></figure>


<h3>16. 自動起動の設定</h3>

<p>マシン起動時に MySQL サーバを自動起動するようにしたければ、以下のようにする。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo update-rc.d mysqld defaults
</span><span class='line'> Adding system startup for /etc/init.d/mysqld ...
</span><span class='line'>   /etc/rc0.d/K20mysqld -&gt; ../init.d/mysqld
</span><span class='line'>   /etc/rc1.d/K20mysqld -&gt; ../init.d/mysqld
</span><span class='line'>   /etc/rc6.d/K20mysqld -&gt; ../init.d/mysqld
</span><span class='line'>   /etc/rc2.d/S20mysqld -&gt; ../init.d/mysqld
</span><span class='line'>   /etc/rc3.d/S20mysqld -&gt; ../init.d/mysqld
</span><span class='line'>   /etc/rc4.d/S20mysqld -&gt; ../init.d/mysqld
</span><span class='line'>   /etc/rc5.d/S20mysqld -&gt; ../init.d/mysqld
</span><span class='line'>
</span><span class='line'>$ sudo sysv-rc-conf --list | grep mysqld  # &lt;= 2,3,4,5 が on であることを確認
</span><span class='line'>mysqld       0:off      1:off   2:on    3:on    4:on    5:on    6:off
</span></code></pre></td></tr></table></div></figure>


<h3>17. root 初期パスワードの確認</h3>

<p>（記録されているログファイルは環境により異なる）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo grep &#39;temporary password&#39; /var/log/mysql/error.log
</span><span class='line'>2015-12-10T07:42:55.685053Z 1 [Note] A temporary password is generated for root@localhost: O&lt;ZeyQmcX5wQ
</span></code></pre></td></tr></table></div></figure>


<h3>18. MySQL の安全化</h3>

<p>root パスワードの設定等を行う。（説明は後述）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ mysql_secure_installation
</span><span class='line'>mysql_secure_installation: [ERROR] unknown variable &#39;default-character-set=utf8&#39;
</span><span class='line'>
</span><span class='line'>Securing the MySQL server deployment.
</span><span class='line'>
</span><span class='line'>Enter password for user root:
</span><span class='line'>
</span><span class='line'>The existing password for the user account root has expired. Please set a new password.
</span><span class='line'>
</span><span class='line'>New password:
</span><span class='line'>
</span><span class='line'>Re-enter new password:
</span><span class='line'>
</span><span class='line'>VALIDATE PASSWORD PLUGIN can be used to test passwords
</span><span class='line'>and improve security. It checks the strength of password
</span><span class='line'>and allows the users to set only those passwords which are
</span><span class='line'>secure enough. Would you like to setup VALIDATE PASSWORD plugin?
</span><span class='line'>
</span><span class='line'>Press y|Y for Yes, any other key for No: n
</span><span class='line'>Using existing password for root.
</span><span class='line'>Change the password for root ? ((Press y|Y for Yes, any other key for No) : n
</span><span class='line'>
</span><span class='line'> ... skipping.
</span><span class='line'>By default, a MySQL installation has an anonymous user,
</span><span class='line'>allowing anyone to log into MySQL without having to have
</span><span class='line'>a user account created for them. This is intended only for
</span><span class='line'>testing, and to make the installation go a bit smoother.
</span><span class='line'>You should remove them before moving into a production
</span><span class='line'>environment.
</span><span class='line'>
</span><span class='line'>Remove anonymous users? (Press y|Y for Yes, any other key for No) : y
</span><span class='line'>Success.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Normally, root should only be allowed to connect from
</span><span class='line'>&#39;localhost&#39;. This ensures that someone cannot guess at
</span><span class='line'>the root password from the network.
</span><span class='line'>
</span><span class='line'>Disallow root login remotely? (Press y|Y for Yes, any other key for No) : n
</span><span class='line'>
</span><span class='line'> ... skipping.
</span><span class='line'>By default, MySQL comes with a database named &#39;test&#39; that
</span><span class='line'>anyone can access. This is also intended only for testing,
</span><span class='line'>and should be removed before moving into a production
</span><span class='line'>environment.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y
</span><span class='line'> - Dropping test database...
</span><span class='line'>Success.
</span><span class='line'>
</span><span class='line'> - Removing privileges on test database...
</span><span class='line'>Success.
</span><span class='line'>
</span><span class='line'>Reloading the privilege tables will ensure that all changes
</span><span class='line'>made so far will take effect immediately.
</span><span class='line'>
</span><span class='line'>Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y
</span><span class='line'>Success.
</span><span class='line'>
</span><span class='line'>All done!
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><code>Enter password for user root:</code> で root の初期パスワードを入力する。</li>
<li><code>New password:</code> で root の新しいパスワードを設定する。<br/>
（パスワードに使用する文字は数字・英小文字・英大文字・記号を混在させること。そうしなければポリシー違反でエラーになる）</li>
<li><code>VALIDATE PASSWORD PLUGIN ... Press y|Y for Yes, any other key for No:</code> でパスワード検証プラグインの設定を行うか問われるが、今回は行わないので <code>n</code> で応答する。</li>
<li><code>Change the password for root ? ((Press y|Y for Yes, any other key for No) :</code> で root のパスワードを変更するか問われるが、先ほど設定したの <code>n</code> で応答する。</li>
<li><code>Remove anonymous users?</code> で匿名ユーザを削除するために <code>y</code> で応答する。</li>
<li><code>Disallow root login remotely?</code> で root のリモート接続を拒否するか問われるが、リモート接続したいので <code>n</code> で応答する。（当然 <code>y</code> でもよい）</li>
<li><code>Remove test database and access to it?</code> でテストデータベースを削除するか問われるので、 <code>y</code> で応答する。</li>
<li><code>Reload privilege tables now?</code> で権限テーブルを即時リロードするか問われるので、 <code>y</code> で応答する。</li>
</ol>


<h3>19. 動作確認</h3>

<p>MySQL サーバにログインしてみる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mysql -u root -p
</span><span class='line'>Enter password:
</span><span class='line'>Welcome to the MySQL monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 6
</span><span class='line'>Server version: 5.7.10 Source distribution
</span><span class='line'>
</span><span class='line'>Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.
</span><span class='line'>
</span><span class='line'>Oracle is a registered trademark of Oracle Corporation and/or its
</span><span class='line'>affiliates. Other names may be trademarks of their respective
</span><span class='line'>owners.
</span><span class='line'>
</span><span class='line'>Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
</span><span class='line'>
</span><span class='line'>root@localhost:(none) 16:52:28&gt;
</span></code></pre></td></tr></table></div></figure>


<p>その他、各種操作を試してみる。</p>

<h3>20. その他</h3>

<ul>
<li>設定ファイルは &ldquo;/etc/my.cnf&rdquo; なので、実際に運用する際には綿密に検討して設定する。</li>
<li>パスワードの有効期限がデフォルトでは「360 日」に設定されている。<br/>
必要なら、システム変数 <code>default_password_lifetime</code> を編集する。</li>
</ul>


<h3>21. 参考サイト</h3>

<ul>
<li><a href="http://dev.mysql.com/doc/refman/5.7/en/source-installation.html" title="MySQL :: MySQL 5.7 Reference Manual :: 2.9 Installing MySQL from Source">MySQL :: MySQL 5.7 Reference Manual :: 2.9 Installing MySQL from Source</a></li>
</ul>


<hr />

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pandoc で Markdown 文書を PDF に変換！]]></title>
    <link href="http://komasaru.github.io/blog/2016/01/22/pandoc-md2pdf-conversion/"/>
    <updated>2016-01-22T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2016/01/22/pandoc-md2pdf-conversion</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>Pandoc（あるマークアップ形式で書かれた文書を別の形式へ変換するためのコマンドラインツール）を使用して Markdown 文書を PDF に変換する方法についての記録です。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>Linux Mint 17.2(64bit) での作業を想定。</li>
<li>組版処理ソフト<script type="math/tex">\LaTeX</script>が必要なので、<script type="math/tex">\TeX Live</script>がインストール済みであること。（以下を参照）

<ul>
<li><a href="http://komasaru.github.io/2016/01/18/texlive-installation-on-linux-mint/" title="Linux Mint - TeX Live 2015 インストール！">Linux Mint - TeX Live 2015 インストール！</a></li>
<li><a href="https://oku.edu.mie-u.ac.jp/~okumura/texwiki/?TeX%20Live#w628bee6" title="TeX Live - TeX Wiki">TeX Live - TeX Wiki</a></li>
</ul>
</li>
<li>Apt パッケージ版をインストールする。</li>
<li>今回は使用しないが、最新版をインストールしたければ Cabal（Haskell ライブラリやプログラムをビルド・パッケージングするシステム）を使用してソースからインストールする。（但し、パッケージ依存性の問題が発生しやすいとされているため、利用には注意）</li>
<li>Pandoc では様々な変換が可能だが、今回は Markdown から PDF への変換を行う。</li>
</ul>


<h3>1. Pandoc のインストール</h3>

<p>これだけ。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo apt-get install pandoc
</span></code></pre></td></tr></table></div></figure>


<p>ちなみに、 RedHat 系ディストリビューションなら <code>yum install pandoc</code> でインストールできる。（但し、 EPEL リポジトリからインストールするので導入済みであること）</p>

<h3>2. Pandoc インストールの確認</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ pandoc --version
</span><span class='line'>pandoc 1.12.2.1
</span><span class='line'>Compiled with texmath 0.6.5.2, highlighting-kate 0.5.5.1.
</span><span class='line'>Syntax highlighting is supported for the following languages:
</span><span class='line'>    actionscript, ada, apache, asn1, asp, awk, bash, bibtex, boo, c, changelog,
</span><span class='line'>    clojure, cmake, coffee, coldfusion, commonlisp, cpp, cs, css, curry, d,
</span><span class='line'>    diff, djangotemplate, doxygen, doxygenlua, dtd, eiffel, email, erlang,
</span><span class='line'>    fortran, fsharp, gnuassembler, go, haskell, haxe, html, ini, java, javadoc,
</span><span class='line'>    javascript, json, jsp, julia, latex, lex, literatecurry, literatehaskell,
</span><span class='line'>    lua, makefile, mandoc, markdown, matlab, maxima, metafont, mips, modelines,
</span><span class='line'>    modula2, modula3, monobasic, nasm, noweb, objectivec, objectivecpp, ocaml,
</span><span class='line'>    octave, pascal, perl, php, pike, postscript, prolog, python, r,
</span><span class='line'>    relaxngcompact, rhtml, roff, ruby, rust, scala, scheme, sci, sed, sgml, sql,
</span><span class='line'>    sqlmysql, sqlpostgresql, tcl, texinfo, verilog, vhdl, xml, xorg, xslt, xul,
</span><span class='line'>    yacc, yaml
</span><span class='line'>Default user data directory: /home/masaru/.pandoc
</span><span class='line'>Copyright (C) 2006-2013 John MacFarlane
</span><span class='line'>Web:  http://johnmacfarlane.net/pandoc
</span><span class='line'>This is free software; see the source for copying conditions.  There is no
</span><span class='line'>warranty, not even for merchantability or fitness for a particular purpose.
</span></code></pre></td></tr></table></div></figure>


<h3>3. テスト用 Markdown 文書の作成</h3>

<figure class='code'><figcaption><span>pandoc_test.md</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Pandoc 変換テスト
</span><span class='line'>=================
</span><span class='line'>
</span><span class='line'>はじめに
</span><span class='line'>--------
</span><span class='line'>
</span><span class='line'>### はじめにー１
</span><span class='line'>
</span><span class='line'>これは `Pandoc` の変換テストです。これは `Pandoc` の変換テストです。
</span><span class='line'>
</span><span class='line'>### はじめにー２
</span><span class='line'>
</span><span class='line'>これは `Pandoc` の変換テストです。これは `Pandoc` の変換テストです。
</span><span class='line'>
</span><span class='line'>概要
</span><span class='line'>----
</span><span class='line'>
</span><span class='line'>#### 概要ー１
</span><span class='line'>
</span><span class='line'>Markdown 文書を PDF に変換します。Markdown 文書を PDF に変換します。
</span><span class='line'>
</span><span class='line'>#### 概要ー２
</span><span class='line'>
</span><span class='line'>Markdown 文書を PDF に変換します。Markdown 文書を PDF に変換します。
</span><span class='line'>
</span><span class='line'>参考
</span><span class='line'>----
</span><span class='line'>
</span><span class='line'>* [Pandoc - About pandoc](http://pandoc.org/ &quot;Pandoc - About pandoc&quot;)
</span><span class='line'>* [Pandoc ユーザーズガイド 日本語版 - Japanese Pandoc User&#39;s Association](http://sky-y.github.io/site-pandoc-jp/users-guide/ &quot;Pandoc ユーザーズガイド 日本語版 - Japanese Pandoc User&#39;s Association&quot;)
</span><span class='line'>
</span><span class='line'>｀｀｀
</span><span class='line'>class Test
</span><span class='line'>  def initialize
</span><span class='line'>    @name = &quot;Pandoc&quot;
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  def hello
</span><span class='line'>    puts &quot;Hello #{@name}.&quot;
</span><span class='line'>  end
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>a = Test.new
</span><span class='line'>a.hello
</span><span class='line'>｀｀｀
</span></code></pre></td></tr></table></div></figure>


<p>（上記コード内の最後の <code>｀｀｀</code> は、実際は半角（1バイト）文字）</p>

<h3>4. Markdown から PDF への変換</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ pandoc pandoc_test.md -V documentclass=ltjarticle --latex-engine=lualatex -o pandoc_test.pdf
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>-V documentclass=ltjarticle</code> は、日本語フォントを使用するためのオプション。<br/>
（<script type="math/tex">\LaTeX</script>文書の <code>documentclass</code> を <code>ltjarticle</code> に設定するオプション）</li>
<li><code>--latex-engine=lualatex</code> は、<script type="math/tex">\LaTeX</script>エンジンを <code>lualatex</code>（日本語を扱う場合の推奨値）に設定するオプション。<br/>
（指定しない場合は、デフォルトの <code>pdflatex</code> となる）</li>
<li><code>-o pandoc_test.pdf</code> は、出力ファイルを指定するオプション。<br/>
（指定しない場合は、標準出力に HTML 出力される）</li>
<li>その他、各種オプションあり。

<ul>
<li>A4 用紙に設定したければ <code>-V geometry:a4paper</code> オプションを指定する。</li>
<li>余白を 2cm に設定したければ <code>-V geometry:margin=2cm</code> オプションを指定する。</li>
</ul>
</li>
</ul>


<p>（想像していたより変換に時間がかかる）</p>

<h3>5. PDF の確認</h3>

<p>作成された PDF 文書を確認してみる。（以下は、公開の都合上 PNG 画像としてキャプチャしたもの）</p>

<p><img src="http://komasaru.github.io/images/2016/01/22/PANDOC_TEST.png" title="PANDOC_TEST" alt="PANDOC_TEST" /></p>

<h3>6. 参考サイト</h3>

<ul>
<li><a href="http://pandoc.org/" title="Pandoc - About pandoc">Pandoc - About pandoc</a></li>
<li><a href="http://sky-y.github.io/site-pandoc-jp/users-guide/" title="Pandoc ユーザーズガイド 日本語版 - Japanese Pandoc User's Association">Pandoc ユーザーズガイド 日本語版 - Japanese Pandoc User&rsquo;s Association</a></li>
</ul>


<hr />

<p>普段 Markdown でテキストを保存することが多いので、何かと重宝しそうです。</p>

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux Mint - TeX Live 2015 インストール！]]></title>
    <link href="http://komasaru.github.io/blog/2016/01/18/texlive-installation-on-linux-mint/"/>
    <updated>2016-01-18T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2016/01/18/texlive-installation-on-linux-mint</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>以前、組版処理ソフトの<script type="math/tex">\TeX Live 2015</script> を CentOS にインストールする方法については記事にしました。</p>

<ul>
<li><a href="http://komasaru.github.io/2012/09/15/15002016/" title="CentOS - TeX Live 2012 インストール！ - mk-mode BLOG">CentOS - TeX Live 2012 インストール！ - mk-mode BLOG</a></li>
</ul>


<p>今回は、Linux Mint へインストールする方法についてです。（実際のところ、ほぼ同じですが）</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>Linux Mint 17.2(64bit) での作業を想定。</li>
<li>パッケージ管理システムを使用したインストールではなく、アーカイブを取得してのインストール。（パッケージ管理システムを使用したインストールがうまく行かなかったため）</li>
</ul>


<h3>1. アーカイブの取得</h3>

<p>アーカイブファイルを取得して展開する。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ wget http://ftp.jaist.ac.jp/pub/CTAN/systems/texlive/tlnet/install-tl-unx.tar.gz
</span><span class='line'>$ tar zxvf install-tl-unx.tar.gz
</span></code></pre></td></tr></table></div></figure>


<h3>2. インストールの開始</h3>

<p>ディレクトリを移動後、<a href="https://oku.edu.mie-u.ac.jp/~okumura/texwiki/?TeX%20Live#tlnet" title="ミラーサイト一覧">ミラーサイト一覧</a>から接続先を選んでインストールを開始する。（途中の問いには <code>I</code> で応答）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ cd install-tl-*/
</span><span class='line'>$ sudo ./install-tl --repository http://ftp.jaist.ac.jp/pub/CTAN/systems/texlive/tlnet/
</span><span class='line'>
</span><span class='line'>====&lt; 途中省略 &gt;====
</span><span class='line'>
</span><span class='line'>Actions:
</span><span class='line'> &lt;I&gt; start installation to hard disk
</span><span class='line'> &lt;H&gt; help
</span><span class='line'> &lt;Q&gt; quit
</span><span class='line'>
</span><span class='line'>Enter command: I
</span><span class='line'>
</span><span class='line'>====&lt; 途中省略 &gt;====
</span></code></pre></td></tr></table></div></figure>


<p>サーバの接続エラーが発生する場合は<a href="https://oku.edu.mie-u.ac.jp/~okumura/texwiki/?TeX%20Live#tlnet" title="ミラーサイト一覧">接続先</a>を変更してみる。</p>

<h3>3. 環境変数 PATH の設定</h3>

<p>環境変数 PATH を設定する。（当方は <code>~/.bashrc</code> を編集）</p>

<figure class='code'><figcaption><span>~/.bashrc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/texlive/2015/bin/x86_64-linux:$PATH&quot;</span>
</span><span class='line'><span class="nv">MANPATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/texlive/2015/texmf-dist/doc/man:$MANPATH&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>そして、即時反映。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ source ~/.bashrc
</span></code></pre></td></tr></table></div></figure>


<h3>4. TeX Live インストールの確認</h3>

<p><code>tex</code> や <code>platex</code> 等のバージョンを確認してみる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ tex --version
</span><span class='line'>TeX 3.14159265 (TeX Live 2015)
</span><span class='line'>kpathsea version 6.2.1
</span><span class='line'>Copyright 2015 D.E. Knuth.
</span><span class='line'>There is NO warranty.  Redistribution of this software is
</span><span class='line'>covered by the terms of both the TeX copyright and
</span><span class='line'>the Lesser GNU General Public License.
</span><span class='line'>For more information about these matters, see the file
</span><span class='line'>named COPYING and the TeX source.
</span><span class='line'>Primary author of TeX: D.E. Knuth.
</span><span class='line'>
</span><span class='line'>$ platex --version
</span><span class='line'>e-pTeX 3.14159265-p3.6-141210-2.6 (utf8.euc) (TeX Live 2015)
</span><span class='line'>kpathsea version 6.2.1
</span><span class='line'>ptexenc version 1.3.3
</span><span class='line'>Copyright 2015 D.E. Knuth.
</span><span class='line'>There is NO warranty.  Redistribution of this software is
</span><span class='line'>covered by the terms of both the e-pTeX copyright and
</span><span class='line'>the Lesser GNU General Public License.
</span><span class='line'>For more information about these matters, see the file
</span><span class='line'>named COPYING and the e-pTeX source.
</span><span class='line'>Primary author of e-pTeX: Peter Breitenlohner.
</span></code></pre></td></tr></table></div></figure>


<h3>5. 動作確認用 tex ファイルの作成</h3>

<figure class='code'><figcaption><span>test.tex</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>\documentclass[14pt,a4j]{jsarticle}
</span><span class='line'>%--余白の設定 ( A4サイズ: 290 * 210 ) の半分
</span><span class='line'>\setlength{\voffset}{10mm}               %用紙上部の余白
</span><span class='line'>\addtolength{\voffset}{-1in}             %はじめからある余白を消す
</span><span class='line'>\setlength{\hoffset}{15mm}               %用紙左部の余白
</span><span class='line'>\addtolength{\hoffset}{-1in}             %はじめからある余白を消す
</span><span class='line'>\setlength{\topmargin}{0mm}              %上部余白からヘッダーまでの長さ
</span><span class='line'>\setlength{\oddsidemargin}{0mm}          %左部余白から本文までの長さ
</span><span class='line'>\setlength{\headheight}{0mm}             %ヘッダーの高さ
</span><span class='line'>\setlength{\headsep}{0mm}                %ヘッダーから本文までの長さ
</span><span class='line'>\setlength{\textheight}{29\baselineskip} %本文の高さ
</span><span class='line'>\setlength{\textwidth}{270pt}            %本文の幅
</span><span class='line'>\setlength{\marginparwidth}{0mm}         %注釈の幅
</span><span class='line'>\setlength{\topskip}{0mm}                %本文の上部から一行目までの長さ
</span><span class='line'>\setlength{\baselineskip}{11pt}          %行の高さ
</span><span class='line'>%--PageStyle設定
</span><span class='line'>\pagestyle{empty}
</span><span class='line'>
</span><span class='line'>\begin{document}
</span><span class='line'>
</span><span class='line'>\noindent
</span><span class='line'>\section*{標準偏差}
</span><span class='line'>【不偏分散】
</span><span class='line'>\begin{eqnarray*}
</span><span class='line'>単純移動平均 \ \ \overline{x} &amp; = &amp; \frac{1}{n}{\displaystyle\sum_{i=0}^{n-1} x_{i}}\\
</span><span class='line'>標準偏差 \ \ \sigma &amp; = &amp; \sqrt{ \frac{1}{n-1}{\displaystyle\sum_{i=0}^{n-1} \left( x_{i} - \overline{x} \right)^{2}} } \\
</span><span class='line'>&amp; = &amp; \sqrt{ \frac{1}{n\left(n-1\right)}\Biggl\{n\displaystyle\sum_{i=0}^{n-1}x_{i}^{2} - \left( \displaystyle\sum_{i=0}^{n-1}x_{i} \right)^{2}\Biggl\} }
</span><span class='line'>\end{eqnarray*}\par
</span><span class='line'>【標本分散】
</span><span class='line'>\begin{eqnarray*}
</span><span class='line'>単純移動平均 \ \ \overline{x} &amp; = &amp; \frac{1}{n}{\displaystyle\sum_{i=0}^{n-1} x_{i}}\\
</span><span class='line'>標準偏差 \ \ \sigma &amp; = &amp; \sqrt{ \frac{1}{n}{\displaystyle\sum_{i=0}^{n-1} \left( x_{i} - \overline{x} \right)^{2}} } \\
</span><span class='line'>&amp; = &amp; \sqrt{ \frac{1}{n^{2}}\Biggl\{n\displaystyle\sum_{i=0}^{n-1}x_{i}^{2} - \left( \displaystyle\sum_{i=0}^{n-1}x_{i} \right)^{2}\Biggl\} }
</span><span class='line'>\end{eqnarray*}
</span><span class='line'>
</span><span class='line'>\end{document}
</span></code></pre></td></tr></table></div></figure>


<h3>6. PDF の作成</h3>

<p>以下のようにして、PDF ファイル作成まで実行する。<br/>
&ldquo;test.tex&rdquo; に間違いがなければ <code>platex</code> コマンドで &ldquo;test.dvi&rdquo; ファイルが作成され、<code>dvipdfmx</code> コマンドで &ldquo;test.pdf&rdquo; が作成されるはずです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ platex test.tex
</span><span class='line'>This is e-pTeX, Version 3.14159265-p3.6-141210-2.6 (utf8.euc) (TeX Live 2015) (preloaded format=platex)
</span><span class='line'> restricted \write18 enabled.
</span><span class='line'>entering extended mode
</span><span class='line'>(./test.tex
</span><span class='line'>pLaTeX2e &lt;2006/11/10&gt; (based on LaTeX2e &lt;2015/10/01&gt; patch level 2)
</span><span class='line'>Babel &lt;3.9m&gt; and hyphenation patterns for 79 languages loaded.
</span><span class='line'>(/usr/local/texlive/2015/texmf-dist/tex/platex/jsclasses/jsarticle.cls
</span><span class='line'>Document Class: jsarticle 2014/02/07 okumura
</span><span class='line'>) (./test.aux) [1] (./test.aux) )
</span><span class='line'>Output written on test.dvi (1 page, 2304 bytes).
</span><span class='line'>Transcript written on test.log.
</span><span class='line'>
</span><span class='line'>$ dvipdfmx test.dvi
</span><span class='line'>test.dvi -&gt; test.pdf
</span><span class='line'>[1]
</span><span class='line'>8137 bytes written
</span></code></pre></td></tr></table></div></figure>


<h3>7. PDF の確認</h3>

<p>作成された PDF ファイルを確認してみる。（以下は公開の都合上 PNG 画像として切り取ったもの）</p>

<p><img src="http://komasaru.github.io/images/2016/01/18/TEXLIVE_2015_TEST.png" title="TEXLIVE_2015_TEST" alt="TEXLIVE_2015_TEST" /></p>

<h3>8. その他</h3>

<p>GUI ツールの <script type="math/tex">\TeX Works</script> を導入するとより扱いやすいでしょう。</p>

<h3>9. 参考サイト</h3>

<ul>
<li><a href="https://oku.edu.mie-u.ac.jp/~okumura/texwiki/?Linux#texlive" title="Linux - TeX Wiki">Linux - TeX Wiki</a></li>
</ul>


<hr />

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby - ３次スプライン補間！]]></title>
    <link href="http://komasaru.github.io/blog/2016/01/12/ruby-spline-interpolation/"/>
    <updated>2016-01-12T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2016/01/12/ruby-spline-interpolation</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>過去に「ラグランジュ補間」や「ニュートン補間」を C++ や Ruby で実装したことがありました。</p>

<ul>
<li><a href="http://komasaru.github.io/2013/03/10/cpp-interpolate-lagrange/" title="C++ - ラグランジュ補間！ - mk-mode BLOG">C++ - ラグランジュ補間！ - mk-mode BLOG</a></li>
<li><a href="http://komasaru.github.io/2013/03/11/ruby-interpolate-lagrange/" title="Ruby - ラグランジュ補間！ - mk-mode BLOG">Ruby - ラグランジュ補間！ - mk-mode BLOG</a></li>
<li><a href="http://komasaru.github.io/2013/03/13/cpp-interpolate-newton/" title="C++ - ニュートン補間！ - mk-mode BLOG">C++ - ニュートン補間！ - mk-mode BLOG</a></li>
<li><a href="http://komasaru.github.io/2013/03/14/ruby-interpolate-newton/" title="Ruby - ニュートン補間！ - mk-mode BLOG">Ruby - ニュートン補間！ - mk-mode BLOG</a></li>
</ul>


<p>今回は「３次スプライン補間」を Ruby で実装してみました。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>Ruby 2.2.3-p173 での作業を想定。</li>
<li>グラフも描画するので、RubyGems ライブラリの gnuplot をインストールしておく。</li>
</ul>


<h3>1. ３次スプライン補間について</h3>

<p><a href="http://akita-nct.jp/yamamoto/lecture/2007/5E_comp_app/interpolation/interpolation_html/node3.html" title="3 スプライン補間">こちらの内容</a>を自分なりに理解して以下のようにまとめた。</p>

<p>（数式が多いので別途 <script type="math/tex">\LaTeX</script> で記載した文書を貼り付け）</p>

<p><img src="http://komasaru.github.io/images/2016/01/12/SPLINE_INTERPOLATION_1.png" title="SPLINE_INTERPOLATION_1" alt="SPLINE_INTERPOLATION_1" />
<img src="http://komasaru.github.io/images/2016/01/12/SPLINE_INTERPOLATION_2.png" title="SPLINE_INTERPOLATION_2" alt="SPLINE_INTERPOLATION_2" />
<img src="http://komasaru.github.io/images/2016/01/12/SPLINE_INTERPOLATION_3.png" title="SPLINE_INTERPOLATION_3" alt="SPLINE_INTERPOLATION_3" />
<img src="http://komasaru.github.io/images/2016/01/12/SPLINE_INTERPOLATION_4.png" title="SPLINE_INTERPOLATION_4" alt="SPLINE_INTERPOLATION_4" />
<img src="http://komasaru.github.io/images/2016/01/12/SPLINE_INTERPOLATION_5.png" title="SPLINE_INTERPOLATION_5" alt="SPLINE_INTERPOLATION_5" />
<img src="http://komasaru.github.io/images/2016/01/12/SPLINE_INTERPOLATION_6.png" title="SPLINE_INTERPOLATION_6" alt="SPLINE_INTERPOLATION_6" /></p>

<p>（上記文書の PDF は<a href="http://www.mk-mode.com/rails/docs/INTERPOLATION_SPLINE.pdf" title="３次スプライン補間.pdf（Ａ４・４ページ）">こちら</a>）</p>

<h3>2. Ruby スクリプトの作成</h3>

<p>以下のような Ruby スクリプトを作成する。<br/>
ロジックは前項の説明（アルゴリズム）どおりなので説明しない。（ただ、連立一次方程式の解法には「<a href="http://komasaru.github.io/2013/09/21/ruby-simultaneous-equation-by-gauss-jorden/" title="Ruby - 連立方程式解法（ガウス・ジョルダン法）！">ガウス・ジョルダン法</a>」を使用した）</p>

<figure class='code'><figcaption><span>spline_interpolation.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/local/bin/ruby</span>
</span><span class='line'><span class="c1"># coding: utf-8</span>
</span><span class='line'><span class="c1">#*********************************************</span>
</span><span class='line'><span class="c1"># ３次スプライン補間</span>
</span><span class='line'><span class="c1"># （gnuplot によるグラフ描画付き）</span>
</span><span class='line'><span class="c1">#*********************************************</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;gnuplot&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># N + 1 個の点</span>
</span><span class='line'><span class="n">X</span> <span class="o">=</span> <span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'><span class="n">Y</span> <span class="o">=</span> <span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">SplineInterpolation</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span>
</span><span class='line'>    <span class="vi">@n</span> <span class="o">=</span> <span class="vi">@x</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>    <span class="n">h</span> <span class="o">=</span> <span class="n">calc_h</span>
</span><span class='line'>    <span class="n">w</span> <span class="o">=</span> <span class="n">calc_w</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span><span class='line'>    <span class="n">matrix</span> <span class="o">=</span> <span class="n">gen_matrix</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
</span><span class='line'>    <span class="n">v</span> <span class="o">=</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">gauss_jordan</span><span class="p">(</span><span class="n">matrix</span><span class="p">),</span> <span class="mi">0</span><span class="o">].</span><span class="n">flatten</span>
</span><span class='line'>    <span class="vi">@b</span> <span class="o">=</span> <span class="n">calc_b</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@a</span> <span class="o">=</span> <span class="n">calc_a</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@d</span> <span class="o">=</span> <span class="n">calc_d</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@c</span> <span class="o">=</span> <span class="n">calc_c</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span class='line'>    <span class="n">i</span> <span class="o">=</span> <span class="n">search_i</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span class='line'>    <span class="n">s</span>  <span class="o">=</span> <span class="vi">@a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="vi">@x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span>
</span><span class='line'>    <span class="n">s</span> <span class="o">+=</span> <span class="vi">@b</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="vi">@x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span class='line'>    <span class="n">s</span> <span class="o">+=</span> <span class="vi">@c</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="vi">@x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="n">s</span> <span class="o">+=</span> <span class="vi">@d</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">s</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>    <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;[</span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">class</span><span class="si">}</span><span class="s2">] </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="nb">exit</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">calc_h</span>
</span><span class='line'>    <span class="n">h</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="mi">0</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="vi">@n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">h</span> <span class="o">&lt;&lt;</span> <span class="vi">@x</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span> <span class="o">-</span> <span class="vi">@x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">h</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">calc_w</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span><span class='line'>    <span class="n">w</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="mi">1</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="vi">@n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>      <span class="n">w</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span> <span class="o">*</span> <span class="p">((</span><span class="vi">@y</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span> <span class="o">-</span> <span class="vi">@y</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">-</span> <span class="p">(</span><span class="vi">@y</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">-</span> <span class="vi">@y</span><span class="o">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span><span class="o">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">w</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">gen_matrix</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
</span><span class='line'>    <span class="n">matrix</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@n</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="mi">0</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="vi">@n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>      <span class="n">matrix</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">i</span><span class="o">]</span>     <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="n">h</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="n">matrix</span><span class="o">[</span><span class="n">i</span><span class="o">][-</span><span class="mi">1</span><span class="o">]</span>    <span class="o">=</span> <span class="n">w</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
</span><span class='line'>      <span class="k">next</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>      <span class="n">matrix</span><span class="o">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="o">][</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">h</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
</span><span class='line'>      <span class="n">matrix</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">h</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
</span><span class='line'>      <span class="n">matrix</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">h</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">matrix</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">gauss_jordan</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
</span><span class='line'>    <span class="n">v</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">n</span> <span class="o">=</span> <span class="vi">@n</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>    <span class="mi">0</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">p</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">[</span><span class="n">k</span><span class="o">][</span><span class="n">k</span><span class="o">]</span>
</span><span class='line'>      <span class="n">k</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">j</span><span class="o">|</span> <span class="n">matrix</span><span class="o">[</span><span class="n">k</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">[</span><span class="n">k</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">/</span> <span class="nb">p</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span>
</span><span class='line'>      <span class="mi">0</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>        <span class="k">unless</span> <span class="n">i</span> <span class="o">==</span> <span class="n">k</span>
</span><span class='line'>          <span class="n">d</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">k</span><span class="o">]</span>
</span><span class='line'>          <span class="n">k</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">j</span><span class="o">|</span> <span class="n">matrix</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">matrix</span><span class="o">[</span><span class="n">k</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">matrix</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span> <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="n">row</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">v</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">calc_a</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span class='line'>    <span class="n">a</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="mi">0</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="vi">@n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">v</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span> <span class="o">-</span> <span class="n">v</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="vi">@x</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span> <span class="o">-</span> <span class="vi">@x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">))</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">a</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">calc_b</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span class='line'>    <span class="n">b</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="mi">0</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="vi">@n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">/</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">b</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">calc_c</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span class='line'>    <span class="n">c</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="mi">0</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="vi">@n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>      <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="vi">@y</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span> <span class="o">-</span> <span class="vi">@y</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="vi">@x</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span> <span class="o">-</span> <span class="vi">@x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span> <span class="p">\</span>
</span><span class='line'>         <span class="o">-</span> <span class="p">(</span><span class="vi">@x</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span> <span class="o">-</span> <span class="vi">@x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="n">v</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">c</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">calc_d</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="vi">@y</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">search_i</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span class='line'>    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="vi">@x</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span>
</span><span class='line'>      <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span class='line'>      <span class="k">if</span> <span class="vi">@x</span><span class="o">[</span><span class="n">k</span><span class="o">]</span> <span class="o">&lt;</span> <span class="n">t</span>
</span><span class='line'>        <span class="n">i</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="n">j</span> <span class="o">=</span> <span class="n">k</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">i</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Graph</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x_g</span><span class="p">,</span> <span class="n">y_g</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@x_g</span><span class="p">,</span> <span class="vi">@y_g</span><span class="p">,</span> <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">x_g</span><span class="p">,</span> <span class="n">y_g</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">plot</span>
</span><span class='line'>    <span class="no">Gnuplot</span><span class="o">.</span><span class="n">open</span> <span class="k">do</span> <span class="o">|</span><span class="n">gp</span><span class="o">|</span>
</span><span class='line'>      <span class="no">Gnuplot</span><span class="o">::</span><span class="no">Plot</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">plot</span><span class="o">|</span>
</span><span class='line'>        <span class="n">plot</span><span class="o">.</span><span class="n">terminal</span> <span class="s2">&quot;png enhanced font &#39;IPA P ゴシック&#39; fontscale 1.2&quot;</span>
</span><span class='line'>        <span class="n">plot</span><span class="o">.</span><span class="n">output</span>   <span class="s2">&quot;spline_interpolation.png&quot;</span>
</span><span class='line'>        <span class="n">plot</span><span class="o">.</span><span class="n">title</span>    <span class="s2">&quot;スプライン補間&quot;</span>
</span><span class='line'>        <span class="n">plot</span><span class="o">.</span><span class="n">xlabel</span>   <span class="s2">&quot;x&quot;</span>
</span><span class='line'>        <span class="n">plot</span><span class="o">.</span><span class="n">ylabel</span>   <span class="s2">&quot;y&quot;</span>
</span><span class='line'>        <span class="n">plot</span><span class="o">.</span><span class="n">grid</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1"># 計算によって得られた点</span>
</span><span class='line'>        <span class="n">plot</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="no">Gnuplot</span><span class="o">::</span><span class="no">DataSet</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">[</span><span class="vi">@x_g</span><span class="p">,</span> <span class="vi">@y_g</span><span class="o">]</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">ds</span><span class="o">|</span>
</span><span class='line'>          <span class="n">ds</span><span class="o">.</span><span class="n">with</span>      <span class="o">=</span> <span class="s2">&quot;points&quot;</span>
</span><span class='line'>          <span class="n">ds</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'>          <span class="n">ds</span><span class="o">.</span><span class="n">linecolor</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'>          <span class="n">ds</span><span class="o">.</span><span class="n">notitle</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1"># 予め与えらた点</span>
</span><span class='line'>        <span class="n">plot</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="no">Gnuplot</span><span class="o">::</span><span class="no">DataSet</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">[</span><span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span><span class="o">]</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">ds</span><span class="o">|</span>
</span><span class='line'>          <span class="n">ds</span><span class="o">.</span><span class="n">with</span>      <span class="o">=</span> <span class="s2">&quot;points&quot;</span>
</span><span class='line'>          <span class="n">ds</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'>          <span class="n">ds</span><span class="o">.</span><span class="n">linecolor</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>          <span class="n">ds</span><span class="o">.</span><span class="n">notitle</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>    <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;[</span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">class</span><span class="si">}</span><span class="s2">] </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="nb">exit</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># グラフ用配列</span>
</span><span class='line'><span class="n">x_g</span><span class="p">,</span> <span class="n">y_g</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="p">,</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># ３次スプライン補間</span>
</span><span class='line'><span class="n">obj</span> <span class="o">=</span> <span class="no">SplineInterpolation</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">X</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">step</span><span class="p">(</span><span class="n">X</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span><span class="p">,</span> <span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
</span><span class='line'>  <span class="n">y</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%8.4f, %8.4f</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span class='line'>  <span class="n">x_g</span> <span class="o">&lt;&lt;</span> <span class="n">x</span>
</span><span class='line'>  <span class="n">y_g</span> <span class="o">&lt;&lt;</span> <span class="n">y</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># グラフ描画</span>
</span><span class='line'><span class="no">Graph</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">x_g</span><span class="p">,</span> <span class="n">y_g</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://gist.github.com/komasaru/01b9a98af2a6cae0a5df" title="Gist - Ruby script to calc 3D-Spline-Interpolation.">Gist - Ruby script to calc 3D-Spline-Interpolation.</a></li>
</ul>


<h3>3. Ruby スクリプトの実行</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ ./spline_interpolation.rb
</span><span class='line'>  0.0000,   0.8000
</span><span class='line'>  0.1000,   0.9861
</span><span class='line'>  0.2000,   1.1713
</span><span class='line'>  0.3000,   1.3544
</span><span class='line'>  0.4000,   1.5346
</span><span class='line'>  0.5000,   1.7108
</span><span class='line'>  0.6000,   1.8820
</span><span class='line'>  0.7000,   2.0473
</span><span class='line'>  0.8000,   2.2056
</span><span class='line'>  0.9000,   2.3559
</span><span class='line'>  1.0000,   2.4973
</span><span class='line'>  1.1000,   2.6287
</span><span class='line'>  1.2000,   2.7492
</span><span class='line'>  1.3000,   2.8578
</span><span class='line'>  1.4000,   2.9534
</span><span class='line'>  1.5000,   3.0351
</span><span class='line'>  1.6000,   3.1019
</span><span class='line'>  1.7000,   3.1528
</span><span class='line'>  1.8000,   3.1868
</span><span class='line'>  1.9000,   3.2028
</span><span class='line'>  2.0000,   3.2000
</span><span class='line'>  2.1000,   3.1782
</span><span class='line'>     :         :
</span><span class='line'>====&lt; 途中省略&gt;====
</span><span class='line'>     :         :
</span><span class='line'>  7.5000,   2.1279
</span><span class='line'>  7.6000,   2.0754
</span><span class='line'>  7.7000,   2.0275
</span><span class='line'>  7.8000,   1.9831
</span><span class='line'>  7.9000,   1.9410
</span><span class='line'>  8.0000,   1.9000
</span></code></pre></td></tr></table></div></figure>


<h3>4. グラフ確認</h3>

<p>Ruby スクリプトと同じディレクトリ内に &ldquo;spline_interpolation.png&rdquo; という画像ファイルが存在するはずなので、確認してみる。<br/>
（赤色の <code>x</code> が予め与えられた点、水色の <code>+</code> が補間された点）</p>

<p><img src="http://komasaru.github.io/images/2016/01/12/spline_interpolation.png" title="SPLINE_INTERPOLATION" alt="SPLINE_INTERPOLATION" /></p>

<h3>5. 参考サイト</h3>

<ul>
<li><a href="http://akita-nct.jp/yamamoto/lecture/2007/5E_comp_app/interpolation/interpolation_html/node3.html" title="3 スプライン補間">スプライン補間</a></li>
<li><a href="http://komasaru.github.io/2013/09/21/ruby-simultaneous-equation-by-gauss-jorden/" title="Ruby - 連立方程式解法（ガウス・ジョルダン法）！">ガウス・ジョルダン法</a></li>
</ul>


<hr />

<p>スプライン補間ができないと先に進めない（私的な）事案があったために今回まとめてみた次第です。</p>

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOS - Mroonga インストール（by ソースビルド）！]]></title>
    <link href="http://komasaru.github.io/blog/2016/01/08/centos-mroonga-installation-by-src/"/>
    <updated>2016-01-08T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2016/01/08/centos-mroonga-installation-by-src</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>MySQL 5.7 に全文検索エンジン Groonga の機能を実現するストレージエンジン Mroonga をソースをビルドしてインストールする方法についてです。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>CentOS 6.7(32bit) での作業を想定。</li>
<li>当記事執筆時点で最新の Mroonga 5.10 をインストールする。</li>
<li>Groonga 5.1.0 がインストール済みであることを想定。<br/>
（参照：<a href="http://komasaru.github.io/2016/01/04/centos-groonga-installation-by-yum" title="CentOS - Groonga インストール（by yum パッケージ）！">CentOS - Groonga インストール（by yum パッケージ）！</a>）</li>
<li>MySQL 5.7.9 をソースをビルドしてインストールしていること。（Mroonga のビルドに MySQL のソースが必要なため）<br/>
（参照：<a href="http://komasaru.github.io/2015/12/20/centos-mysql-57-installation-by-src" title="CentOS - MySQL 5.7 インストール（ソースビルド）！">CentOS - MySQL 5.7 インストール（ソースビルド）！</a>）</li>
<li>MySQL 5.7.9 は &ldquo;/usr/local/mysql&rdquo; ディレクトリにインストールされていることを想定。</li>
<li>MySQL 5.7.9 のインストールに使用したソースは &ldquo;/usr/local/src/mysql-5.7.9&rdquo; ディレクトリに存在することを想定。</li>
</ul>


<h3>1. 必要ライブラリのインストール</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># yum -y install groonga-devel groonga-normalizer-mysql
</span></code></pre></td></tr></table></div></figure>


<p>形態素解析エンジン MeCab をトークナイザとして使用するなら MeCab もインストールする。（groonga-tokenizer-mecab を yum インストールしていれば、依存性の関係でインストールされているはず）</p>

<p>その他、ビルドに必要な <code>make</code> 等も未インストールならインストールしておく。</p>

<h3>2. ソースの取得</h3>

<p>アーカイブを取得・展開し、ディレクトリを移動する。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># /usr/local/src
</span><span class='line'># wget http://packages.groonga.org/source/mroonga/mroonga-5.10.tar.gz
</span><span class='line'># tar zxvf mroonga-5.10.tar.gz
</span><span class='line'># cd mroonga-5.10
</span></code></pre></td></tr></table></div></figure>


<h3>3. Makefile の生成</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># ./configure \
</span><span class='line'>--with-mysql-source=/usr/local/src/mysql-5.7.9 \
</span><span class='line'>--with-mysql-build=/usr/local/src/mysql-5.7.9 \
</span><span class='line'>--with-mysql-config=/usr/local/mysql/bin/mysql_config
</span></code></pre></td></tr></table></div></figure>


<h3>4. ビルド</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># make
</span></code></pre></td></tr></table></div></figure>


<h3>5. インストール</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># make install
</span></code></pre></td></tr></table></div></figure>


<h3>6. MySQL への Mroonga プラグインの適用</h3>

<p>MySQL サーバが起動していることを確認してから以下を実行する。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mysql -u root &lt; /usr/local/share/mroonga/install.sql
</span></code></pre></td></tr></table></div></figure>


<p><code>... does not exist</code> のメッセージが出力されるかもしれないが問題ない。（おそらく）</p>

<h3>7. Mroonga 導入の確認</h3>

<p>MySQL サーバに root でログインして確認してみる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>mysql&gt; SHOW ENGINES;
</span><span class='line'>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
</span><span class='line'>| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |
</span><span class='line'>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
</span><span class='line'>| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |
</span><span class='line'>| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |
</span><span class='line'>| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |
</span><span class='line'>| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |
</span><span class='line'>| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |
</span><span class='line'>| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |
</span><span class='line'>| Mroonga            | YES     | CJK-ready fulltext search, column store                        | NO           | NO   | NO         |
</span><span class='line'>| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |
</span><span class='line'>| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |
</span><span class='line'>| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |
</span><span class='line'>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
</span><span class='line'>10 rows in set (0.01 sec)
</span></code></pre></td></tr></table></div></figure>


<p><code>Mroonga</code> 行が存在することを確認する。</p>

<p>その他、 Mroonga の簡単な使用方法は以下の過去記事等を参照。</p>

<ul>
<li><a href="http://komasaru.github.io/2015/08/21/mariadb-mroonga-installation" title="MariaDB 10.0.x - Mroonga プラグインの有効化！">MariaDB 10.0.x - Mroonga プラグインの有効化！</a></li>
</ul>


<h3>8. 参考サイト</h3>

<ul>
<li><a href="http://mroonga.org/ja/docs/install/others.html" title="2.7. その他 — Mroonga v5.10 documentation">2.7. その他 — Mroonga v5.10 documentation</a></li>
</ul>


<hr />

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOS - Groonga インストール（by yum パッケージ）！]]></title>
    <link href="http://komasaru.github.io/blog/2016/01/04/centos-groonga-installation-by-yum/"/>
    <updated>2016-01-04T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2016/01/04/centos-groonga-installation-by-yum</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>カラムストア機能付き全文検索エンジン Groonga を、CentOS 6.7 に Groonga 公式 yum リポジトリを使用してインストールする方法についてです。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>CentOS 6.7(32bit) での作業を想定。</li>
<li>当記事執筆時点で最新の Groonga 5.1.0 をインストールする。</li>
</ul>


<h3>1. yum リポジトリの導入</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># rpm -ivh http://packages.groonga.org/centos/groonga-release-1.1.0-1.noarch.rpm
</span><span class='line'># yum makecache
</span></code></pre></td></tr></table></div></figure>


<h3>2. Groonga のインストール</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># yum -y install groonga
</span></code></pre></td></tr></table></div></figure>


<p>形態素解析エンジン MeCab をトークナイザとして使用するために groonga-tokenizer-mecab をインストールする。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># yum -y install groonga-tokenizer-mecab
</span></code></pre></td></tr></table></div></figure>


<h3>3. Groonga インストールの確認</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># groonga --version
</span><span class='line'>Groonga 5.1.0 [linux-gnu,i686,utf8,match-escalation-threshold=0,nfkc,mecab,mruby,onigmo,zlib,epoll]
</span><span class='line'>
</span><span class='line'>configure options: &lt; &#39;--build=i686-redhat-linux-gnu&#39; &#39;--host=i686-redhat-linux-gnu&#39;
</span><span class='line'> &#39;--target=i686-redhat-linux-gnu&#39; &#39;--program-prefix=&#39; &#39;--prefix=/usr&#39; &#39;--exec-prefix=/usr&#39;
</span><span class='line'> &#39;--bindir=/usr/bin&#39; &#39;--sbindir=/usr/sbin&#39; &#39;--sysconfdir=/etc&#39; &#39;--datadir=/usr/share&#39;
</span><span class='line'> &#39;--includedir=/usr/include&#39; &#39;--libdir=/usr/lib&#39; &#39;--libexecdir=/usr/libexec&#39;
</span><span class='line'> &#39;--localstatedir=/var&#39; &#39;--sharedstatedir=/var/lib&#39; &#39;--mandir=/usr/share/man&#39;
</span><span class='line'> &#39;--infodir=/usr/share/info&#39; &#39;--disable-static&#39; &#39;--with-package-platform=redhat&#39;
</span><span class='line'> &#39;--with-mecab&#39; &#39;--with-munin-plugins&#39; &#39;--enable-mruby&#39; &#39;build_alias=i686-redhat-linux-gnu&#39;
</span><span class='line'> &#39;host_alias=i686-redhat-linux-gnu&#39; &#39;target_alias=i686-redhat-linux-gnu&#39;
</span><span class='line'> &#39;CFLAGS=-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
</span><span class='line'>  --param=ssp-buffer-size=4 -m32 -march=i686 -mtune=atom -fasynchronous-unwind-tables&#39;
</span><span class='line'> &#39;CXXFLAGS=-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
</span><span class='line'>  --param=ssp-buffer-size=4 -m32 -march=i686 -mtune=atom -fasynchronous-unwind-tables&#39;
</span><span class='line'> &#39;PKG_CONFIG_PATH=:/usr/lib/pkgconfig:/usr/share/pkgconfig&#39;&gt;
</span></code></pre></td></tr></table></div></figure>


<h3>4. 動作確認</h3>

<p>以下の過去記事を参照。</p>

<ul>
<li><a href="http://komasaru.github.io/2015/08/09/linux-mint-groonga-installation-by-src/" title="Linux Mint - Groonga インストール（by ソースビルド）！">Linux Mint - Groonga インストール（by ソースビルド）！</a></li>
</ul>


<h3>5. 参考サイト</h3>

<ul>
<li><a href="http://groonga.org/ja/docs/install/centos.html#centos-6" title="2.5. CentOS — Groonga v5.1.0ドキュメント">2.5. CentOS — Groonga v5.1.0ドキュメント</a></li>
</ul>


<hr />

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2015年 - ツイート集計！]]></title>
    <link href="http://komasaru.github.io/blog/2016/01/02/summary-tweet-2015/"/>
    <updated>2016-01-02T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2016/01/02/summary-tweet-2015</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>2015年の Twitter でのツイート（メインで使用しているアカウントのみ）を Ruby で集計してみました。</p>

<p>当方は、ツイートは全て自宅サーバ(CentOS)上のデータベース(MySQL)に保存しています。<br/>
（実際には Ruby + Twitter API で本家からデータを取得して保存）</p>

<p>ほとんど SQL で集計可能でしたが、品詞・単語別の集計は形態素解析エンジン MeCab を使用しました。</p>

<!--more-->


<p>集計内容は以下のとおり。</p>

<ol>
<li>月別ツイート数</li>
<li>曜日別ツイート数</li>
<li>時間別ツイート数</li>
<li>文字数別ツイート数</li>
<li>１日当たりツイート数別集計</li>
<li>品詞別出現回数</li>
<li>単語別出現回数</li>
</ol>


<h3>1. 月別ツイート数</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>[ 年  月 ]  [件数]  [ 比 率 ]
</span><span class='line'>2015年01月     295  (  7.47%)
</span><span class='line'>2015年02月     271  (  6.87%)
</span><span class='line'>2015年03月     276  (  6.99%)
</span><span class='line'>2015年04月     288  (  7.30%)
</span><span class='line'>2015年05月     326  (  8.26%)
</span><span class='line'>2015年06月     360  (  9.12%)
</span><span class='line'>2015年07月     397  ( 10.06%)
</span><span class='line'>2015年08月     393  (  9.96%)
</span><span class='line'>2015年09月     303  (  7.68%)
</span><span class='line'>2015年10月     326  (  8.26%)
</span><span class='line'>2015年11月     330  (  8.36%)
</span><span class='line'>2015年12月     382  (  9.68%)
</span><span class='line'>[ 合  計 ]   3,947  (100.00%)
</span></code></pre></td></tr></table></div></figure>


<p>毎月 300 〜 400 くらいツイートしていたようだ。</p>

<h3>2. 曜日別ツイート数</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>[ 曜  日 ]  [件数]  [ 比 率 ]
</span><span class='line'>  日曜日       503  ( 12.74%)
</span><span class='line'>  月曜日       572  ( 14.49%)
</span><span class='line'>  火曜日       579  ( 14.67%)
</span><span class='line'>  水曜日       535  ( 13.55%)
</span><span class='line'>  木曜日       631  ( 15.99%)
</span><span class='line'>  金曜日       597  ( 15.13%)
</span><span class='line'>  土曜日       530  ( 13.43%)
</span><span class='line'>[ 合  計 ]   3,947  (100.00%)
</span></code></pre></td></tr></table></div></figure>


<p>木・金曜日辺りが若干多めになっていたようだ。</p>

<h3>3. 時間別ツイート数</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>[ 時  間 ]  [件数]  [ 比 率 ]
</span><span class='line'>  00時台       891  ( 22.57%)
</span><span class='line'>  01時台         7  (  0.18%)
</span><span class='line'>  02時台         7  (  0.18%)
</span><span class='line'>  03時台        23  (  0.58%)
</span><span class='line'>  04時台        20  (  0.51%)
</span><span class='line'>  05時台        56  (  1.42%)
</span><span class='line'>  06時台        19  (  0.48%)
</span><span class='line'>  07時台         6  (  0.15%)
</span><span class='line'>  08時台         7  (  0.18%)
</span><span class='line'>  09時台        26  (  0.66%)
</span><span class='line'>  10時台        36  (  0.91%)
</span><span class='line'>  11時台        23  (  0.58%)
</span><span class='line'>  12時台       366  (  9.27%)
</span><span class='line'>  13時台        14  (  0.35%)
</span><span class='line'>  14時台        37  (  0.94%)
</span><span class='line'>  15時台        25  (  0.63%)
</span><span class='line'>  16時台        56  (  1.42%)
</span><span class='line'>  17時台       114  (  2.89%)
</span><span class='line'>  18時台       756  ( 19.15%)
</span><span class='line'>  19時台       777  ( 19.69%)
</span><span class='line'>  20時台       284  (  7.20%)
</span><span class='line'>  21時台       227  (  5.75%)
</span><span class='line'>  22時台        83  (  2.10%)
</span><span class='line'>  23時台        87  (  2.20%)
</span><span class='line'>[ 合  計 ]   3,947  (100.00%)
</span></code></pre></td></tr></table></div></figure>


<p>通常のツイートは 18時台、19時台が多かったようだ。00時台、12時台は Bot によるツイートがほとんど。</p>

<h3>4. 文字数別ツイート数</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>[ 文字数 ]  [件数]  [ 比 率 ]
</span><span class='line'> 〜 10文字       1  (  0.03%)
</span><span class='line'> 〜 20文字      19  (  0.48%)
</span><span class='line'> 〜 30文字      54  (  1.37%)
</span><span class='line'> 〜 40文字      92  (  2.33%)
</span><span class='line'> 〜 50文字     166  (  4.21%)
</span><span class='line'> 〜 60文字     319  (  8.08%)
</span><span class='line'> 〜 70文字     420  ( 10.64%)
</span><span class='line'> 〜 80文字     638  ( 16.16%)
</span><span class='line'> 〜 90文字     357  (  9.04%)
</span><span class='line'> 〜100文字     349  (  8.84%)
</span><span class='line'> 〜110文字     316  (  8.01%)
</span><span class='line'> 〜120文字     265  (  6.71%)
</span><span class='line'> 〜130文字     290  (  7.35%)
</span><span class='line'> 〜140文字     659  ( 16.70%)
</span><span class='line'> 〜150文字       1  (  0.03%)
</span><span class='line'> 〜160文字       1  (  0.03%)
</span><span class='line'>[ 合  計 ]   3,947  (100.00%)
</span></code></pre></td></tr></table></div></figure>


<p>文字数の少なすぎるツイートはあまりなく、70〜90文字くらいか140字の制限ギリギリのツイートが多かったようだ。<br/>
（140文字を超えるツイートが存在するのは、ツイート時に BitLy 短縮の URL だったのが Twitter API で取得し直すと Twitter 標準の t.co 短縮になり文字数が増えるため）</p>

<h3>5. １日当たりツイート数別集計</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>[ Tweets ]  [日数]  [ 比 率 ]
</span><span class='line'>     4           1  (  0.27%)
</span><span class='line'>     6          19  (  5.21%)
</span><span class='line'>     7          26  (  7.12%)
</span><span class='line'>     8          41  ( 11.23%)
</span><span class='line'>     9          58  ( 15.89%)
</span><span class='line'>    10          49  ( 13.42%)
</span><span class='line'>    11          41  ( 11.23%)
</span><span class='line'>    12          41  ( 11.23%)
</span><span class='line'>    13          23  (  6.30%)
</span><span class='line'>    14          21  (  5.75%)
</span><span class='line'>    15          14  (  3.84%)
</span><span class='line'>    16          10  (  2.74%)
</span><span class='line'>    17           8  (  2.19%)
</span><span class='line'>    18           5  (  1.37%)
</span><span class='line'>    19           4  (  1.10%)
</span><span class='line'>    20           1  (  0.27%)
</span><span class='line'>    21           1  (  0.27%)
</span><span class='line'>    24           1  (  0.27%)
</span><span class='line'>    34           1  (  0.27%)
</span><span class='line'>[ 合  計 ]     365  (100.00%)
</span></code></pre></td></tr></table></div></figure>


<p>１日に9〜10ツイート前後が多かったようで、１回もツイートしなかった日は無かったようだ。<br/>
（１回もツイートしなかった日は、2011年7月7日のアカウント開設以来１日もない）</p>

<h3>6. 品詞別出現回数</h3>

<p>形態素解析エンジン MeCab を使用して品詞別に集計してみた。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>[ 品詞   ]  [ 出現回数 ]
</span><span class='line'>  名詞         115,733
</span><span class='line'>  記号          31,187
</span><span class='line'>  助詞          28,721
</span><span class='line'>  動詞          10,205
</span><span class='line'>  助動詞         6,884
</span><span class='line'>  接頭詞         1,951
</span><span class='line'>  形容詞         1,403
</span><span class='line'>  副詞           1,402
</span><span class='line'>  連体詞           372
</span><span class='line'>  接続詞           295
</span><span class='line'>  感動詞            78
</span><span class='line'>  フィラー          15
</span><span class='line'>  その他             4
</span><span class='line'>[ 合  計 ]     198,250 語
</span></code></pre></td></tr></table></div></figure>


<p>当然ながら、名詞が多い。フィラーとは「えーと」、「あのー」のような、文と文の間を埋めるような単語のこと。<br/>
いつもながら、全体的に「こういうものなんだ」と実感する程度。</p>

<h3>7. 単語別出現回数</h3>

<p>１年間に出現した単語を集計してみた。（100回以上出現した単語を掲載）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>[ 単語               ]  [ 品詞   ]  [ 出現回数 ]
</span><span class='line'>  の                      助詞           6,982
</span><span class='line'>  :                       名詞           5,472
</span><span class='line'>  。                      記号           5,270
</span><span class='line'>  ▼                      記号           4,080
</span><span class='line'>  .                       名詞           3,458
</span><span class='line'>  、                      記号           3,351
</span><span class='line'>  日                      名詞           3,003
</span><span class='line'>  に                      助詞           2,940
</span><span class='line'>  は                      助詞           2,901
</span><span class='line'>  が                      助詞           2,685
</span><span class='line'>  「                      記号           2,646
</span><span class='line'>  」                      記号           2,620
</span><span class='line'>  /                       名詞           2,618
</span><span class='line'>  月                      名詞           2,571
</span><span class='line'>  ：                      記号           2,283
</span><span class='line'>  た                      助動詞         2,244
</span><span class='line'>  （                      記号           2,156
</span><span class='line'>  ）                      記号           2,151
</span><span class='line'>  t                       名詞           2,145
</span><span class='line'>  ://                     名詞           2,126
</span><span class='line'>  co                      名詞           2,121
</span><span class='line'>  て                      助詞           2,070
</span><span class='line'>  #                       名詞           1,912
</span><span class='line'>  で                      助詞           1,872
</span><span class='line'>  http                    名詞           1,723
</span><span class='line'>  【                      記号           1,686
</span><span class='line'>  し                      動詞           1,593
</span><span class='line'>  を                      助詞           1,566
</span><span class='line'>  】                      記号           1,494
</span><span class='line'>  と                      助詞           1,223
</span><span class='line'>  8                       名詞             931
</span><span class='line'>  2                       名詞             926
</span><span class='line'>  3                       名詞             882
</span><span class='line'>  matsue                  名詞             852
</span><span class='line'>  松江                    名詞             850
</span><span class='line'>  も                      助詞             846
</span><span class='line'>  年                      名詞             840
</span><span class='line'>  から                    助詞             800
</span><span class='line'>  2015                    名詞             783
</span><span class='line'>  市                      名詞             769
</span><span class='line'>  -                       名詞             758
</span><span class='line'>  ね                      助詞             752
</span><span class='line'>  入                      接頭詞           742
</span><span class='line'>  今日                    名詞             731
</span><span class='line'>  南中                    名詞             729
</span><span class='line'>  だ                      助動詞           721
</span><span class='line'>  12                      名詞             720
</span><span class='line'>  ない                    助動詞           700
</span><span class='line'>  (                       名詞             697
</span><span class='line'>  1                       名詞             687
</span><span class='line'>  いる                    動詞             683
</span><span class='line'>  )                       名詞             631
</span><span class='line'>  な                      助動詞           613
</span><span class='line'>  10                      名詞             609
</span><span class='line'>  9                       名詞             588
</span><span class='line'>  7                       名詞             587
</span><span class='line'>  4                       名詞             581
</span><span class='line'>  県                      名詞             570
</span><span class='line'>  こと                    名詞             563
</span><span class='line'>  情報                    名詞             557
</span><span class='line'>  い                      動詞             552
</span><span class='line'>  5                       名詞             551
</span><span class='line'>  ・                      記号             550
</span><span class='line'>  ！                      記号             547
</span><span class='line'>  する                    動詞             536
</span><span class='line'>  けど                    助詞             529
</span><span class='line'>  11                      名詞             526
</span><span class='line'>  @                       名詞             505
</span><span class='line'>  32                      名詞             502
</span><span class='line'>  BLOG                    名詞             501
</span><span class='line'>  気象庁                  名詞             479
</span><span class='line'>  さ                      動詞             474
</span><span class='line'>  ※                      記号             471
</span><span class='line'>  6                       名詞             465
</span><span class='line'>  ^M                      記号             464
</span><span class='line'>  https                   名詞             461
</span><span class='line'>  ]                       名詞             433
</span><span class='line'>  RT                      名詞             428
</span><span class='line'>  れ                      動詞             427
</span><span class='line'>  Matsue                  名詞             425
</span><span class='line'>  Wn                      名詞             420
</span><span class='line'>  よう                    名詞             420
</span><span class='line'>  ？                      記号             402
</span><span class='line'>  旧暦                    名詞             399
</span><span class='line'>  １                      名詞             398
</span><span class='line'>  頃                      名詞             395
</span><span class='line'>  日の出                  名詞             377
</span><span class='line'>  05                      名詞             376
</span><span class='line'>  か                      助詞             373
</span><span class='line'>  六                      名詞             370
</span><span class='line'>  こよみ                  名詞             367
</span><span class='line'>  曜                      名詞             366
</span><span class='line'>  干支                    名詞             366
</span><span class='line'>  明日                    名詞             365
</span><span class='line'>  月齢                    名詞             364
</span><span class='line'>  17                      名詞             364
</span><span class='line'>  出                      動詞             362
</span><span class='line'>  の                      名詞             358
</span><span class='line'>  ので                    助詞             356
</span><span class='line'>  島根                    名詞             350
</span><span class='line'>  0                       名詞             341
</span><span class='line'>  です                    助動詞           337
</span><span class='line'>  IIzWb                   名詞             326
</span><span class='line'>  Phq                     名詞             326
</span><span class='line'>  自動                    名詞             325
</span><span class='line'>  uOKnpLH                 名詞             323
</span><span class='line'>  gC                      名詞             323
</span><span class='line'>  18                      名詞             319
</span><span class='line'>  なる                    動詞             313
</span><span class='line'>  16                      名詞             312
</span><span class='line'>  19                      名詞             312
</span><span class='line'>  第                      接頭詞           307
</span><span class='line'>  的                      名詞             304
</span><span class='line'>  や                      助詞             303
</span><span class='line'>  14                      名詞             299
</span><span class='line'>  13                      名詞             299
</span><span class='line'>  で                      助動詞           292
</span><span class='line'>  06                      名詞             289
</span><span class='line'>  ある                    動詞             287
</span><span class='line'>  15                      名詞             284
</span><span class='line'>  20                      名詞             283
</span><span class='line'>  う                      助動詞           280
</span><span class='line'>  個人                    名詞             279
</span><span class='line'>  台風                    名詞             271
</span><span class='line'>  ２                      名詞             255
</span><span class='line'>  07                      名詞             250
</span><span class='line'>  という                  助詞             247
</span><span class='line'>  04                      名詞             243
</span><span class='line'>  21                      名詞             239
</span><span class='line'>  [                       名詞             236
</span><span class='line'>  号                      名詞             235
</span><span class='line'>  なっ                    動詞             232
</span><span class='line'>  地方                    名詞             230
</span><span class='line'>  22                      名詞             228
</span><span class='line'>  でしょ                  助動詞           224
</span><span class='line'>  だっ                    助動詞           220
</span><span class='line'>  気象                    名詞             210
</span><span class='line'>  観測                    名詞             207
</span><span class='line'>  等                      名詞             201
</span><span class='line'>  shimane                 名詞             199
</span><span class='line'>  23                      名詞             198
</span><span class='line'>  時                      名詞             195
</span><span class='line'>  00                      名詞             194
</span><span class='line'>  30                      名詞             193
</span><span class='line'>  】[                     名詞             192
</span><span class='line'>  °                      名詞             191
</span><span class='line'>  24                      名詞             186
</span><span class='line'>  まで                    助詞             182
</span><span class='line'>  09                      名詞             173
</span><span class='line'>  中                      名詞             172
</span><span class='line'>  地震                    名詞             171
</span><span class='line'>  もの                    名詞             170
</span><span class='line'>  03                      名詞             168
</span><span class='line'>  人                      名詞             167
</span><span class='line'>  26                      名詞             166
</span><span class='line'>  さ                      名詞             166
</span><span class='line'>  発表                    名詞             165
</span><span class='line'>  ３                      名詞             165
</span><span class='line'>  れる                    動詞             165
</span><span class='line'>  No                      名詞             163
</span><span class='line'>  ん                      名詞             163
</span><span class='line'>  27                      名詞             163
</span><span class='line'>  日本                    名詞             161
</span><span class='line'>  25                      名詞             158
</span><span class='line'>  28                      名詞             158
</span><span class='line'>  最大                    名詞             156
</span><span class='line'>  より                    助詞             156
</span><span class='line'>  かも                    助詞             155
</span><span class='line'>  Debian                  名詞             154
</span><span class='line'>  08                      名詞             153
</span><span class='line'>  35                      名詞             153
</span><span class='line'>  そう                    名詞             150
</span><span class='line'>  使用                    名詞             148
</span><span class='line'>  01                      名詞             147
</span><span class='line'>  Linux                   名詞             147
</span><span class='line'>  02                      名詞             144
</span><span class='line'>  ,                       名詞             144
</span><span class='line'>  発生                    名詞             141
</span><span class='line'>  MariaDB                 名詞             140
</span><span class='line'>  &quot;                       名詞             140
</span><span class='line'>  鳥取                    名詞             140
</span><span class='line'>  震度                    名詞             139
</span><span class='line'>  注意                    名詞             138
</span><span class='line'>  ５                      名詞             138
</span><span class='line'>  前                      名詞             136
</span><span class='line'>  ください                動詞             134
</span><span class='line'>  29                      名詞             134
</span><span class='line'>  ない                    形容詞           133
</span><span class='line'>  震源                    名詞             132
</span><span class='line'>  サーバ                  名詞             130
</span><span class='line'>  MySQL                   名詞             129
</span><span class='line'>  なく                    助動詞           128
</span><span class='line'>  度                      名詞             128
</span><span class='line'>  津波                    名詞             128
</span><span class='line'>  ば                      助詞             126
</span><span class='line'>  まし                    助動詞           125
</span><span class='line'>  50                      名詞             125
</span><span class='line'>  確認                    名詞             125
</span><span class='line'>  今                      名詞             124
</span><span class='line'>  54                      名詞             122
</span><span class='line'>  あっ                    動詞             120
</span><span class='line'>  57                      名詞             120
</span><span class='line'>  ます                    助動詞           119
</span><span class='line'>  M                       名詞             119
</span><span class='line'>  以外                    名詞             118
</span><span class='line'>  以上                    名詞             118
</span><span class='line'>  Ruby                    名詞             117
</span><span class='line'>  今年                    名詞             115
</span><span class='line'>  だけ                    助詞             115
</span><span class='line'>  38                      名詞             115
</span><span class='line'>  k                       名詞             113
</span><span class='line'>  →                      記号             112
</span><span class='line'>  でし                    助動詞           111
</span><span class='line'>  気温                    名詞             111
</span><span class='line'>  気                      名詞             110
</span><span class='line'>  思っ                    動詞             110
</span><span class='line'>  のに                    助詞             110
</span><span class='line'>  E                       名詞             110
</span><span class='line'>  心配                    名詞             109
</span><span class='line'>  規模                    名詞             109
</span><span class='line'>  Jessie                  名詞             109
</span><span class='line'>  ---                     名詞             109
</span><span class='line'>  気圧                    名詞             108
</span><span class='line'>  33                      名詞             108
</span><span class='line'>  飛行                    名詞             107
</span><span class='line'>  て                      動詞             106
</span><span class='line'>  51                      名詞             106
</span><span class='line'>  52                      名詞             106
</span><span class='line'>  N                       名詞             106
</span><span class='line'>  km                      名詞             105
</span><span class='line'>  上空                    名詞             105
</span><span class='line'>  にかけて                助詞             104
</span><span class='line'>  府県                    名詞             104
</span><span class='line'>  インストール            名詞             104
</span><span class='line'>  たら                    助動詞           104
</span><span class='line'>  注意報                  名詞             104
</span><span class='line'>  中国                    名詞             103
</span><span class='line'>  時間                    名詞             103
</span><span class='line'>  そう                    副詞             103
</span><span class='line'>  H                       名詞             103
</span><span class='line'>  へ                      助詞             102
</span><span class='line'>  69                      名詞             102
</span><span class='line'>  OS                      名詞             101
</span><span class='line'>  31                      名詞             101
</span><span class='line'>  二                      名詞             101
</span><span class='line'>  55                      名詞             101
</span><span class='line'>  :                        :                :
</span><span class='line'>  :                        :                :
</span><span class='line'>  :                        :                :
</span><span class='line'>[ 合  計 ]                             198,250 語
</span></code></pre></td></tr></table></div></figure>


<p>MeCab の仕様による分類なので、半角コロン <code>:</code> は名詞になり、全角コロン <code>：</code> は記号になったりと、非常に厳密な分類となっているのがわかる。<br/>
例年どおり、今年も助詞の「の」が今年最も使われていた。</p>

<hr />

<p>単純に数を集計するだけではなく、品詞別に集計するのも面白いものです。</p>

<p>ブログ記事は当方<a href="http://www.mk-mode.com/rails/" title="mk-mode SITE">Web サイト</a>で随時検索・参照できるようにしたりしているので、あらためて集計はしていません。</p>

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2015年12月 - OS・ブラウザ別アクセス状況！【自動集計】]]></title>
    <link href="http://komasaru.github.io/blog/2016/01/01/blog-access/"/>
    <updated>2016-01-01T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2016/01/01/blog-access</id>
    <content type="html"><![CDATA[<p>明けまして、おめでとうございます。</p>

<p>旧年中はお世話になりました。 本年もどうぞよろしくお願いします。</p>

<p>話は変わりまして、先月12月分の当ブログアクセス状況を公開します。</p>

<!--more-->


<h4>1. アクセスをOS別に集計</h4>

<table class="blog-access">
  <tr>
    <th>OS</th>
    <th>PageViews</th>
    <th>比率(%)</th>
  </tr>
  <tr>
    <td>Mac OS</td>
    <td class="blog-access-pv">31,827</td>
    <td class="blog-access-rate">60.0736</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td class="blog-access-pv">17,050</td>
    <td class="blog-access-rate">32.1820</td>
  </tr>
  <tr>
    <td>Ubuntu Linux</td>
    <td class="blog-access-pv">1,848</td>
    <td class="blog-access-rate">3.4881</td>
  </tr>
  <tr>
    <td>Linux</td>
    <td class="blog-access-pv">1,810</td>
    <td class="blog-access-rate">3.4164</td>
  </tr>
  <tr>
    <td>unknown</td>
    <td class="blog-access-pv">207</td>
    <td class="blog-access-rate">0.3907</td>
  </tr>
  <tr>
    <td>Fedora Linux</td>
    <td class="blog-access-pv">92</td>
    <td class="blog-access-rate">0.1737</td>
  </tr>
  <tr>
    <td>RedHat Linux</td>
    <td class="blog-access-pv">47</td>
    <td class="blog-access-rate">0.0887</td>
  </tr>
  <tr>
    <td>Android</td>
    <td class="blog-access-pv">36</td>
    <td class="blog-access-rate">0.0680</td>
  </tr>
  <tr>
    <td>FreeBSD</td>
    <td class="blog-access-pv">34</td>
    <td class="blog-access-rate">0.0642</td>
  </tr>
  <tr>
    <td>iPhone OS</td>
    <td class="blog-access-pv">10</td>
    <td class="blog-access-rate">0.0189</td>
  </tr>
  <tr>
    <td>Solaris</td>
    <td class="blog-access-pv">9</td>
    <td class="blog-access-rate">0.0170</td>
  </tr>
  <tr>
    <td>CentOS Linux</td>
    <td class="blog-access-pv">6</td>
    <td class="blog-access-rate">0.0113</td>
  </tr>
  <tr>
    <td>NetBSD</td>
    <td class="blog-access-pv">2</td>
    <td class="blog-access-rate">0.0038</td>
  </tr>
  <tr>
    <td>Debian GNU/Linux</td>
    <td class="blog-access-pv">2</td>
    <td class="blog-access-rate">0.0038</td>
  </tr>
  <tr>
    <td class="blog-access-total-label">合　計</td>
    <td class="blog-access-pv">52,932</td>
    <td class="blog-access-rate">100.0000</td>
  </tr>
</table>


<h4>2. アクセスをOS・バージョン別に集計（上位20件）</h4>

<table class="blog-access">
  <tr>
    <th>OS</th>
    <th>Version</th>
    <th>PageViews</th>
    <th>比率(%)</th>
  </tr>
  <tr>
    <td>Mac OS</td>
    <td>X</td>
    <td class="blog-access-pv">31,826</td>
    <td class="blog-access-rate">60.0717</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>NT</td>
    <td class="blog-access-pv">14,699</td>
    <td class="blog-access-rate">27.7444</td>
  </tr>
  <tr>
    <td>Ubuntu Linux</td>
    <td>unknown</td>
    <td class="blog-access-pv">1,840</td>
    <td class="blog-access-rate">3.4730</td>
  </tr>
  <tr>
    <td>Linux</td>
    <td>unknown</td>
    <td class="blog-access-pv">1,782</td>
    <td class="blog-access-rate">3.3635</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>7</td>
    <td class="blog-access-pv">797</td>
    <td class="blog-access-rate">1.5043</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>XP</td>
    <td class="blog-access-pv">663</td>
    <td class="blog-access-rate">1.2514</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>7 64 bit</td>
    <td class="blog-access-pv">572</td>
    <td class="blog-access-rate">1.0797</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>Vista</td>
    <td class="blog-access-pv">275</td>
    <td class="blog-access-rate">0.5191</td>
  </tr>
  <tr>
    <td>unknown</td>
    <td>unknown</td>
    <td class="blog-access-pv">206</td>
    <td class="blog-access-rate">0.3888</td>
  </tr>
  <tr>
    <td>Fedora Linux</td>
    <td>unknown</td>
    <td class="blog-access-pv">89</td>
    <td class="blog-access-rate">0.1680</td>
  </tr>
  <tr>
    <td>RedHat Linux</td>
    <td>3.6-1.el5</td>
    <td class="blog-access-pv">34</td>
    <td class="blog-access-rate">0.0642</td>
  </tr>
  <tr>
    <td>FreeBSD</td>
    <td>unknown</td>
    <td class="blog-access-pv">33</td>
    <td class="blog-access-rate">0.0623</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>8 64 bit</td>
    <td class="blog-access-pv">22</td>
    <td class="blog-access-rate">0.0415</td>
  </tr>
  <tr>
    <td>Linux</td>
    <td></td>
    <td class="blog-access-pv">18</td>
    <td class="blog-access-rate">0.0340</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>Server 2003</td>
    <td class="blog-access-pv">11</td>
    <td class="blog-access-rate">0.0208</td>
  </tr>
  <tr>
    <td>Linux</td>
    <td>64 bit</td>
    <td class="blog-access-pv">10</td>
    <td class="blog-access-rate">0.0189</td>
  </tr>
  <tr>
    <td>Android</td>
    <td>2.2</td>
    <td class="blog-access-pv">9</td>
    <td class="blog-access-rate">0.0170</td>
  </tr>
  <tr>
    <td>Android</td>
    <td>4.0.1</td>
    <td class="blog-access-pv">7</td>
    <td class="blog-access-rate">0.0132</td>
  </tr>
  <tr>
    <td>Solaris</td>
    <td>unknown</td>
    <td class="blog-access-pv">7</td>
    <td class="blog-access-rate">0.0132</td>
  </tr>
  <tr>
    <td>Android</td>
    <td>2.3.4</td>
    <td class="blog-access-pv">6</td>
    <td class="blog-access-rate">0.0113</td>
  </tr>
  <tr>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
  </tr>
  <tr>
    <td class="blog-access-total-label">合　計</td>
    <td> </td>
    <td class="blog-access-pv">52,932</td>
    <td class="blog-access-rate">100.0000</td>
  </tr>
</table>


<h4>3. アクセスをブラウザ別に集計</h4>

<table class="blog-access">
  <tr>
    <th>ブラウザ</th>
    <th>PageViews</th>
    <th>比率(%)</th>
  </tr>
  <tr>
    <td>Safari</td>
    <td class="blog-access-pv">30,742</td>
    <td class="blog-access-rate">58.0257</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td class="blog-access-pv">12,755</td>
    <td class="blog-access-rate">24.0751</td>
  </tr>
  <tr>
    <td>Mozilla</td>
    <td class="blog-access-pv">6,491</td>
    <td class="blog-access-rate">12.2518</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td class="blog-access-pv">2,095</td>
    <td class="blog-access-rate">3.9543</td>
  </tr>
  <tr>
    <td>Debian IceWeasel</td>
    <td class="blog-access-pv">471</td>
    <td class="blog-access-rate">0.8890</td>
  </tr>
  <tr>
    <td>Opera</td>
    <td class="blog-access-pv">195</td>
    <td class="blog-access-rate">0.3681</td>
  </tr>
  <tr>
    <td>Netscape Navigator</td>
    <td class="blog-access-pv">129</td>
    <td class="blog-access-rate">0.2435</td>
  </tr>
  <tr>
    <td>Chrome</td>
    <td class="blog-access-pv">41</td>
    <td class="blog-access-rate">0.0774</td>
  </tr>
  <tr>
    <td>Mozilla SeaMonkey</td>
    <td class="blog-access-pv">22</td>
    <td class="blog-access-rate">0.0415</td>
  </tr>
  <tr>
    <td>iPhone</td>
    <td class="blog-access-pv">10</td>
    <td class="blog-access-rate">0.0189</td>
  </tr>
  <tr>
    <td>Konqueror</td>
    <td class="blog-access-pv">9</td>
    <td class="blog-access-rate">0.0170</td>
  </tr>
  <tr>
    <td>PHP</td>
    <td class="blog-access-pv">7</td>
    <td class="blog-access-rate">0.0132</td>
  </tr>
  <tr>
    <td>Epiphany</td>
    <td class="blog-access-pv">6</td>
    <td class="blog-access-rate">0.0113</td>
  </tr>
  <tr>
    <td>unknown</td>
    <td class="blog-access-pv">4</td>
    <td class="blog-access-rate">0.0076</td>
  </tr>
  <tr>
    <td>SRWare Iron</td>
    <td class="blog-access-pv">2</td>
    <td class="blog-access-rate">0.0038</td>
  </tr>
  <tr>
    <td>Namoroka</td>
    <td class="blog-access-pv">1</td>
    <td class="blog-access-rate">0.0019</td>
  </tr>
  <tr>
    <td class="blog-access-total-label">合　計</td>
    <td class="blog-access-pv">52,932</td>
    <td class="blog-access-rate">100.0000</td>
  </tr>
</table>


<h4>4. アクセスをブラウザ・バージョン別に集計（上位20件）</h4>

<table class="blog-access">
  <tr>
    <th>ブラウザ</th>
    <th>Version</th>
    <th>PageViews</th>
    <th>比率(%)</th>
  </tr>
  <tr>
    <td>Safari</td>
    <td>537.36</td>
    <td class="blog-access-pv">23,045</td>
    <td class="blog-access-rate">43.4975</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>42.0</td>
    <td class="blog-access-pv">6,978</td>
    <td class="blog-access-rate">13.1710</td>
  </tr>
  <tr>
    <td>Mozilla</td>
    <td>11.0</td>
    <td class="blog-access-pv">6,491</td>
    <td class="blog-access-rate">12.2518</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>9537.53</td>
    <td class="blog-access-pv">3,117</td>
    <td class="blog-access-rate">5.8834</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>43.0</td>
    <td class="blog-access-pv">3,001</td>
    <td class="blog-access-rate">5.6644</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>601.1</td>
    <td class="blog-access-pv">1,419</td>
    <td class="blog-access-rate">2.6784</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>38.0</td>
    <td class="blog-access-pv">1,192</td>
    <td class="blog-access-rate">2.2499</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>601.3.9</td>
    <td class="blog-access-pv">713</td>
    <td class="blog-access-rate">1.3458</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>600.1.4</td>
    <td class="blog-access-pv">644</td>
    <td class="blog-access-rate">1.2156</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td>10.0</td>
    <td class="blog-access-pv">614</td>
    <td class="blog-access-rate">1.1589</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>601.2.7</td>
    <td class="blog-access-pv">609</td>
    <td class="blog-access-rate">1.1495</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td>9.0</td>
    <td class="blog-access-pv">564</td>
    <td class="blog-access-rate">1.0646</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td>8.0</td>
    <td class="blog-access-pv">563</td>
    <td class="blog-access-rate">1.0627</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td>7.0</td>
    <td class="blog-access-pv">348</td>
    <td class="blog-access-rate">0.6569</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>41.0</td>
    <td class="blog-access-pv">279</td>
    <td class="blog-access-rate">0.5266</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>534.30</td>
    <td class="blog-access-pv">272</td>
    <td class="blog-access-rate">0.5134</td>
  </tr>
  <tr>
    <td>Debian IceWeasel</td>
    <td>38.4.0</td>
    <td class="blog-access-pv">196</td>
    <td class="blog-access-rate">0.3700</td>
  </tr>
  <tr>
    <td>Opera</td>
    <td>9.80</td>
    <td class="blog-access-pv">191</td>
    <td class="blog-access-rate">0.3605</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>44.0</td>
    <td class="blog-access-pv">162</td>
    <td class="blog-access-rate">0.3058</td>
  </tr>
  <tr>
    <td>Debian IceWeasel</td>
    <td>38.5.0</td>
    <td class="blog-access-pv">145</td>
    <td class="blog-access-rate">0.2737</td>
  </tr>
  <tr>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
  </tr>
  <tr>
    <td class="blog-access-total-label">合　計</td>
    <td> </td>
    <td class="blog-access-pv">52,932</td>
    <td class="blog-access-rate">100.0000</td>
  </tr>
</table>


<hr />

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOS 6.7 - 全文検索ストレージエンジン Mroonga 導入（公式リポジトリ使用）！]]></title>
    <link href="http://komasaru.github.io/blog/2015/12/28/centos-mroonga-installation-on-mysql-56-by-yum/"/>
    <updated>2015-12-28T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2015/12/28/centos-mroonga-installation-on-mysql-56-by-yum</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>Mroonga は、全文検索エンジン Groonga をベースとした MySQL のストレージエンジンです。</p>

<p>インストール済みの MySQL（5.6 系）に Mroonga ストレージエンジンを追加する方法についての記録です。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>CentOS 6.7(i386) を Minimal で最小インストールしている。</li>
<li>クライントマシンは Linux Mint 17.2(64bit) を想定。</li>
<li>MySQL 5.6.27 での作業を想定。（5.5 系や 5.7 系では多少手順が異なるので注意）</li>
<li>当記事執筆時点で最新版の Mroonga 5.0.9 をインストールする。</li>
<li>MySQL データディレクトリ作成先は &ldquo;/var/lib/mysql&rdquo; を想定。</li>
</ul>


<h3>1. Yum リポジトリの追加</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># rpm -Uvh http://packages.groonga.org/centos/groonga-release-1.1.0-1.noarch.rpm
</span></code></pre></td></tr></table></div></figure>


<h3>2. Yum リポジトリ設定ファイルの編集</h3>

<p>今回のインストール先の OS は i386（32bit 版）である。<br/>
しかし、サーバ用途には 64bit 用パッケージを使用するよう推奨されているので、リポジトリ設定ファイルを以下のように編集する。</p>

<figure class='code'><figcaption><span>/etc/yum.repos.d/groonga.repo</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>groonga<span class="o">]</span>
</span><span class='line'><span class="nv">name</span><span class="o">=</span>Groonga <span class="k">for</span> CentOS <span class="nv">$releasever</span> - <span class="nv">$basearch</span>
</span><span class='line'><span class="c">#baseurl=http://packages.groonga.org/centos/$releasever/$basearch/  # &lt;= コメント化</span>
</span><span class='line'><span class="nv">baseurl</span><span class="o">=</span>http://packages.groonga.org/centos/<span class="nv">$releasever</span>/x86_64/      <span class="c"># &lt;= 64bit 用パッケージを指定</span>
</span><span class='line'><span class="nv">gpgcheck</span><span class="o">=</span>1
</span><span class='line'><span class="nv">enabled</span><span class="o">=</span>1
</span><span class='line'><span class="nv">gpgkey</span><span class="o">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-groonga
</span></code></pre></td></tr></table></div></figure>


<h3>3. Mroonga のインストール</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># yum -y install mysql-community-mroonga
</span></code></pre></td></tr></table></div></figure>


<p>途中でパスワードを問われるので MySQL サーバの root パスワードで応答する。</p>

<h3>4. トークナイザー MeCab のインストール</h3>

<p>トークナイザーとして MeCab を使用したい場合は、以下のようにしてインストールする。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># yum -y install groonga-tokenizer-mecab
</span></code></pre></td></tr></table></div></figure>


<h3>5. 動作確認</h3>

<p>MySQL サーバにログインしてみる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mysql -u root -p
</span><span class='line'>Enter password:
</span><span class='line'>Welcome to the MySQL monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 96
</span><span class='line'>Server version: 5.6.27 MySQL Community Server (GPL)
</span><span class='line'>
</span><span class='line'>Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.
</span><span class='line'>
</span><span class='line'>Oracle is a registered trademark of Oracle Corporation and/or its
</span><span class='line'>affiliates. Other names may be trademarks of their respective
</span><span class='line'>owners.
</span><span class='line'>
</span><span class='line'>Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
</span><span class='line'>
</span><span class='line'>mysql&gt; SHOW ENGINES;
</span><span class='line'>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
</span><span class='line'>| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |
</span><span class='line'>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
</span><span class='line'>| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |
</span><span class='line'>| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |
</span><span class='line'>| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |
</span><span class='line'>| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |
</span><span class='line'>| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |
</span><span class='line'>| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |
</span><span class='line'>| Mroonga            | YES     | CJK-ready fulltext search, column store                        | NO           | NO   | NO         |
</span><span class='line'>| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |
</span><span class='line'>| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |
</span><span class='line'>| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |
</span><span class='line'>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
</span><span class='line'>10 rows in set (0.00 sec)
</span></code></pre></td></tr></table></div></figure>


<p>ストレージエンジン <code>Mroonga</code> が有効になっているか（<code>Mroonga</code> 行が存在するか）確認する。</p>

<p>その他の Mroonga に関する動作確認は過去記事参照。</p>

<ul>
<li><a href="http://komasaru.github.io/2015/08/21/mariadb-mroonga-installation/" title="MariaDB 10.0.x - Mroonga プラグインの有効化！">MariaDB 10.0.x - Mroonga プラグインの有効化！</a></li>
</ul>


<h3>参考サイト</h3>

<ul>
<li><a href="http://mroonga.org/ja/docs/install/centos.html#centos-6-with-the-oracle-mysql-5-6-package" title="2.5. CentOS — Mroonga v5.09 documentation">2.5. CentOS — Mroonga v5.09 documentation</a></li>
</ul>


<hr />

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[jQuery - 古いブログ記事にメッセージを付加！]]></title>
    <link href="http://komasaru.github.io/blog/2015/12/24/jquery-remarking-old-blog-post/"/>
    <updated>2015-12-24T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2015/12/24/jquery-remarking-old-blog-post</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>ブログ記事が古い場合に、昔執筆した記事で情報が古い可能性があるというメッセージを jQuery を使用して出力するようにします。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>ブログサイトの HTML 内に記事を執筆か投稿した日時が格納されていること。</li>
<li>jQuery を利用できる環境が整っていること。</li>
<li>jQuery スクリプトは別ファイルに分けることを想定。（当然、分けなくても大丈夫）</li>
<li>HTML の構成等は環境（使用しているブログソフトや個人の趣味趣向等）により異なるので、以下の文章は適宜置き換えて考えること。</li>
</ul>


<h3>1. 想定する HTML の構成</h3>

<ul>
<li>JavaScript(jQuery) は別ファイルに分け、 <code>&lt;haed&gt;</code> タグ内から呼び出す。</li>
<li><code>&lt;body&gt;</code> - <code>&lt;article class='hentry'&gt;</code> - <code>&lt;header&gt;</code> - <code>&lt;time&gt;</code> タグの <code>datetime</code> 属性にブログの投稿日時が格納されていることを想定。</li>
<li><code>&lt;div class='entry-content'&gt;</code> タグ内がブログ記事の内容。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>    :
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;/path/to/my_custom.js&quot;</span> <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    :
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>    :
</span><span class='line'>  <span class="nt">&lt;article</span> <span class="na">class=</span><span class="s">&#39;hentry&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;header&gt;</span>
</span><span class='line'>      <span class="nt">&lt;time</span> <span class="na">class=</span><span class="s">&#39;entry-date&#39;</span> <span class="na">datetime=</span><span class="s">&#39;2014-11-29T00:20:00+09:00&#39;</span><span class="nt">&gt;</span>2014-11-29 00:20<span class="nt">&lt;/time&gt;</span>
</span><span class='line'>        :
</span><span class='line'>    <span class="nt">&lt;/header&gt;</span>
</span><span class='line'>      :
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&#39;entry-content&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>      :
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/article&gt;</span>
</span><span class='line'>    :
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. jQuery スクリプトの作成</h3>

<figure class='code'><figcaption><span>/path/to/my_custom.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="c1">// １年以上前の記事ならメッセージを表示</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;article.hentry header time&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>        <span class="c1">// １年前の日付を取得</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">pastDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">pastDate</span><span class="p">.</span><span class="nx">setFullYear</span><span class="p">(</span><span class="nx">pastDate</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 該当記事の日付を取得</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">thisDate</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;datetime&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">thisDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">thisDate</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// メッセージ出力</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">thisDate</span> <span class="o">&lt;=</span> <span class="nx">pastDate</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;div.entry-content&quot;</span><span class="p">).</span><span class="nx">before</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;remark&quot;&gt;※この記事は１年以上前に書かれたもので、情報が古い場合があります。&lt;/div&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. スタイルシートの編集</h3>

<p>必要なら CSS スタイルシートを編集する。（以下は当方の例）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">div</span><span class="nc">.remark</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">color</span><span class="o">:</span>     <span class="m">#F06060</span><span class="p">;</span>
</span><span class='line'>  <span class="k">font-size</span><span class="o">:</span> <span class="m">0.8em</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4. 動作確認</h3>

<p>ブラウザで確認してみる。<br/>
１年以上前の記事の場合記事本文の先頭にメッセージが出力されるはず。</p>

<p><img src="images/2015/12/24/JQUERY_OLD_POST.png" title="JQUERY_OLD_POST" alt="JQUERY_OLD_POST" /></p>

<hr />

<p>これで、記事を閲覧された方が古い情報だと思わず信じ込んでしまうことが少なくなるでしょう。</p>

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOS - MySQL 5.7 インストール（ソースビルド）！]]></title>
    <link href="http://komasaru.github.io/blog/2015/12/20/centos-mysql-57-installation-by-src/"/>
    <updated>2015-12-20T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2015/12/20/centos-mysql-57-installation-by-src</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>MySQL 5.7 系の最新版をソースをビルドして CentOS 6.7 にインストールする方法についてです。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>CentOS 6.7(32bit) での作業を想定。</li>
<li>搭載メモリは 1GB を想定。</li>
</ul>


<h3>1. 必要パッケージの準備</h3>

<p>以下の必要なパッケージが未インストールならインストールしておく。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># yum install wget cmake gcc-c++ ncurses-devel zlib-devel
</span></code></pre></td></tr></table></div></figure>


<h3>2. MySQL ユーザ・グループの作成</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># groupadd mysql
</span><span class='line'># useradd -r -g mysql -s /bin/false mysql
</span></code></pre></td></tr></table></div></figure>


<h3>3. ソースの取得</h3>

<p>アーカイブファイルを取得、展開後、ディレクトリを移動しておく。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># cd /usr/local/src/
</span><span class='line'># wget http://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.9.tar.gz
</span><span class='line'># tar zxvf mysql-5.7.9.tar.gz
</span><span class='line'># cd mysql-5.7.9
</span></code></pre></td></tr></table></div></figure>


<h3>4. Makefile の生成</h3>

<p><code>cmake</code> コマンドで Makefile を生成する。（よくある <code>configure</code> コマンドと同様の位置付け）</p>

<p>オプションは、デフォルト値とが異なる値を設定したいものだけを指定する。<br/>
（MySQL 5.7 からは C++ Boost ライブラリが必要なので <code>DOWNLOAD_BOOST</code> と <code>WITH_BOOST</code> は必須）<br/>
※デフォルト値は<a href="http://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html" title="MySQL :: MySQL 5.7 Reference Manual :: 2.9.4 MySQL Source-Configuration Options">こちら</a>を参照。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># cmake . \
</span><span class='line'> -DMYSQL_UNIX_ADDR=/var/run/mysqld/mysqld.sock \
</span><span class='line'> -DMYSQL_DATADIR=/var/lib/mysql \
</span><span class='line'> -DDEFAULT_CHARSET=utf8 \
</span><span class='line'> -DDEFAULT_COLLATION=utf8_general_ci \
</span><span class='line'> -DDOWNLOAD_BOOST=1 \
</span><span class='line'> -DWITH_BOOST=/usr/local/mysql
</span></code></pre></td></tr></table></div></figure>


<p><code>cmake</code> が途中で失敗した等の理由で <code>cmake</code> を再実行する場合は、キャッシュをクリアしてから再実行する。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># rm CMakeCache.txt
</span></code></pre></td></tr></table></div></figure>


<h3>5. ビルド</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># make
</span></code></pre></td></tr></table></div></figure>


<p>（時間がかかる）</p>

<h3>6. インストール</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># make install
</span></code></pre></td></tr></table></div></figure>


<h3>7. 環境変数 PATH の設定</h3>

<figure class='code'><figcaption><span>/etc/bashrc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/mysql/bin
</span></code></pre></td></tr></table></div></figure>


<p>そして、即時反映。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># source /etc/bashrc
</span></code></pre></td></tr></table></div></figure>


<h3>8. インストールの確認</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mysqld --version
</span><span class='line'>mysqld  Ver 5.7.9 for Linux on i686 (Source distribution)
</span></code></pre></td></tr></table></div></figure>


<h3>9. 所有者・所有グループの設定</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># cd /usr/local/mysql
</span><span class='line'># chown -R mysql. .
</span></code></pre></td></tr></table></div></figure>


<h3>10. 初期設定</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># bin/mysqld --initialize --user=mysql
</span><span class='line'># bin/mysql_ssl_rsa_setup
</span><span class='line'># chown -R mysql. /var/lib/mysql
</span></code></pre></td></tr></table></div></figure>


<h3>11. 設定ファイルの編集</h3>

<p>環境に合わせて、 &ldquo;/etc/my.cnf&rdquo; を編集する。（サンプルは &ldquo;/usr/local/mysql/support-files&rdquo; ディレクトリ内にある）<br/>
以下は当方の取り急ぎの例。（実際には、熟考して詳細に設定すること）</p>

<figure class='code'><figcaption><span>/etc/my.cnf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># For advice on how to change settings please see</span>
</span><span class='line'><span class="c"># http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mysqld<span class="o">]</span>
</span><span class='line'><span class="c"># ==== Basis</span>
</span><span class='line'>server-id <span class="o">=</span> <span class="m">2</span>  <span class="c"># レプリケーション用 (1 〜 2^32 - 1)</span>
</span><span class='line'><span class="nv">user</span>                   <span class="o">=</span> mysql
</span><span class='line'><span class="nv">datadir</span>                <span class="o">=</span> /var/lib/mysql
</span><span class='line'><span class="nv">socket</span>                 <span class="o">=</span> /var/lib/mysql/mysql.sock
</span><span class='line'>pid-file               <span class="o">=</span> /var/run/mysqld/mysqld.pid
</span><span class='line'>skip_external_locking
</span><span class='line'><span class="nv">sql_mode</span>               <span class="o">=</span> NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES
</span><span class='line'><span class="nv">character_set_server</span>   <span class="o">=</span> utf8
</span><span class='line'>collation-server       <span class="o">=</span> utf8_general_ci
</span><span class='line'><span class="nv">default_storage_engine</span> <span class="o">=</span> InnoDB           <span class="c"># Default: InnodDB</span>
</span><span class='line'><span class="nv">lc_messages</span>            <span class="o">=</span> en_US            <span class="c"># Default: en_US</span>
</span><span class='line'><span class="nv">lc_messages_dir</span>        <span class="o">=</span> /usr/share/mysql
</span><span class='line'>
</span><span class='line'><span class="c"># ==== Network, Connection</span>
</span><span class='line'><span class="nv">port</span>                 <span class="o">=</span> 3306
</span><span class='line'><span class="nb">bind</span>-address         <span class="o">=</span> 0.0.0.0  <span class="c"># 127.0.0.1</span>
</span><span class='line'><span class="nv">max_connections</span>      <span class="o">=</span> <span class="m">100</span>      <span class="c"># Default: 151</span>
</span><span class='line'><span class="nv">max_connect_errors</span>   <span class="o">=</span> <span class="m">100</span>      <span class="c"># Default: 100</span>
</span><span class='line'><span class="nv">max_user_connections</span> <span class="o">=</span> <span class="m">0</span>        <span class="c"># Default: 0</span>
</span><span class='line'><span class="nv">wait_timeout</span>         <span class="o">=</span> <span class="m">300</span>      <span class="c"># Default: 28800</span>
</span><span class='line'><span class="nv">interactive_timeout</span>  <span class="o">=</span> <span class="m">3600</span>     <span class="c"># Default: 28800</span>
</span><span class='line'><span class="nv">connect_timeout</span>      <span class="o">=</span> <span class="m">30</span>       <span class="c"># Default: 10</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ==== Buffer</span>
</span><span class='line'><span class="nv">max_allowed_packet</span>      <span class="o">=</span> 32M   <span class="c"># Default: 1M</span>
</span><span class='line'><span class="nv">thread_cache_size</span>       <span class="o">=</span> <span class="m">40</span>    <span class="c"># Default: 0 (max_connections の 1/3 程度?)</span>
</span><span class='line'><span class="nv">table_open_cache</span>        <span class="o">=</span> <span class="m">400</span>   <span class="c"># Default: 400 (同時接続数 * テーブル数?)</span>
</span><span class='line'><span class="nv">tmp_table_size</span>          <span class="o">=</span> 16M   <span class="c"># Default: System 依存 (for Memory, &lt;= max_heap_table_size)</span>
</span><span class='line'><span class="nv">max_heap_table_size</span>     <span class="o">=</span> 32M   <span class="c"># Default: 16M         (for Memory, &gt;= tmp_table_size)</span>
</span><span class='line'><span class="nv">sort_buffer_size</span>        <span class="o">=</span> 4M    <span class="c"># Default: 2M</span>
</span><span class='line'><span class="nv">read_buffer_size</span>        <span class="o">=</span> 4M    <span class="c"># Default: 128K</span>
</span><span class='line'><span class="nv">read_rnd_buffer_size</span>    <span class="o">=</span> 4M    <span class="c"># Default: 256K</span>
</span><span class='line'><span class="nv">join_buffer_size</span>        <span class="o">=</span> 4M    <span class="c"># Default: 128K</span>
</span><span class='line'><span class="nv">query_cache_size</span>        <span class="o">=</span> 32M   <span class="c"># Default: 0</span>
</span><span class='line'><span class="nv">query_cache_limit</span>       <span class="o">=</span> 16M   <span class="c"># Default: 1M</span>
</span><span class='line'><span class="nv">thread_stack</span>            <span class="o">=</span> 192K  <span class="c"># Default: 192K(32bit), 288K(64bit)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ==== MyISAM</span>
</span><span class='line'><span class="nv">key_buffer_size</span>         <span class="o">=</span> 8M    <span class="c"># Default: 8M (for MyISAM)</span>
</span><span class='line'><span class="nv">myisam_sort_buffer_size</span> <span class="o">=</span> 8M    <span class="c"># Default: 8M (for MyISAM)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ==== Binary Log</span>
</span><span class='line'><span class="nv">log_bin</span>          <span class="o">=</span> mysql-bin
</span><span class='line'><span class="nv">expire_logs_days</span> <span class="o">=</span> 10
</span><span class='line'><span class="nv">max_binlog_size</span>  <span class="o">=</span> 100M
</span><span class='line'><span class="nv">binlog_format</span>    <span class="o">=</span> MIXED
</span><span class='line'><span class="nv">log_bin_trust_function_creators</span> <span class="o">=</span> <span class="m">1</span>  <span class="c"># Default: 0 (for TRIGGER)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ==== InnoDB</span>
</span><span class='line'><span class="nv">innodb_data_file_path</span>           <span class="o">=</span> ibdata1:1G  <span class="c">#:autoextend</span>
</span><span class='line'><span class="nv">innodb_autoextend_increment</span>     <span class="o">=</span> <span class="m">64</span>          <span class="c"># Default: 64</span>
</span><span class='line'><span class="nv">innodb_file_per_table</span>           <span class="o">=</span> 1
</span><span class='line'><span class="nv">innodb_file_format</span>              <span class="o">=</span> Barracuda   <span class="c"># Default: Antelope</span>
</span><span class='line'><span class="nv">innodb_file_format_max</span>          <span class="o">=</span> Barracuda   <span class="c"># Default: Antelope</span>
</span><span class='line'><span class="nv">innodb_large_prefix</span>             <span class="o">=</span> <span class="m">1</span>           <span class="c"># Default: 0</span>
</span><span class='line'><span class="nv">innodb_buffer_pool_size</span>         <span class="o">=</span> 768M        <span class="c"># Default: 128M (innodb_log_files_in_group * innodb_log_file_size &lt; innodb_buffer_pool_size)</span>
</span><span class='line'><span class="c">#innodb_buffer_pool_instances    = 8          # Default: autosized(32bit), 8(64bit) (innodb_buffer_pool_size &gt;= 1G の場合にのみ有効)</span>
</span><span class='line'><span class="nv">innodb_sort_buffer_size</span>         <span class="o">=</span> 2M          <span class="c"># Default: 1M</span>
</span><span class='line'><span class="nv">innodb_write_io_threads</span>         <span class="o">=</span> <span class="m">4</span>           <span class="c"># Default: 4 (1 - 64)</span>
</span><span class='line'><span class="nv">innodb_read_io_threads</span>          <span class="o">=</span> <span class="m">4</span>           <span class="c"># Default: 4 (1 - 64)</span>
</span><span class='line'><span class="nv">innodb_log_buffer_size</span>          <span class="o">=</span> 32M         <span class="c"># Default: 8M</span>
</span><span class='line'><span class="nv">innodb_log_group_home_dir</span>       <span class="o">=</span> /var/lib/mysql
</span><span class='line'><span class="nv">innodb_log_files_in_group</span>       <span class="o">=</span> <span class="m">2</span>           <span class="c"># Default: 2</span>
</span><span class='line'><span class="nv">innodb_log_file_size</span>            <span class="o">=</span> 256M        <span class="c"># Default: 48M (innodb_log_files_in_group * innodb_log_file_size &lt; innodb_buffer_pool_size)</span>
</span><span class='line'><span class="nv">innodb_max_dirty_pages_pct</span>      <span class="o">=</span> <span class="m">90</span>          <span class="c"># Default: 75(%)</span>
</span><span class='line'><span class="nv">innodb_io_capacity</span>              <span class="o">=</span> <span class="m">100</span>         <span class="c"># Default: 200 (100 - 2^64-1)</span>
</span><span class='line'><span class="nv">innodb_io_capacity_max</span>          <span class="o">=</span> <span class="m">200</span>         <span class="c"># Default: 200 (100 - 2^64-1)</span>
</span><span class='line'><span class="nv">innodb_lru_scan_depth</span>           <span class="o">=</span> <span class="m">100</span>         <span class="c"># Default: 1024 (100 - 2^32-1(32bit))</span>
</span><span class='line'><span class="nv">innodb_flush_method</span>             <span class="o">=</span> O_DIRECT    <span class="c"># Default: Not set</span>
</span><span class='line'><span class="nv">innodb_flush_log_at_trx_commit</span>  <span class="o">=</span> <span class="m">1</span>           <span class="c"># Default: 1</span>
</span><span class='line'><span class="nv">innodb_doublewrite</span>              <span class="o">=</span> <span class="m">1</span>           <span class="c"># Default: 1</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ==== Log</span>
</span><span class='line'><span class="nv">log_output</span>          <span class="o">=</span> FILE  <span class="c"># Default: FILE</span>
</span><span class='line'>log-error           <span class="o">=</span> /var/log/mysql/error.log
</span><span class='line'><span class="c">#general_log_file    = /var/log/mysql/mysql.log  # デバッグ時に有効化</span>
</span><span class='line'><span class="c">#general_log         = 1                         # デバッグ時に有効化</span>
</span><span class='line'><span class="c">#slow_query_log_file = /var/log/mysql/slow.log   # デバッグ時に有効化</span>
</span><span class='line'><span class="c">#slow_query_log      = 1                         # デバッグ時に有効化</span>
</span><span class='line'><span class="c">#long_query_time     = 30                        # デバッグ時に有効化</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ==== Event Scheduler</span>
</span><span class='line'><span class="nv">event_scheduler</span> <span class="o">=</span> <span class="m">1</span>  <span class="c"># Default: 0</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>client<span class="o">]</span>
</span><span class='line'><span class="nv">port</span>   <span class="o">=</span> 3306
</span><span class='line'><span class="nv">socket</span> <span class="o">=</span> /var/lib/mysql/mysql.sock
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mysqld_safe<span class="o">]</span>
</span><span class='line'><span class="nv">socket</span> <span class="o">=</span> /var/lib/mysql/mysql.sock
</span><span class='line'><span class="nv">nice</span>   <span class="o">=</span> 0
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mysqldump<span class="o">]</span>
</span><span class='line'>quick
</span><span class='line'>quote-names
</span><span class='line'><span class="nv">max_allowed_packet</span> <span class="o">=</span> 32M
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mysql<span class="o">]</span>
</span><span class='line'><span class="nv">pager</span><span class="o">=</span><span class="s2">&quot;less -n -i -F -X -E&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>isamchk<span class="o">]</span>
</span><span class='line'><span class="nv">key_buffer</span> <span class="o">=</span> 16M
</span><span class='line'>
</span><span class='line'><span class="o">[</span>myisamchk<span class="o">]</span>
</span><span class='line'><span class="nv">key_buffer_size</span>  <span class="o">=</span> 128M
</span><span class='line'><span class="nv">sort_buffer_size</span> <span class="o">=</span> 128M
</span><span class='line'><span class="nv">read_buffer</span>      <span class="o">=</span> 2M
</span><span class='line'><span class="nv">write_buffer</span>     <span class="o">=</span> 2M
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mysqlhotcopy<span class="o">]</span>
</span><span class='line'>interactive-timeout
</span></code></pre></td></tr></table></div></figure>


<h3>12. PID 用ディレクトリの作成</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mkdir /var/run/mysqld
</span><span class='line'># chown -R mysql. /var/run/mysqld
</span></code></pre></td></tr></table></div></figure>


<h3>13. 起動スクリプトの作成</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># cp support-files/mysql.server /etc/rc.d/init.d/mysqld
</span><span class='line'># chown root:root /etc/rc.d/init.d/mysqld
</span><span class='line'># chmod 755 /etc/rc.d/init.d/mysqld
</span></code></pre></td></tr></table></div></figure>


<p>そして、編集する。</p>

<figure class='code'><figcaption><span>/etc/rc.d/init.d/mysqld</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">basedir</span><span class="o">=</span>/usr/local/mysql
</span><span class='line'><span class="nv">datadir</span><span class="o">=</span>/var/lib/mysql
</span></code></pre></td></tr></table></div></figure>


<h3>14. 自動起動の設定</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># chkconfig --add mysqld
</span><span class='line'># chkconfig mysqld on
</span><span class='line'># chkconfig --list mysqld
</span><span class='line'>mysqld          0:off   1:off   2:on    3:on    4:on    5:on    6:off
</span></code></pre></td></tr></table></div></figure>


<h3>15. MySQL サーバの起動</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># /etc/rc.d/init.d/mysqld start
</span></code></pre></td></tr></table></div></figure>


<h3>16. root 初期パスワードの確認</h3>

<p>（記録されているログファイルは環境により異なる）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># grep &#39;temporary password&#39; /var/log/mysql/error.log
</span><span class='line'>2015-11-29T06:05:51.282215Z 1 [Note] A temporary password is generated for root@localhost: wH!Y#&gt;(lQ7aQ
</span></code></pre></td></tr></table></div></figure>


<h3>17. MySQL の安全化</h3>

<p>root パスワードの設定等を行う。（説明は後述）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mysql_secure_installation
</span><span class='line'>
</span><span class='line'>Securing the MySQL server deployment.
</span><span class='line'>
</span><span class='line'>Enter password for user root:
</span><span class='line'>The &#39;validate_password&#39; plugin is installed on the server.
</span><span class='line'>The subsequent steps will run with the existing configuration
</span><span class='line'>of the plugin.
</span><span class='line'>Using existing password for root.
</span><span class='line'>
</span><span class='line'>Estimated strength of the password: 100
</span><span class='line'>Change the password for root ? ((Press y|Y for Yes, any other key for No) : y
</span><span class='line'>
</span><span class='line'>New password:
</span><span class='line'>
</span><span class='line'>Re-enter new password:
</span><span class='line'>
</span><span class='line'>Estimated strength of the password: 100
</span><span class='line'>Change the password for root ? ((Press y|Y for Yes, any other key for No) : n
</span><span class='line'>
</span><span class='line'> ... skipping.
</span><span class='line'>By default, a MySQL installation has an anonymous user,
</span><span class='line'>allowing anyone to log into MySQL without having to have
</span><span class='line'>a user account created for them. This is intended only for
</span><span class='line'>testing, and to make the installation go a bit smoother.
</span><span class='line'>You should remove them before moving into a production
</span><span class='line'>environment.
</span><span class='line'>
</span><span class='line'>Remove anonymous users? (Press y|Y for Yes, any other key for No) : y
</span><span class='line'>Success.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Normally, root should only be allowed to connect from
</span><span class='line'>&#39;localhost&#39;. This ensures that someone cannot guess at
</span><span class='line'>the root password from the network.
</span><span class='line'>
</span><span class='line'>Disallow root login remotely? (Press y|Y for Yes, any other key for No) : n
</span><span class='line'>
</span><span class='line'> ... skipping.
</span><span class='line'>By default, MySQL comes with a database named &#39;test&#39; that
</span><span class='line'>anyone can access. This is also intended only for testing,
</span><span class='line'>and should be removed before moving into a production
</span><span class='line'>environment.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y
</span><span class='line'> - Dropping test database...
</span><span class='line'>Success.
</span><span class='line'>
</span><span class='line'> - Removing privileges on test database...
</span><span class='line'>Success.
</span><span class='line'>
</span><span class='line'>Reloading the privilege tables will ensure that all changes
</span><span class='line'>made so far will take effect immediately.
</span><span class='line'>
</span><span class='line'>Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y
</span><span class='line'>Success.
</span><span class='line'>
</span><span class='line'>All done!
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><code>Enter password for user root:</code> で root の初期パスワードを入力する。</li>
<li><code>New password:</code> で root の新しいパスワードを設定する。<br/>
（パスワードに使用する文字は数字・英小文字・英大文字・記号を混在させること。そうしなければポリシー違反でエラーになる）</li>
<li><code>Re-enter new password:</code> で root の新しいパスワードの確認入力をする。</li>
<li><code>Estimated strength of the password: 100 ...</code> でより強固なパスワードに変更するか問われるが、 <code>n</code> で応答する。（当然 <code>y</code> でもよい）</li>
<li><code>Remove anonymous users?</code> で匿名ユーザを削除するために <code>y</code> で応答する。</li>
<li><code>Disallow root login remotely?</code> で root のリモート接続を拒否するか問われるが、リモート接続したいので <code>n</code> で応答する。（当然 <code>y</code> でもよい）</li>
<li><code>Remove test database and access to it?</code> でテストデータベースを削除するか問われるので、 <code>y</code> で応答する。</li>
<li><code>Reload privilege tables now?</code> で権限テーブルを即時リロードするか問われるので、 <code>y</code> で応答する。</li>
</ol>


<h3>18. 動作確認</h3>

<p>MySQL サーバにログインしてみる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mysql -u root -p
</span><span class='line'>Enter password:
</span><span class='line'>Welcome to the MySQL monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 10
</span><span class='line'>Server version: 5.7.9-log Source distribution
</span><span class='line'>
</span><span class='line'>Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.
</span><span class='line'>
</span><span class='line'>Oracle is a registered trademark of Oracle Corporation and/or its
</span><span class='line'>affiliates. Other names may be trademarks of their respective
</span><span class='line'>owners.
</span><span class='line'>
</span><span class='line'>Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
</span><span class='line'>
</span><span class='line'>mysql&gt;
</span></code></pre></td></tr></table></div></figure>


<p>その他、各種操作を試してみる。</p>

<h3>19. その他</h3>

<ul>
<li>設定ファイルは &ldquo;/etc/my.cnf&rdquo; なので、実際に運用する際には綿密に検討して設定する。</li>
<li>パスワードの有効期限がデフォルトでは「360 日」に設定されている。<br/>
必要なら、システム変数 <code>default_password_lifetime</code> を編集する。</li>
</ul>


<h3>20. 参考サイト</h3>

<ul>
<li><a href="http://dev.mysql.com/doc/refman/5.7/en/source-installation.html" title="MySQL :: MySQL 5.7 Reference Manual :: 2.9 Installing MySQL from Source">MySQL :: MySQL 5.7 Reference Manual :: 2.9 Installing MySQL from Source</a></li>
</ul>


<hr />

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOS 7.1 - DB サーバ MySQL 5.7 構築（公式リポジトリ使用）！]]></title>
    <link href="http://komasaru.github.io/blog/2015/12/16/centos-mysql-57-installation-by-yum/"/>
    <updated>2015-12-16T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2015/12/16/centos-mysql-57-installation-by-yum</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>MySQL 5.7 系の最新版を公式リポジトリを使用して CentOS 7.1 にインストールする方法についてです。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>CentOS 7.1-1503(x86_64) での作業を想定。（CentOS 6 系、5系でも同様（起動方法、自動起動設定、ファイアウォール設定以外は））</li>
<li>当記事執筆時点で最新の MySQL 5.7.9 をインストールする。</li>
<li>環境の相違によっては以下のとおりにならないかもしれないので、適宜対応する。</li>
</ul>


<h3>1. Yum リポジトリの追加</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># rpm -Uvh http://dev.mysql.com/get/mysql57-community-release-el7-7.noarch.rpm
</span></code></pre></td></tr></table></div></figure>


<h3>2. リポジトリ有効・無効の設定</h3>

<p>まず、どんな種類があるのかを確認してみる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># yum repolist all | grep mysql
</span><span class='line'>mysql-connectors-community/x86_64 MySQL Connectors Community     有効:      13+4
</span><span class='line'>mysql-connectors-community-source MySQL Connectors Community - S 無効
</span><span class='line'>mysql-tools-community/x86_64      MySQL Tools Community          有効:        27
</span><span class='line'>mysql-tools-community-source      MySQL Tools Community - Source 無効
</span><span class='line'>mysql55-community/x86_64          MySQL 5.5 Community Server     無効
</span><span class='line'>mysql55-community-source          MySQL 5.5 Community Server - S 無効
</span><span class='line'>mysql56-community/x86_64          MySQL 5.6 Community Server     無効
</span><span class='line'>mysql56-community-source          MySQL 5.6 Community Server - S 無効
</span><span class='line'>mysql57-community/x86_64          MySQL 5.7 Community Server     有効:        20
</span><span class='line'>mysql57-community-source          MySQL 5.7 Community Server - S 無効
</span></code></pre></td></tr></table></div></figure>


<p>今回は MySQL 5.7 Community Server を使用したいので、<code>mysql57-community/x86_64</code> が <code>有効</code> であることを確認する。</p>

<p><code>無効</code> の場合は、 &ldquo;/etc/yum.repos.d/mysql-community.repo&rdquo; 内 <code>[mysql57-community]</code> の <code>enabled</code> の値を <code>0</code> から <code>1</code> に変更する。<br/>
さらに、今回使用したいバージョン以外の MySQL Community Server が <code>有効</code> になっていれば、無効（<code>enabled=0</code>）に変更しておく。</p>

<figure class='code'><figcaption><span>/etc/yum.repos.d/mysql-community.repo</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>[mysql57-community]
</span><span class='line'>name=MySQL 5.7 Community Server
</span><span class='line'>baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch/
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=1
</span><span class='line'>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql
</span></code></pre></td></tr></table></div></figure>


<p>そして、有効になったか確認してみる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># yum repolist enabled | grep mysql
</span><span class='line'>mysql-connectors-community/x86_64 MySQL Connectors Community                13+4
</span><span class='line'>mysql-tools-community/x86_64      MySQL Tools Community                       27
</span><span class='line'>mysql57-community/x86_64          MySQL 5.7 Community Server                  20
</span></code></pre></td></tr></table></div></figure>


<h3>3. MySQL のインストール</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># yum -y install mysql-community-server
</span><span class='line'>
</span><span class='line'># mysqld --version   # &lt;= サーバのバージョン
</span><span class='line'>mysqld  Ver 5.7.9 for Linux on x86_64 (MySQL Community Server (GPL))
</span><span class='line'>
</span><span class='line'># mysql --version    # &lt;= クライアントのバージョン
</span><span class='line'>mysql  Ver 14.14 Distrib 5.7.9, for Linux (x86_64) using  EditLine wrapper
</span></code></pre></td></tr></table></div></figure>


<h3>4. MySQL サーバの起動</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># systemctl start mysqld
</span><span class='line'>
</span><span class='line'># systemctl status mysqld
</span><span class='line'>mysqld.service - MySQL Server
</span><span class='line'>   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled)
</span><span class='line'>   Active: active (running) since 日 2015-11-08 23:03:02 JST; 8s ago
</span><span class='line'>  Process: 1843 ExecStart=/usr/sbin/mysqld --daemonize $MYSQLD_OPTS (code=exited, status=0/SUCCESS)
</span><span class='line'>  Process: 1772 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)
</span><span class='line'> Main PID: 1847 (mysqld)
</span><span class='line'>   CGroup: /system.slice/mysqld.service
</span><span class='line'>           └─1847 /usr/sbin/mysqld --daemonize
</span><span class='line'>
</span><span class='line'>11月 08 23:02:53 vbox.mk-mode.com systemd[1]: Starting MySQL Server...
</span><span class='line'>11月 08 23:03:02 vbox.mk-mode.com systemd[1]: Started MySQL Server.
</span><span class='line'>Hint: Some lines were ellipsized, use -l to show in full.
</span></code></pre></td></tr></table></div></figure>


<h3>5. MySQL 自動起動の設定</h3>

<p>デフォルトでマシン起動時に MySQL サーバが自動で起動するようになっているが、なっていなければ以下のように設定する。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># systemctl enable mysqld
</span><span class='line'>
</span><span class='line'># systemctl list-unit-files -t service | grep mysqld
</span><span class='line'>mysqld.service                            enabled  # &lt;= enabled であることを確認
</span></code></pre></td></tr></table></div></figure>


<h3>6. root 初期パスワードの確認</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># grep &#39;temporary password&#39; /var/log/mysqld.log
</span><span class='line'>2015-11-08T14:02:55.559389Z 1 [Note] A temporary password is generated for root@localhost: &amp;d-sa*dv/7Ct
</span></code></pre></td></tr></table></div></figure>


<h3>7. MySQL の安全化</h3>

<p>root パスワードの設定等を行う。（説明は後述）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mysql_secure_installation
</span><span class='line'>
</span><span class='line'>Securing the MySQL server deployment.
</span><span class='line'>
</span><span class='line'>Enter password for user root:
</span><span class='line'>
</span><span class='line'>The existing password for the user account root has expired. Please set a new password.
</span><span class='line'>
</span><span class='line'>New password:
</span><span class='line'>
</span><span class='line'>Re-enter new password:
</span><span class='line'>The &#39;validate_password&#39; plugin is installed on the server.
</span><span class='line'>The subsequent steps will run with the existing configuration
</span><span class='line'>of the plugin.
</span><span class='line'>Using existing password for root.
</span><span class='line'>
</span><span class='line'>Estimated strength of the password: 100
</span><span class='line'>Change the password for root ? ((Press y|Y for Yes, any other key for No) : n
</span><span class='line'>
</span><span class='line'> ... skipping.
</span><span class='line'>By default, a MySQL installation has an anonymous user,
</span><span class='line'>allowing anyone to log into MySQL without having to have
</span><span class='line'>a user account created for them. This is intended only for
</span><span class='line'>testing, and to make the installation go a bit smoother.
</span><span class='line'>You should remove them before moving into a production
</span><span class='line'>environment.
</span><span class='line'>
</span><span class='line'>Remove anonymous users? (Press y|Y for Yes, any other key for No) : y
</span><span class='line'>Success.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Normally, root should only be allowed to connect from
</span><span class='line'>&#39;localhost&#39;. This ensures that someone cannot guess at
</span><span class='line'>the root password from the network.
</span><span class='line'>
</span><span class='line'>Disallow root login remotely? (Press y|Y for Yes, any other key for No) : n
</span><span class='line'>
</span><span class='line'> ... skipping.
</span><span class='line'>By default, MySQL comes with a database named &#39;test&#39; that
</span><span class='line'>anyone can access. This is also intended only for testing,
</span><span class='line'>and should be removed before moving into a production
</span><span class='line'>environment.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y
</span><span class='line'> - Dropping test database...
</span><span class='line'>Success.
</span><span class='line'>
</span><span class='line'> - Removing privileges on test database...
</span><span class='line'>Success.
</span><span class='line'>
</span><span class='line'>Reloading the privilege tables will ensure that all changes
</span><span class='line'>made so far will take effect immediately.
</span><span class='line'>
</span><span class='line'>Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y
</span><span class='line'>Success.
</span><span class='line'>
</span><span class='line'>All done!
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><code>Enter password for user root:</code> で root の初期パスワードを入力する。</li>
<li><code>New password:</code> で root の新しいパスワードを設定する。<br/>
（パスワードに使用する文字は数字・英小文字・英大文字・記号を混在させること。そうしなければポリシー違反でエラーになる）</li>
<li><code>Re-enter new password:</code> で root の新しいパスワードの確認入力をする。</li>
<li><code>Estimated strength of the password: 100 ...</code> でより強固なパスワードに変更するか問われるが、 <code>n</code> で応答する。（当然 <code>y</code> でもよい）</li>
<li><code>Remove anonymous users?</code> で匿名ユーザを削除するために <code>y</code> で応答する。</li>
<li><code>Disallow root login remotely?</code> で root のリモート接続を拒否するか問われるが、リモート接続したいので <code>n</code> で応答する。（当然 <code>y</code> でもよい）</li>
<li><code>Remove test database and access to it?</code> でテストデータベースを削除するか問われるので、 <code>y</code> で応答する。</li>
<li><code>Reload privilege tables now?</code> で権限テーブルを即時リロードするか問われるので、 <code>y</code> で応答する。</li>
</ol>


<h3>8. ファイアウォール設定</h3>

<p>ポート TCP:3306 を開放する。（ローカルネット内の別マシンからのアクセスが必要な場合）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># firewall-cmd --add-port=3306/tcp
</span><span class='line'>success
</span><span class='line'># firewall-cmd --list-ports
</span><span class='line'>110/tcp 465/tcp 3306/tcp 4000-4005/tcp
</span></code></pre></td></tr></table></div></figure>


<h3>9. 動作確認</h3>

<p>MariaDB サーバにログインしてみる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mysql -u root -p
</span><span class='line'>Enter password:
</span><span class='line'>Welcome to the MySQL monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 10
</span><span class='line'>Server version: 5.7.9 MySQL Community Server (GPL)
</span><span class='line'>
</span><span class='line'>Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.
</span><span class='line'>
</span><span class='line'>Oracle is a registered trademark of Oracle Corporation and/or its
</span><span class='line'>affiliates. Other names may be trademarks of their respective
</span><span class='line'>owners.
</span><span class='line'>
</span><span class='line'>Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
</span><span class='line'>
</span><span class='line'>mysql&gt;
</span></code></pre></td></tr></table></div></figure>


<h3>10. その他</h3>

<ul>
<li>設定ファイルは &ldquo;/etc/my.cnf&rdquo; なので、実際に運用する際には綿密に検討して設定する。</li>
<li>パスワードの有効期限がデフォルトでは「360 日」に設定されている。<br/>
必要なら、システム変数 <code>default_password_lifetime</code> を編集する。</li>
</ul>


<h3>参考サイト</h3>

<ul>
<li><a href="http://dev.mysql.com/doc/mysql-yum-repo-quick-guide/en/" title="MySQL :: A Quick Guide to Using the MySQL Yum Repository">MySQL :: A Quick Guide to Using the MySQL Yum Repository</a></li>
<li><a href="http://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html" title="MySQL :: MySQL 5.7 Reference Manual :: 5.1.4 Server System Variables">MySQL :: MySQL 5.7 Reference Manual :: 5.1.4 Server System Variables</a></li>
</ul>


<hr />

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOS - Web/Proxy サーバ Nginx の最新版を yum インストール！]]></title>
    <link href="http://komasaru.github.io/blog/2015/12/12/centos-nginx-installation-by-yum/"/>
    <updated>2015-12-12T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2015/12/12/centos-nginx-installation-by-yum</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>Debian GNU/Linux や Linux Mint への公式 Apt を使用した Nginx のインストールは記録として残していましたが、 CentOS への公式 yum を使用したインストールについて記録として残してなかったので、今回記録しておくことにしました。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>CentOS 7.1-1503(x86_64) での作業を想定。（CentOS 6 系、5系でも同様（起動方法、自動起動設定、ファイアウォール設定以外は））</li>
</ul>


<h3>1. yum リポジトリの登録</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm
</span></code></pre></td></tr></table></div></figure>


<p>以下のようなリポジトリ設定ファイルが作成される。<br/>
（上記を実行せず、直接以下のようなファイルを作成してもよい）</p>

<figure class='code'><figcaption><span>/etc/yum.repos.d/nginx.repo</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># nginx.repo</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>nginx<span class="o">]</span>
</span><span class='line'><span class="nv">name</span><span class="o">=</span>nginx repo
</span><span class='line'><span class="nv">baseurl</span><span class="o">=</span>http://nginx.org/packages/OS/OSRELEASE/<span class="nv">$basearch</span>/
</span><span class='line'><span class="nv">gpgcheck</span><span class="o">=</span>0
</span><span class='line'><span class="nv">enabled</span><span class="o">=</span>1
</span></code></pre></td></tr></table></div></figure>


<h3>2. Nginx のインストール</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># yum -y install nginx
</span></code></pre></td></tr></table></div></figure>


<h3>3. Ngins インストールの確認</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># nginx -v
</span><span class='line'>nginx version: nginx/1.8.0
</span></code></pre></td></tr></table></div></figure>


<h3>4. Nginx 設定ファイルの編集</h3>

<p>Nginx 設定ファイルが &ldquo;/etc/nginx&rdquo; ディレクトリ内にあるので、必要に応じて編集する。<br/>
（取り急ぎ、今回は編集しない）</p>

<h3>5. Nginx の起動</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># systemctl start nginx
</span></code></pre></td></tr></table></div></figure>


<h3>6. Nginx 自動起動の設定</h3>

<p>マシン起動時に Nginx が自動で起動するようにしたければ以下のようにする。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># systemctl enable nginx
</span><span class='line'>systemctl list-unit-files -t service | grep nginx
</span><span class='line'>
</span><span class='line'># systemctl list-unit-files -t service | grep nginx
</span><span class='line'>nginx.service                             enabled  # &lt;= enabled であることを確認
</span></code></pre></td></tr></table></div></figure>


<h3>7. ファイアウォールの設定</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># firewall-cmd --add-service=http
</span><span class='line'>success
</span><span class='line'># firewall-cmd --add-service=http --permanent
</span><span class='line'>success
</span><span class='line'># firewall-cmd --list-services
</span><span class='line'>dhcpv6-client dns ftp http nfs pop3s smtp ssh
</span></code></pre></td></tr></table></div></figure>


<h3>8. 動作確認</h3>

<p>ブラウザで <code>http://＜サーバ名＞/</code> にアクセスしてみ &ldquo;Welcome to nginx! &hellip;&rdquo; と表示されればよい。</p>

<h3>9. 参考サイト</h3>

<ul>
<li><a href="http://nginx.org/en/linux_packages.html" title="nginx - Linux packages">nginx - Linux packages</a></li>
</ul>


<hr />

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux - マシン起動時にディレクトリ・ファイルを自動作成！]]></title>
    <link href="http://komasaru.github.io/blog/2015/12/08/linux-dir-file-automatic-creation-on-boot/"/>
    <updated>2015-12-08T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2015/12/08/linux-dir-file-automatic-creation-on-boot</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>Linux で、マシン起動時に自動でディレクトリやファイルを作成する方法についての備忘録です。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>CentOS 6.7(i386) での作業を想定。（他の Linux ディストリビューションでも同様のはず）</li>
</ul>


<h3>1. はじめに</h3>

<ul>
<li>今回の作業は、 <code>/etc/tmpfiles.d/*.conf</code> ファイルを作成することで実現する。
（環境によっては、 <code>/run/tmpfiles.d/*.conf</code>, <code>/usr/lib/tmpfiles.d/*.conf</code> ファイル）</li>
<li><code>/etc/tmpfiles.d/*.conf</code> ファイル内の書式は以下のとおり。（詳細は「<a href="http://www.unix.com/man-page/centos/5/tmpfiles.d/" title="CentOS 7.0 - man page for tmpfiles.d (centos section 5) - Unix &amp; Linux Commands">参考サイト</a>」参照<br/>
<code>Type Path Mode UID GID Age Argument</code></li>
</ul>


<h3>2. 作成例</h3>

<p>当方が使用する頻度が高いもののみについて、作成例を挙げる。</p>

<h4>2-1. ディレクトリが存在しなければ作成する例</h4>

<p>「ディレクトリ：/tmp/test_dir, パーミッション：1777, 所有者：root, グループ：root, 有効期限：５日」でディレクトリを作成する例。</p>

<figure class='code'><figcaption><span>/etc/tmpfiles.d/test_1.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>d /tmp/test_dir <span class="m">1777</span> root root 5d
</span></code></pre></td></tr></table></div></figure>


<h4>2-2. ディレクトリが存在しなければ作成し、存在していれば空にする例</h4>

<p>「ディレクトリ：/home/foo/test_dir, パーミッション：0755, 所有者：root, グループ：root, 有効期限：無限」でディレクトリを作成する例。</p>

<figure class='code'><figcaption><span>/etc/tmpfiles.d/test_2.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>D /home/foo/test_dir <span class="m">0755</span> root root -
</span></code></pre></td></tr></table></div></figure>


<h4>2-3. ファイルが存在しなければ作成する例</h4>

<p>「ファイル：/home/foo/test.txt, パーミッション：0777, 所有者：root, グループ：root, 有効期限：無限、ファイル内容：空」でファイルを作成する例。</p>

<figure class='code'><figcaption><span>/etc/tmpfiles.d/test_3.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>f /home/foo/test.txt <span class="m">0777</span> root root -
</span></code></pre></td></tr></table></div></figure>


<h4>2-4. ファイルが存在しなければ作成し、存在していれば空にする例</h4>

<p>「ファイル：/home/foo/test.txt, パーミッション：0777, 所有者：root, グループ：root, 有効期限：無限、ファイル内容："This is a tmpfiles.d test!&ldquo;」でファイルを作成する例。</p>

<figure class='code'><figcaption><span>/etc/tmpfiles.d/test_4.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>F /home/foo/test.txt <span class="m">0777</span> root root - <span class="s2">&quot;This is a tmpfiles.d test!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. 参考サイト</h3>

<ul>
<li><a href="http://www.unix.com/man-page/centos/5/tmpfiles.d/" title="CentOS 7.0 - man page for tmpfiles.d (centos section 5) - Unix &amp; Linux Commands">CentOS 7.0 - man page for tmpfiles.d (centos section 5) - Unix &amp; Linux Commands</a></li>
</ul>


<hr />

<p>意外とよく使用する機能だけど、使用方法について説明しているサイトがあまりないので、備忘録として残しておいた次第です。</p>

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MariaDB(MySQL) - ロールフォワード（ポイント・イン・タイム）リカバリ！]]></title>
    <link href="http://komasaru.github.io/blog/2015/12/03/mariadb-rollforward-recovery/"/>
    <updated>2015-12-03T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2015/12/03/mariadb-rollforward-recovery</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>MariaDB(MySQL) で障害発生時に、定期的に取得していたダンプファイルでリストアするだけでは、当然タイミングによっては古い状態になってしまいます。</p>

<p>以下は、定期的に取得していたダンプファイルとそれより後のログファイルで障害発生直前の状態までリカバリする方法についての記録です。</p>

<!--more-->


<h3>0. 前提条件</h3>

<ul>
<li>MySQL 5.6 系、 MariaDB 10.0 系での作業を想定。<br/>
（他のバージョンでもそれほど古くなければ同様）</li>
<li>バイナリロギングが有効になっている。
（設定ファイル &ldquo;my.cnf&rdquo; で <code>log-bin=...</code> の行がコメント化されていない、もしくはサーバ起動時に <code>--log-bin</code> オプションを使用している）</li>
</ul>


<h3>1. はじめに</h3>

<ul>
<li>ロールフォワードリカバリとは、簡単には、

<ul>
<li>バックアップファイルとジャーナルファイルを用いて、障害発生以前の状態に復元すること。（某国家試験で出題される基本的なこと）<br/>
今回の MariaDB(MySQL) での作業では、ダンプファイルとバイナリログファイルがそれにあたる。</li>
</ul>
</li>
<li>ポイント・イン・タイムリカバリ(Point-In-Time Recovery, PITR)とは、簡単には、

<ul>
<li>指定した時間の状態に戻すこと。</li>
<li>障害が発生する直前の状態まで戻すこと。</li>
<li>Oracle の「完全・不完全リカバリ」にあたるもの。</li>
</ul>
</li>
</ul>


<h3>2. 基本的な作業の流れ</h3>

<ol>
<li>ダンプ出力（<code>mysqldump</code> による定期バックアップ）</li>
<li>通常運用</li>
<li>障害発生</li>
<li>ダンプファイルのリストア</li>
<li>バイナリログの適用（ダンプリストア後〜障害発生直前）</li>
<li>復元確認</li>
</ol>


<h3>3. 作業例</h3>

<p>当然ながら、当作業中は整合性を保つためにデータベースサーバへのアクセスが発生しないようにしておくこと。（アプリの停止、Web サーバの停止等）</p>

<h4>3-1. ダンプ出力（<code>mysqldump</code> による定期バックアップ）</h4>

<p>以下のようなコマンドを cron 実行するなどして、定期的にバックアップを取る。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>mysqldump -u root -proot_password --single-transaction --master-data --flush-logs db_name &gt; db_name.sql
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>--single-transaction</code> は、データの整合性を保つためにダンプをトランザクションで囲むオプション。</li>
<li><code>--master-data</code> は、<code>CHANGE MASTER TO</code> 句（ポイント・イン・タイムリカバリを開始するバイナリファイル・ポイントの情報）を出力するオプション。</li>
<li><code>--flush-logs</code> は、ダンプ出力後にバイナリログを新しく作成（フラッシュ）するオプション。 <code>-F</code> も同じ。</li>
<li><code>--flush-logs</code> オプションを使用した場合は、ポイント・イン・タイムリカバリを開始するポイントは新しいバイナリファイルの先頭ポイントなので、 <code>--master-data</code> オプションを使用する不要はないかもしれない。</li>
<li><code>--master-logs</code> オプションを使用した場合は、ポイント・イン・タイムリカバリを開始するポイントが明確に分かるので、敢えて <code>--flush-logs</code> オプションを使用する必要はないかもしれない。</li>
<li>場合によっては、 <code>--quote-names</code>（or <code>-Q</code>）, <code>--skip-lock-tables</code> 等のオプションも使用。</li>
<li>場合によっては、 <code>--all-databases</code>（or <code>-A</code>）オプションで全 DB をダンプ出力してもよいだろう。</li>
</ul>


<h4>3-2. 通常運用</h4>

<p>当然ながら、ダンプ出力後も通常どおり運用されている。(INSERT, UPDATE, DELETE etc.)</p>

<h4>3-3. 障害発生</h4>

<p>通常運用時に何らかの障害が発生する。（今回は、人為的なミスで１テーブルを <code>DROP</code> してしまったことを想定）</p>

<h4>3-4. ダンプファイルのリストア</h4>

<p>障害発生時には、まず定期的に取っていたダンプファイルを使用してリストアする。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mysql -u root -p db_name &lt; db_name.sql
</span></code></pre></td></tr></table></div></figure>


<h4>3-5. バイナリログの適用（ダンプリストア後〜障害発生直前）</h4>

<p>まず、ダンプファイルからポイント・イン・タイムリカバリを開始するバイナリログファイル・ポイントを確認する。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># cat /path/to/db_name.sql | CHANGE
</span><span class='line'>CHANGE MASTER TO MASTER_LOG_FILE=&#39;mysql-bin.004962&#39;, MASTER_LOG_POS=365;
</span></code></pre></td></tr></table></div></figure>


<p>この例では、バイナリログファイル &ldquo;mysql-bin.004962&rdquo; の ポイント &ldquo;365&rdquo; より前まではダンプファイルでリストアできているということ。</p>

<p>次に、障害が発生したポイントを最新のバイナリログから検索する。</p>

<p>以下は、誤ってテーブル test_table を DROP してしまった場合にそのポイントを検索する例。<br/>
該当行より３行くらい前にポイントが記載されているので、 <code>grep</code> コマンドに <code>-B 3</code> オプションを使用している。<br/>
また、 &ldquo;my.cnf&rdquo; の <code>[client]</code> に <code>default-character-set</code> が存在すると <code>unknown variable</code> エラーが発生するため、<code>--no-defaults</code> オプションを使用している。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mysqlbinlog --nodefaults --database=db_name /path/to/mysql-bin.004962 | grep -B 3 DROP
</span><span class='line'># at 10923096
</span><span class='line'>#151029 11:15:17 server id 1  end_log_pos 10923228      Query   thread_id=1124470       exec_time=0     error_code=0
</span><span class='line'>SET TIMESTAMP=1446084917/*!*/;
</span><span class='line'>DROP TABLE test_table
</span></code></pre></td></tr></table></div></figure>


<p>この場合、ポイントは <code>10923096</code> であるということ。</p>

<p>いよいよ、バイナリログを適用する。<br/>
以下は、バイナリログファイル &ldquo;mysql-bin.004962&rdquo; の先頭ポイントからポイント &ldquo;10923096&rdquo; の <code>--database</code> オプションで指定したデータベースのバイナリログを適用する例。
（<code>--disable-log-bin</code>（or <code>-D</code>） オプションはバイナリログの出力を無効にするオプション。バイナリログ適用時にまでバイナリログを出力する必要はないので）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mysqlbinlog --database=db_name --disable-log-bin --stop-position=10923096 /path/to/mysql-bin.004962 | mysql -u root -p
</span></code></pre></td></tr></table></div></figure>


<p>ちなみに、ダンプ出力後のバイナリログファイルが複数ある場合は以下のように並べて記載する。<br/>
この場合、<code>--stop-position</code> オプションは最後のバイナリログファイルに対してのみ有効。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># mysqlbinlog --database=db_name --disable-log-bin --stop-position=10923096 /path/to/mysql-bin.004960 /path/to/mysql-bin.004962 | mysql -u root -proot_password
</span></code></pre></td></tr></table></div></figure>


<p>仮にダンプ出力時に <code>--flush-logs</code> オプションを指定していなかった場合は開始ポイントが明確でないため、明示的に <code>--start-position</code> オプションで指定する必要がある。（バイナリログファイルが複数ある場合は <code>--start-position</code> は最初のバイナリログファイルに対してのみ有効）</p>

<h4>3-6. 復元確認</h4>

<p>後は、正常に復元されたか確認するだけ。</p>

<h3>4. その他＆注意事項</h3>

<ul>
<li>今回はポジションを意識したリカバリを行なったが、状況によっては日付を意識したリカバリも可能。（<code>--start-datatime</code>, <code>--stop-datetim</code> オプションを使用）</li>
<li><code>mysqlbinlog</code> コマンドでバイナリログファイルを複数指定する際は、一度に全て指定すること。（１ファイルずつ複数に分けて実行しない）</li>
<li>バイナリログファイルが複数存在する場合は、１つにマージしてから <code>mysqlbinlog</code> を実行してもよい。</li>
<li><code>mysqlbinlog ... binlog | mysql -u root -p</code> のようにパイプを使用せず、 <code>mysqlbinlog ... binlog &gt; statements.sql</code> 実行後に <code>mysql -u root -p &lt; statements.sql</code> を実行してもよい。</li>
</ul>


<h3>5. 参考サイト</h3>

<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.6/ja/point-in-time-recovery.html" title="MySQL :: MySQL 5.6 リファレンスマニュアル :: 7.5 バイナリログを使用したポイントインタイム (増分) リカバリ">MySQL :: MySQL 5.6 リファレンスマニュアル :: 7.5 バイナリログを使用したポイントインタイム (増分) リカバリ</a></li>
</ul>


<hr />

<p>有事の際にしか行わない作業なので、記録として残しておいた次第です。</p>

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2015年11月 - OS・ブラウザ別アクセス状況！【自動集計】]]></title>
    <link href="http://komasaru.github.io/blog/2015/12/01/blog-access/"/>
    <updated>2015-12-01T00:20:00+09:00</updated>
    <id>http://komasaru.github.io/blog/2015/12/01/blog-access</id>
    <content type="html"><![CDATA[<p>こんばんは。</p>

<p>12月になりましたので、先月11月分の当ブログアクセス状況を公開します。</p>

<!--more-->


<h4>1. アクセスをOS別に集計</h4>

<table class="blog-access">
  <tr>
    <th>OS</th>
    <th>PageViews</th>
    <th>比率(%)</th>
  </tr>
  <tr>
    <td>Mac OS</td>
    <td class="blog-access-pv">31,101</td>
    <td class="blog-access-rate">59.6262</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td class="blog-access-pv">17,286</td>
    <td class="blog-access-rate">33.1403</td>
  </tr>
  <tr>
    <td>Linux</td>
    <td class="blog-access-pv">1,930</td>
    <td class="blog-access-rate">3.7002</td>
  </tr>
  <tr>
    <td>Ubuntu Linux</td>
    <td class="blog-access-pv">1,416</td>
    <td class="blog-access-rate">2.7147</td>
  </tr>
  <tr>
    <td>unknown</td>
    <td class="blog-access-pv">222</td>
    <td class="blog-access-rate">0.4256</td>
  </tr>
  <tr>
    <td>Fedora Linux</td>
    <td class="blog-access-pv">101</td>
    <td class="blog-access-rate">0.1936</td>
  </tr>
  <tr>
    <td>FreeBSD</td>
    <td class="blog-access-pv">39</td>
    <td class="blog-access-rate">0.0748</td>
  </tr>
  <tr>
    <td>Android</td>
    <td class="blog-access-pv">22</td>
    <td class="blog-access-rate">0.0422</td>
  </tr>
  <tr>
    <td>iPhone OS</td>
    <td class="blog-access-pv">19</td>
    <td class="blog-access-rate">0.0364</td>
  </tr>
  <tr>
    <td>CentOS Linux</td>
    <td class="blog-access-pv">11</td>
    <td class="blog-access-rate">0.0211</td>
  </tr>
  <tr>
    <td>RedHat Linux</td>
    <td class="blog-access-pv">5</td>
    <td class="blog-access-rate">0.0096</td>
  </tr>
  <tr>
    <td>Solaris</td>
    <td class="blog-access-pv">5</td>
    <td class="blog-access-rate">0.0096</td>
  </tr>
  <tr>
    <td>Debian GNU/Linux</td>
    <td class="blog-access-pv">2</td>
    <td class="blog-access-rate">0.0038</td>
  </tr>
  <tr>
    <td>OpenBSD</td>
    <td class="blog-access-pv">1</td>
    <td class="blog-access-rate">0.0019</td>
  </tr>
  <tr>
    <td class="blog-access-total-label">合　計</td>
    <td class="blog-access-pv">52,160</td>
    <td class="blog-access-rate">100.0000</td>
  </tr>
</table>


<h4>2. アクセスをOS・バージョン別に集計（上位20件）</h4>

<table class="blog-access">
  <tr>
    <th>OS</th>
    <th>Version</th>
    <th>PageViews</th>
    <th>比率(%)</th>
  </tr>
  <tr>
    <td>Mac OS</td>
    <td>X</td>
    <td class="blog-access-pv">31,101</td>
    <td class="blog-access-rate">59.6262</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>NT</td>
    <td class="blog-access-pv">14,839</td>
    <td class="blog-access-rate">28.4490</td>
  </tr>
  <tr>
    <td>Linux</td>
    <td>unknown</td>
    <td class="blog-access-pv">1,905</td>
    <td class="blog-access-rate">3.6522</td>
  </tr>
  <tr>
    <td>Ubuntu Linux</td>
    <td>unknown</td>
    <td class="blog-access-pv">1,408</td>
    <td class="blog-access-rate">2.6994</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>7</td>
    <td class="blog-access-pv">1,170</td>
    <td class="blog-access-rate">2.2431</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>7 64 bit</td>
    <td class="blog-access-pv">688</td>
    <td class="blog-access-rate">1.3190</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>XP</td>
    <td class="blog-access-pv">334</td>
    <td class="blog-access-rate">0.6403</td>
  </tr>
  <tr>
    <td>unknown</td>
    <td>unknown</td>
    <td class="blog-access-pv">222</td>
    <td class="blog-access-rate">0.4256</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>Vista</td>
    <td class="blog-access-pv">176</td>
    <td class="blog-access-rate">0.3374</td>
  </tr>
  <tr>
    <td>Fedora Linux</td>
    <td>unknown</td>
    <td class="blog-access-pv">96</td>
    <td class="blog-access-rate">0.1840</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>8 64 bit</td>
    <td class="blog-access-pv">46</td>
    <td class="blog-access-rate">0.0882</td>
  </tr>
  <tr>
    <td>FreeBSD</td>
    <td>unknown</td>
    <td class="blog-access-pv">39</td>
    <td class="blog-access-rate">0.0748</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>Server 2003</td>
    <td class="blog-access-pv">15</td>
    <td class="blog-access-rate">0.0288</td>
  </tr>
  <tr>
    <td>Linux</td>
    <td>64 bit</td>
    <td class="blog-access-pv">14</td>
    <td class="blog-access-rate">0.0268</td>
  </tr>
  <tr>
    <td>Windows</td>
    <td>8</td>
    <td class="blog-access-pv">11</td>
    <td class="blog-access-rate">0.0211</td>
  </tr>
  <tr>
    <td>Linux</td>
    <td></td>
    <td class="blog-access-pv">11</td>
    <td class="blog-access-rate">0.0211</td>
  </tr>
  <tr>
    <td>Android</td>
    <td>2.3.4</td>
    <td class="blog-access-pv">8</td>
    <td class="blog-access-rate">0.0153</td>
  </tr>
  <tr>
    <td>Ubuntu Linux</td>
    <td></td>
    <td class="blog-access-pv">7</td>
    <td class="blog-access-rate">0.0134</td>
  </tr>
  <tr>
    <td>iPhone OS</td>
    <td>4_3_2</td>
    <td class="blog-access-pv">7</td>
    <td class="blog-access-rate">0.0134</td>
  </tr>
  <tr>
    <td>CentOS Linux</td>
    <td>3.6.24-3.el6.centos 64 bit</td>
    <td class="blog-access-pv">7</td>
    <td class="blog-access-rate">0.0134</td>
  </tr>
  <tr>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
  </tr>
  <tr>
    <td class="blog-access-total-label">合　計</td>
    <td> </td>
    <td class="blog-access-pv">52,160</td>
    <td class="blog-access-rate">100.0000</td>
  </tr>
</table>


<h4>3. アクセスをブラウザ別に集計</h4>

<table class="blog-access">
  <tr>
    <th>ブラウザ</th>
    <th>PageViews</th>
    <th>比率(%)</th>
  </tr>
  <tr>
    <td>Safari</td>
    <td class="blog-access-pv">30,009</td>
    <td class="blog-access-rate">57.5326</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td class="blog-access-pv">12,257</td>
    <td class="blog-access-rate">23.4988</td>
  </tr>
  <tr>
    <td>Mozilla</td>
    <td class="blog-access-pv">6,115</td>
    <td class="blog-access-rate">11.7235</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td class="blog-access-pv">2,810</td>
    <td class="blog-access-rate">5.3873</td>
  </tr>
  <tr>
    <td>Debian IceWeasel</td>
    <td class="blog-access-pv">557</td>
    <td class="blog-access-rate">1.0679</td>
  </tr>
  <tr>
    <td>Opera</td>
    <td class="blog-access-pv">182</td>
    <td class="blog-access-rate">0.3489</td>
  </tr>
  <tr>
    <td>Netscape Navigator</td>
    <td class="blog-access-pv">134</td>
    <td class="blog-access-rate">0.2569</td>
  </tr>
  <tr>
    <td>Chrome</td>
    <td class="blog-access-pv">26</td>
    <td class="blog-access-rate">0.0498</td>
  </tr>
  <tr>
    <td>Mozilla SeaMonkey</td>
    <td class="blog-access-pv">23</td>
    <td class="blog-access-rate">0.0441</td>
  </tr>
  <tr>
    <td>iPhone</td>
    <td class="blog-access-pv">19</td>
    <td class="blog-access-rate">0.0364</td>
  </tr>
  <tr>
    <td>PHP</td>
    <td class="blog-access-pv">7</td>
    <td class="blog-access-rate">0.0134</td>
  </tr>
  <tr>
    <td>Epiphany</td>
    <td class="blog-access-pv">7</td>
    <td class="blog-access-rate">0.0134</td>
  </tr>
  <tr>
    <td>Konqueror</td>
    <td class="blog-access-pv">5</td>
    <td class="blog-access-rate">0.0096</td>
  </tr>
  <tr>
    <td>SRWare Iron</td>
    <td class="blog-access-pv">4</td>
    <td class="blog-access-rate">0.0077</td>
  </tr>
  <tr>
    <td>unknown</td>
    <td class="blog-access-pv">4</td>
    <td class="blog-access-rate">0.0077</td>
  </tr>
  <tr>
    <td>Sleipnir</td>
    <td class="blog-access-pv">1</td>
    <td class="blog-access-rate">0.0019</td>
  </tr>
  <tr>
    <td class="blog-access-total-label">合　計</td>
    <td class="blog-access-pv">52,160</td>
    <td class="blog-access-rate">100.0000</td>
  </tr>
</table>


<h4>4. アクセスをブラウザ・バージョン別に集計（上位20件）</h4>

<table class="blog-access">
  <tr>
    <th>ブラウザ</th>
    <th>Version</th>
    <th>PageViews</th>
    <th>比率(%)</th>
  </tr>
  <tr>
    <td>Safari</td>
    <td>537.36</td>
    <td class="blog-access-pv">22,541</td>
    <td class="blog-access-rate">43.2151</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>42.0</td>
    <td class="blog-access-pv">7,269</td>
    <td class="blog-access-rate">13.9360</td>
  </tr>
  <tr>
    <td>Mozilla</td>
    <td>11.0</td>
    <td class="blog-access-pv">6,111</td>
    <td class="blog-access-rate">11.7159</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>9537.53</td>
    <td class="blog-access-pv">2,724</td>
    <td class="blog-access-rate">5.2224</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>41.0</td>
    <td class="blog-access-pv">2,378</td>
    <td class="blog-access-rate">4.5590</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>601.1</td>
    <td class="blog-access-pv">1,299</td>
    <td class="blog-access-rate">2.4904</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>601.2.7</td>
    <td class="blog-access-pv">1,293</td>
    <td class="blog-access-rate">2.4789</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>38.0</td>
    <td class="blog-access-pv">1,151</td>
    <td class="blog-access-rate">2.2067</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td>8.0</td>
    <td class="blog-access-pv">1,007</td>
    <td class="blog-access-rate">1.9306</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>600.1.4</td>
    <td class="blog-access-pv">806</td>
    <td class="blog-access-rate">1.5452</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td>10.0</td>
    <td class="blog-access-pv">688</td>
    <td class="blog-access-rate">1.3190</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td>9.0</td>
    <td class="blog-access-pv">623</td>
    <td class="blog-access-rate">1.1944</td>
  </tr>
  <tr>
    <td>Internet Explorer</td>
    <td>7.0</td>
    <td class="blog-access-pv">467</td>
    <td class="blog-access-rate">0.8953</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>534.30</td>
    <td class="blog-access-pv">291</td>
    <td class="blog-access-rate">0.5579</td>
  </tr>
  <tr>
    <td>Debian IceWeasel</td>
    <td>38.4.0</td>
    <td class="blog-access-pv">290</td>
    <td class="blog-access-rate">0.5560</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>31.0</td>
    <td class="blog-access-pv">234</td>
    <td class="blog-access-rate">0.4486</td>
  </tr>
  <tr>
    <td>Opera</td>
    <td>9.80</td>
    <td class="blog-access-pv">178</td>
    <td class="blog-access-rate">0.3413</td>
  </tr>
  <tr>
    <td>Safari</td>
    <td>537.86.2</td>
    <td class="blog-access-pv">149</td>
    <td class="blog-access-rate">0.2857</td>
  </tr>
  <tr>
    <td>Mozilla Firefox</td>
    <td>40.0</td>
    <td class="blog-access-pv">146</td>
    <td class="blog-access-rate">0.2799</td>
  </tr>
  <tr>
    <td>Netscape Navigator</td>
    <td>5.0</td>
    <td class="blog-access-pv">134</td>
    <td class="blog-access-rate">0.2569</td>
  </tr>
  <tr>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
    <td class="blog-access-dot">:</td>
  </tr>
  <tr>
    <td class="blog-access-total-label">合　計</td>
    <td> </td>
    <td class="blog-access-pv">52,160</td>
    <td class="blog-access-rate">100.0000</td>
  </tr>
</table>


<hr />

<p>以上。</p>
]]></content>
  </entry>
  
</feed>
